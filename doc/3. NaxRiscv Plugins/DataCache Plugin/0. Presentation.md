DataCache Plugin is a plugin that manages the data cache memory

[code](https://github.com/SpinalHDL/NaxRiscv/blob/main/src/main/scala/naxriscv/lsu/DataCachePlugin.scala)

___

The `DataCachePlugin` is a wrapper for the `DataCache` component, which is really the data cache. `DataCachePlugin` consists of logical areas for communicating with other plugins and arbitrating requests to `DataCache`. 

The plugin is connected :
- on one side, to the `Lsu2Plugin` and to the `MmuPlugin` plugin 
- on the other, to the memory

There is one `storePorts` connected to `Lsu2Plugin`, but there are two `loadPorts` connected to `Lsu2Plugin` and `MmuPlugin`. This is why we need the `load` logical area in `DataCachePlugin` to arbitrate between these two ports.

Arbitration is done using the `priority` argument declared when the port is created with the `newLoadPort` function. The highest priority is taken first. In the default NaxRiscv, the `MmuPlugin` has priority over the `Lsu2Plugin`.

In addition, the `load` area uses Spinal's `History` component to record which `loadPorts.cmd` port was chosen. We need this information to pick the correct `loadPorts.translated`, `loadPorts.cancels` ports and to return the cache response to the correct `loadPorts.rsp` port.

## DataCache

As mentioned above, `DataCache` is a component and not a plugin, which is why we need the `DataCachePlugin` wrapper. This is also why we have the familiar architecture of Spinal components with `DataCache`, example the `io` bundle is used.

#### io  

![](DataCache.png)

The main ports of `DataCache` are :

- **load** : read port on the CPU side

| Port name | Type | Direction | Description |
| :-: |  :-: |  :-: |  :-: |
| load.cmd | Stream(DataLoadCmd) | M => S | Load command with virtual address |
| load.translated | DataLoadTranslated | M => S | Physical address |
| load.cancels | Bits(rspAt+1 bits) | M => S | Load cancel |
| load.rsp | Flow(DataLoadRsp) | M <= S | Load response |

**DataLoadCmd fields**

| Field name | Type | Description |
| :-: |  :-: |  :-: |
| virtual | UInt(preTranslationWidth bits) | Virtual address |
| size | UInt(log2Up(log2Up(dataWidth/8)+1) bits) | Load size (0 = byte, 1 = half, ...), but not used inside cache |
| redoOnDataHazard | Bool | Usefull for access not protected by the LSU (ex: MMU refill) |
| unlocked | Bool | Used for atomic operation |

**DataLoadTranslated fields**

| Field name | Type | Description |
| :-: |  :-: |  :-: |
| physical | UInt(postTranslationWidth bits) | Physical address |
| abord | Bool | Abord load request |

**DataLoadRsp fields**

| Field name | Type | Description |
| :-: |  :-: |  :-: |
| data | Bits(dataWidth bits) | Data loaded |
| fault | Bool | Error received from memory(or interconnect) |
| redo | Bool | Have to redo load request |
| refillSlot | Bits(refillCount bits) | When miss, refill slot number used for refill, else zero when refillSlotAny |
| refillSlotAny | Bool | Not valid if not miss, valid if miss & slots full |

___
- **store** : write port on the CPU side

| Port name | Type | Direction | Description |
| :-: |  :-: |  :-: |  :-: |
| store.cmd | Flow(DataStoreCmd) | M => S | Store command |
| store.rsp | Flow(DataStoreRsp) | M <= S | Store response |

**DataStoreCmd fields**

| Field name | Type | Description |
| :-: |  :-: |  :-: |
| address | UInt(postTranslationWidth bits) | Physical address |
| data | Bits(dataWidth bits) | Data to store |
| mask | Bits(dataWidth/8 bits) | Data mask depending on store size |
| generation | Bool | Field that switch between each store command |
| io | Bool | IO access |
| flush | Bool | Flush all the ways for a the given addressâ€™s line (= writeback if dirty) |
| flushFree | Bool | In addition to flush, set tag = random number |
| prefetch | Bool | Store command from prefetch predictor |

**DataStoreRsp fields**

| Field name | Type | Description |
| :-: |  :-: |  :-: |
| fault | Bool | Error received from memory(or interconnect) |
| redo | Bool | Have to redo store request |
| refillSlot | Bits(refillCount bits) | When miss, refill slot number used for refill, else zero when refillSlotAny |
| refillSlotAny | Bool | Not valid if not miss, valid if miss & slots full |
| generationKo | Bool | If generation field value of store command is wrong |
| flush | Bool | If store command was a flush command |
| prefetch | Bool | if store command from prefetch predictor |
| address | Uint(addressWidth bits) | Physical address of store command |

___
- **mem.read** : read port on the memory side

| Port name | Type | Direction | Description |
| :-: |  :-: |  :-: |  :-: |
| mem.read.cmd | Stream(DataMemReadCmd) | M => S | Memory read command |
| mem.read.rsp | Stream(DataMemReadRsp) | M <= S | Memory read response |

**DataMemReadCmd fields**

| Field name | Type | Description |
| :-: |  :-: |  :-: |
| id | UInt(p.readIdWidth bits) | Refill slot number |
| address | UInt(p.addressWidth bits) | Physical address |

**DataMemReadRsp fields**

| Field name | Type | Description |
| :-: |  :-: |  :-: |
| id | UInt(p.readIdWidth bits) | Refill slot number |
| data | Bits(p.dataWidth bits) | Data readed |
| error | Bool | Error from memory or interconnect |

___
- **mem.write** : write port on the memory side

| Port name | Type | Direction | Description |
| :-: |  :-: |  :-: |  :-: |
| mem.write.cmd | Stream(DataMemWriteCmd) | M => S | Memory write command |
| mem.write.rsp | Flow(DataMemWriteRsp) | M <= S | Memory write response |

**DataMemWriteCmd fields**

| Field name | Type | Description |
| :-: |  :-: |  :-: |
| id | UInt(p.writeIdWidth bits) | Writeback slot number |
| address | UInt(p.addressWidth bits) | Physical address |
| data | Bits(p.dataWidth bits) | Data to write |
| mask | Bits(p.dataWidth/8 bits) | Data mask |

**DataMemWriteRsp fields**

| Field name | Type | Description |
| :-: |  :-: |  :-: |
| id | UInt(p.writeIdWidth bits) | Writeback slot number |
| error | Bool | Error from memory or interconnect |

___
**refillEvent**

| Port name | Type | Direction | Description |
| :-: |  :-: |  :-: |  :-: |
| refillEvent | Bool | M <= S | True when a cache miss is pushed into a refill slot  |

___
**refillCompletions**

| Port name | Type | Direction | Description |
| :-: |  :-: |  :-: |  :-: |
| refillCompletions | Bits(refillCount bits) | M <= S | Refill slot number that completed refilling |

___
**writebackEvent**

| Port name | Type | Direction | Description |
| :-: |  :-: |  :-: |  :-: |
| writebackEvent | Bool | M <= S | True when a cache line is pushed into a writeback slot  |

___
**writebackBusy**

| Port name | Type | Direction | Description |
| :-: |  :-: |  :-: |  :-: |
| writebackBusy | Bool | M <= S | True when all writeback slots are valid  |

___
- **lock** : locks the cache line for this address during an atomic operation

| Port name | Type | Direction | Description |
| :-: |  :-: |  :-: |  :-: |
| lock.address | Uint(12 bits) | M => S | Address to lock |
| lock.valid | Bool | M => S |  |

___
#### Cache memory architecture

<svg version="1.1" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 1119.8025080059642 441.9680246233027" width="1119.8025080059642" height="441.9680246233027">
  <!-- svg-source:excalidraw -->
  
  <defs>
    <style class="style-fonts">
      @font-face {
        font-family: "Virgil";
        src: url("https://excalidraw.com/Virgil.woff2");
      }
      @font-face {
        font-family: "Cascadia";
        src: url("https://excalidraw.com/Cascadia.woff2");
      }
    </style>
  </defs>
  <rect x="0" y="0" width="1119.8025080059642" height="441.9680246233027" fill="#ffffff"></rect><g stroke-linecap="round" transform="translate(311.73858199654353 26.91175739846568) rotate(0 201.5 129.5)"><path d="M0 0 L403 0 L403 259 L0 259" stroke="none" stroke-width="0" fill="#ffffff"></path><path d="M0 0 C148.24 0, 296.47 0, 403 0 M0 0 C129.38 0, 258.76 0, 403 0 M403 0 C403 91.92, 403 183.85, 403 259 M403 0 C403 101.63, 403 203.26, 403 259 M403 259 C291.21 259, 179.42 259, 0 259 M403 259 C253.51 259, 104.01 259, 0 259 M0 259 C0 203.32, 0 147.64, 0 0 M0 259 C0 202.16, 0 145.32, 0 0" stroke="#d9480f" stroke-width="4" fill="none"></path></g><g stroke-linecap="round" transform="translate(119.73858199654353 26.91175739846568) rotate(0 94.5 129.5)"><path d="M0 0 L189 0 L189 259 L0 259" stroke="none" stroke-width="0" fill="#ffffff"></path><path d="M0 0 C38.61 0, 77.21 0, 189 0 M0 0 C54.78 0, 109.56 0, 189 0 M189 0 C189 73.27, 189 146.55, 189 259 M189 0 C189 71.79, 189 143.57, 189 259 M189 259 C114.14 259, 39.27 259, 0 259 M189 259 C139.9 259, 90.8 259, 0 259 M0 259 C0 200.09, 0 141.18, 0 0 M0 259 C0 158.26, 0 57.51, 0 0" stroke="#087f5b" stroke-width="4" fill="none"></path></g><g stroke-linecap="round"><g transform="translate(311.73858199654353 60.91175739846568) rotate(0 201.5 0)"><path d="M0 0 C154.83 0, 309.67 0, 403 0 M0 0 C109.98 0, 219.97 0, 403 0" stroke="#d9480f" stroke-width="4" fill="none"></path></g></g><mask></mask><g stroke-linecap="round"><g transform="translate(306.73858199654353 60.91175739846568) rotate(0 -93.5 0)"><path d="M0 0 C-39.15 0, -78.3 0, -187 0 M0 0 C-57.41 0, -114.82 0, -187 0" stroke="#087f5b" stroke-width="4" fill="none"></path></g></g><mask></mask><g transform="translate(472.23858199654353 31.91175739846568) rotate(0 41 11.5)"><text x="41" y="18" font-family="Helvetica, Segoe UI Emoji" font-size="20px" fill="#d9480f" text-anchor="middle" style="white-space: pre;" direction="ltr">banks(w)</text></g><g transform="translate(177.23858199654353 31.91175739846568) rotate(0 37 11.5)"><text x="37" y="18" font-family="Helvetica, Segoe UI Emoji" font-size="20px" fill="#087f5b" text-anchor="middle" style="white-space: pre;" direction="ltr">ways(w)</text></g><g stroke-linecap="round" transform="translate(96.73858199654353 71.91175739846568) rotate(0 94.5 129.5)"><path d="M0 0 L189 0 L189 259 L0 259" stroke="none" stroke-width="0" fill="#ffffff"></path><path d="M0 0 C49.62 0, 99.23 0, 189 0 M0 0 C61.27 0, 122.55 0, 189 0 M189 0 C189 61.65, 189 123.31, 189 259 M189 0 C189 77.27, 189 154.53, 189 259 M189 259 C113.94 259, 38.88 259, 0 259 M189 259 C141.32 259, 93.64 259, 0 259 M0 259 C0 167.99, 0 76.99, 0 0 M0 259 C0 156.68, 0 54.36, 0 0" stroke="#087f5b" stroke-width="4" fill="none"></path></g><g stroke-linecap="round" transform="translate(288.73858199654353 71.91175739846568) rotate(0 201.5 129.5)"><path d="M0 0 L403 0 L403 259 L0 259" stroke="none" stroke-width="0" fill="#ffffff"></path><path d="M0 0 C118.09 0, 236.18 0, 403 0 M0 0 C138.25 0, 276.5 0, 403 0 M403 0 C403 51.85, 403 103.7, 403 259 M403 0 C403 97.12, 403 194.25, 403 259 M403 259 C292.03 259, 181.06 259, 0 259 M403 259 C260.23 259, 117.46 259, 0 259 M0 259 C0 156.04, 0 53.07, 0 0 M0 259 C0 183.51, 0 108.02, 0 0" stroke="#d9480f" stroke-width="4" fill="none"></path></g><g stroke-linecap="round"><g transform="translate(288.73858199654353 105.91175739846568) rotate(0 201.5 0)"><path d="M0 0 C137.37 0, 274.74 0, 403 0 M0 0 C120.16 0, 240.32 0, 403 0" stroke="#d9480f" stroke-width="4" fill="none"></path></g></g><mask></mask><g stroke-linecap="round"><g transform="translate(283.73858199654353 105.91175739846568) rotate(0 -93.5 0)"><path d="M0 0 C-44.72 0, -89.45 0, -187 0 M0 0 C-65.71 0, -131.43 0, -187 0" stroke="#087f5b" stroke-width="4" fill="none"></path></g></g><mask></mask><g transform="translate(450.73858199654353 76.91175739846568) rotate(0 39.5 11.5)"><text x="39.5" y="18" font-family="Helvetica, Segoe UI Emoji" font-size="20px" fill="#d9480f" text-anchor="middle" style="white-space: pre;" direction="ltr">banks(1)</text></g><g transform="translate(155.73858199654353 76.91175739846568) rotate(0 35.5 11.5)"><text x="35.5" y="18" font-family="Helvetica, Segoe UI Emoji" font-size="20px" fill="#087f5b" text-anchor="middle" style="white-space: pre;" direction="ltr">ways(1)</text></g><g stroke-linecap="round"><g transform="translate(96.73905648697445 147.80625005669617) rotate(0 296.5 0)"><path d="M0 0 C174.54 0, 349.08 0, 593 0 M0 0 C129.64 0, 259.28 0, 593 0" stroke="#000000" stroke-width="4" fill="none"></path></g></g><mask></mask><g stroke-linecap="round"><g transform="translate(96.23905648697445 183.20625005669618) rotate(0 296.5 0)"><path d="M0 0 C121.53 0, 243.05 0, 593 0 M0 0 C218.92 0, 437.84 0, 593 0" stroke="#000000" stroke-width="4" fill="none"></path></g></g><mask></mask><g stroke-linecap="round"><g transform="translate(98.23905648697445 218.60625005669618) rotate(0 296.5 0)"><path d="M0 0 C193.16 0, 386.31 0, 593 0 M0 0 C159.98 0, 319.95 0, 593 0" stroke="#000000" stroke-width="4" fill="none"></path></g></g><mask></mask><g stroke-linecap="round"><g transform="translate(96.73905648697445 254.0062500566962) rotate(0 296.5 0)"><path d="M0 0 C154.12 0, 308.24 0, 593 0 M0 0 C226.52 0, 453.03 0, 593 0" stroke="#000000" stroke-width="4" fill="none"></path></g></g><mask></mask><g stroke-linecap="round"><g transform="translate(96.23905648697445 289.4062500566962) rotate(0 296.5 0)"><path d="M0 0 C186.27 0, 372.55 0, 593 0 M0 0 C124.57 0, 249.14 0, 593 0" stroke="#000000" stroke-width="4" fill="none"></path></g></g><mask></mask><g stroke-linecap="round" transform="translate(74.23858199654353 117.41175739846568) rotate(0 94.5 124)"><path d="M0 0 L189 0 L189 248 L0 248" stroke="none" stroke-width="0" fill="#ffffff"></path><path d="M0 0 C56.23 0, 112.46 0, 189 0 M0 0 C45.75 0, 91.51 0, 189 0 M189 0 C189 65.76, 189 131.52, 189 248 M189 0 C189 89.9, 189 179.81, 189 248 M189 248 C138.7 248, 88.4 248, 0 248 M189 248 C136.86 248, 84.71 248, 0 248 M0 248 C0 177.92, 0 107.84, 0 0 M0 248 C0 188.56, 0 129.12, 0 0" stroke="#087f5b" stroke-width="4" fill="none"></path></g><g stroke-linecap="round" transform="translate(815.7385819965435 72.41175739846568) rotate(0 113.64043286048252 127.1966305949598)"><path d="M0 0 C67.81 0, 135.62 0, 227.28 0 M0 0 C72.32 0, 144.64 0, 227.28 0 M227.28 0 C227.28 67.46, 227.28 134.91, 227.28 254.39 M227.28 0 C227.28 80.9, 227.28 161.79, 227.28 254.39 M227.28 254.39 C136.79 254.39, 46.31 254.39, 0 254.39 M227.28 254.39 C143.1 254.39, 58.93 254.39, 0 254.39 M0 254.39 C0 173.3, 0 92.21, 0 0 M0 254.39 C0 201.63, 0 148.86, 0 0" stroke="#364fc7" stroke-width="4" fill="none"></path></g><g stroke-linecap="round" transform="translate(266.23858199654353 117.41175739846568) rotate(0 201.5 124)"><path d="M0 0 L403 0 L403 248 L0 248" stroke="none" stroke-width="0" fill="#ffffff"></path><path d="M0 0 C131.75 0, 263.5 0, 403 0 M0 0 C127.55 0, 255.11 0, 403 0 M403 0 C403 68.25, 403 136.5, 403 248 M403 0 C403 58.35, 403 116.69, 403 248 M403 248 C274.03 248, 145.06 248, 0 248 M403 248 C292.61 248, 182.21 248, 0 248 M0 248 C0 184.86, 0 121.73, 0 0 M0 248 C0 177.67, 0 107.33, 0 0" stroke="#d9480f" stroke-width="4" fill="none"></path></g><g stroke-linecap="round"><g transform="translate(266.23858199654353 151.41175739846568) rotate(0 201.5 0)"><path d="M0 0 C97.45 0, 194.89 0, 403 0 M0 0 C106.29 0, 212.58 0, 403 0" stroke="#d9480f" stroke-width="4" fill="none"></path></g></g><mask></mask><g stroke-linecap="round"><g transform="translate(1041.3858192479029 106.41175739846568) rotate(0 -112.57361862567973 0)"><path d="M0 0 C-45.32 0, -90.64 0, -225.15 0 M0 0 C-72.94 0, -145.88 0, -225.15 0" stroke="#364fc7" stroke-width="4" fill="none"></path></g></g><mask></mask><g stroke-linecap="round"><g transform="translate(261.23858199654353 151.41175739846568) rotate(0 -93.5 0)"><path d="M0 0 C-73.91 0, -147.83 0, -187 0 M0 0 C-50.22 0, -100.45 0, -187 0" stroke="#087f5b" stroke-width="4" fill="none"></path></g></g><mask></mask><g transform="translate(428.23858199654353 122.41175739846568) rotate(0 39.5 11.5)"><text x="39.5" y="18" font-family="Helvetica, Segoe UI Emoji" font-size="20px" fill="#d9480f" text-anchor="middle" style="white-space: pre;" direction="ltr">banks(0)</text></g><g transform="translate(133.23858199654353 122.41175739846568) rotate(0 35.5 11.5)"><text x="35.5" y="18" font-family="Helvetica, Segoe UI Emoji" font-size="20px" fill="#087f5b" text-anchor="middle" style="white-space: pre;" direction="ltr">ways(0)</text></g><g stroke-linecap="round"><g transform="translate(74.23858199654353 187.41175739846568) rotate(0 295.7187729459531 0)"><path d="M0 0 C176.39 0, 352.78 0, 591.44 0 M0 0 C199.93 0, 399.87 0, 591.44 0" stroke="#000000" stroke-width="4" fill="none"></path></g></g><mask></mask><g stroke-linecap="round"><g transform="translate(73.73858199654353 222.8117573984657) rotate(0 295.9687729459531 0)"><path d="M0 0 C151.74 0, 303.47 0, 591.94 0 M0 0 C198.33 0, 396.65 0, 591.94 0" stroke="#000000" stroke-width="4" fill="none"></path></g></g><mask></mask><g stroke-linecap="round"><g transform="translate(75.73858199654353 258.2117573984657) rotate(0 294.9687729459531 0)"><path d="M0 0 C142.02 0, 284.03 0, 589.94 0 M0 0 C178.05 0, 356.1 0, 589.94 0" stroke="#000000" stroke-width="4" fill="none"></path></g></g><mask></mask><g stroke-linecap="round"><g transform="translate(74.23858199654353 293.61175739846567) rotate(0 295.88652773529736 0)"><path d="M0 0 C197.34 0, 394.68 0, 591.77 0 M0 0 C235.24 0, 470.48 0, 591.77 0" stroke="#000000" stroke-width="4" fill="none"></path></g></g><mask></mask><g stroke-linecap="round"><g transform="translate(73.73858199654353 329.0117573984657) rotate(0 296.5 0)"><path d="M0 0 C182.09 0, 364.18 0, 593 0 M0 0 C214.86 0, 429.73 0, 593 0" stroke="#000000" stroke-width="4" fill="none"></path></g></g><mask></mask><g stroke-linecap="round"><g transform="translate(138.23858199654353 154.41175739846568) rotate(0 0 104.62051674175346)"><path d="M0 0 C0 75.71, 0 151.42, 0 209.24 M0 0 C0 45.1, 0 90.19, 0 209.24" stroke="#000000" stroke-width="2" fill="none"></path></g></g><mask></mask><g transform="translate(81.50932201951787 161.66175739846568) rotate(0 24.5 9)"><text x="24.5" y="14" font-family="Helvetica, Segoe UI Emoji" font-size="16px" fill="#000000" text-anchor="middle" style="white-space: pre;" direction="ltr">loaded</text></g><g transform="translate(151.14469203100504 161.66175739846568) rotate(0 15.5 9)"><text x="15.5" y="14" font-family="Helvetica, Segoe UI Emoji" font-size="16px" fill="#000000" text-anchor="middle" style="white-space: pre;" direction="ltr">fault</text></g><g transform="translate(199.23858199654353 161.66175739846568) rotate(0 29 9)"><text x="29" y="14" font-family="Helvetica, Segoe UI Emoji" font-size="16px" fill="#000000" text-anchor="middle" style="white-space: pre;" direction="ltr">address</text></g><g stroke-linecap="round"><g transform="translate(193.23858199654353 154.41175739846568) rotate(0 0 104.62051674175346)"><path d="M0 0 C0 71.17, 0 142.35, 0 209.24 M0 0 C0 47.43, 0 94.87, 0 209.24" stroke="#000000" stroke-width="2" fill="none"></path></g></g><mask></mask><g transform="translate(98.98858199654353 192.41175739846568) rotate(0 7 9)"><text x="7" y="14" font-family="Helvetica, Segoe UI Emoji" font-size="16px" fill="#000000" text-anchor="middle" style="white-space: pre;" direction="ltr">...</text></g><g transform="translate(158.73858199654353 192.41175739846568) rotate(0 7 9)"><text x="7" y="14" font-family="Helvetica, Segoe UI Emoji" font-size="16px" fill="#000000" text-anchor="middle" style="white-space: pre;" direction="ltr">...</text></g><g transform="translate(222.98858199654353 192.41175739846568) rotate(0 7 9)"><text x="7" y="14" font-family="Helvetica, Segoe UI Emoji" font-size="16px" fill="#000000" text-anchor="middle" style="white-space: pre;" direction="ltr">...</text></g><g transform="translate(98.23858199654353 224.41175739846568) rotate(0 7 9)"><text x="7" y="14" font-family="Helvetica, Segoe UI Emoji" font-size="16px" fill="#000000" text-anchor="middle" style="white-space: pre;" direction="ltr">...</text></g><g transform="translate(157.98858199654353 224.41175739846568) rotate(0 7 9)"><text x="7" y="14" font-family="Helvetica, Segoe UI Emoji" font-size="16px" fill="#000000" text-anchor="middle" style="white-space: pre;" direction="ltr">...</text></g><g transform="translate(222.23858199654353 224.41175739846568) rotate(0 7 9)"><text x="7" y="14" font-family="Helvetica, Segoe UI Emoji" font-size="16px" fill="#000000" text-anchor="middle" style="white-space: pre;" direction="ltr">...</text></g><g transform="translate(283.73858199654353 160.41175739846568) rotate(0 24.5 9)"><text x="24.5" y="14" font-family="Helvetica, Segoe UI Emoji" font-size="16px" fill="#000000" text-anchor="middle" style="white-space: pre;" direction="ltr">word 0</text></g><g stroke-linecap="round"><g transform="translate(349.23858199654353 153.91175739846568) rotate(0 0 104.3892375318987)"><path d="M0 0 C0 43.06, 0 86.12, 0 208.78 M0 0 C0 72.76, 0 145.52, 0 208.78" stroke="#000000" stroke-width="2" fill="none"></path></g></g><mask></mask><g stroke-linecap="round"><g transform="translate(431.1385819965435 153.91175739846568) rotate(0 0 104.87051674175346)"><path d="M0 0 C0 60.92, 0 121.85, 0 209.74 M0 0 C0 71.7, 0 143.4, 0 209.74" stroke="#000000" stroke-width="2" fill="none"></path></g></g><mask></mask><g stroke-linecap="round"><g transform="translate(583.7385819965435 153.91175739846568) rotate(0 0 105.11115634668081)"><path d="M0 0 C0 83.78, 0 167.56, 0 210.22 M0 0 C0 78.49, 0 156.98, 0 210.22" stroke="#000000" stroke-width="2" fill="none"></path></g></g><mask></mask><g transform="translate(365.73858199654353 160.41175739846568) rotate(0 24.5 9)"><text x="24.5" y="14" font-family="Helvetica, Segoe UI Emoji" font-size="16px" fill="#000000" text-anchor="middle" style="white-space: pre;" direction="ltr">word 1</text></g><g transform="translate(594.7385819965435 160.41175739846568) rotate(0 31.5 9)"><text x="31.5" y="14" font-family="Helvetica, Segoe UI Emoji" font-size="16px" fill="#000000" text-anchor="middle" style="white-space: pre;" direction="ltr">word n-1</text></g><g transform="translate(283.73858199654353 196.41175739846568) rotate(0 24.5 9)"><text x="24.5" y="14" font-family="Helvetica, Segoe UI Emoji" font-size="16px" fill="#000000" text-anchor="middle" style="white-space: pre;" direction="ltr">word n</text></g><g transform="translate(356.73858199654353 196.41175739846568) rotate(0 33.5 9)"><text x="33.5" y="14" font-family="Helvetica, Segoe UI Emoji" font-size="16px" fill="#000000" text-anchor="middle" style="white-space: pre;" direction="ltr">word n+1</text></g><g transform="translate(590.2385819965435 196.41175739846568) rotate(0 36 9)"><text x="36" y="14" font-family="Helvetica, Segoe UI Emoji" font-size="16px" fill="#000000" text-anchor="middle" style="white-space: pre;" direction="ltr">word 2n-1</text></g><g transform="translate(279.23858199654353 231.41175739846568) rotate(0 29 9)"><text x="29" y="14" font-family="Helvetica, Segoe UI Emoji" font-size="16px" fill="#000000" text-anchor="middle" style="white-space: pre;" direction="ltr">word 2n</text></g><g transform="translate(501.73858199654353 160.41175739846568) rotate(0 7 9)"><text x="7" y="14" font-family="Helvetica, Segoe UI Emoji" font-size="16px" fill="#000000" text-anchor="middle" style="white-space: pre;" direction="ltr">...</text></g><g transform="translate(501.73858199654353 196.41175739846568) rotate(0 7 9)"><text x="7" y="14" font-family="Helvetica, Segoe UI Emoji" font-size="16px" fill="#000000" text-anchor="middle" style="white-space: pre;" direction="ltr">...</text></g><g transform="translate(383.23858199654353 231.41175739846568) rotate(0 7 9)"><text x="7" y="14" font-family="Helvetica, Segoe UI Emoji" font-size="16px" fill="#000000" text-anchor="middle" style="white-space: pre;" direction="ltr">...</text></g><g transform="translate(902.379014857026 76.76972595438474) rotate(0 27 11.5)"><text x="27" y="18" font-family="Helvetica, Segoe UI Emoji" font-size="20px" fill="#364fc7" text-anchor="middle" style="white-space: pre;" direction="ltr">status</text></g><g stroke-linecap="round"><g transform="translate(816.576965315979 150.76406929550978) rotate(0 112.40442696596199 0)"><path d="M0 0 C69.86 0, 139.72 0, 224.81 0 M0 0 C54.19 0, 108.38 0, 224.81 0" stroke="#000000" stroke-width="4" fill="none"></path></g></g><mask></mask><g transform="translate(820.9813922819415 119.65172300712385) rotate(0 108 9)"><text x="108" y="14" font-family="Helvetica, Segoe UI Emoji" font-size="16px" fill="#000000" text-anchor="middle" style="white-space: pre;" direction="ltr">Vec (dirty 0, dirty 1, ..., dirty w)</text></g><g stroke-linecap="round"><g transform="translate(816.5769653159791 192.2247185862338) rotate(0 112.40442696596199 0)"><path d="M0 0 C53.89 0, 107.78 0, 224.81 0 M0 0 C69.64 0, 139.29 0, 224.81 0" stroke="#000000" stroke-width="4" fill="none"></path></g></g><mask></mask><g stroke-linecap="round"><g transform="translate(817.4983130779951 237.37075892502185) rotate(0 112.40442696596199 0)"><path d="M0 0 C59.2 0, 118.41 0, 224.81 0 M0 0 C66.7 0, 133.39 0, 224.81 0" stroke="#000000" stroke-width="4" fill="none"></path></g></g><mask></mask><g stroke-linecap="round"><g transform="translate(817.4983130779951 281.5954515017938) rotate(0 112.40442696596199 0)"><path d="M0 0 C46.49 0, 92.98 0, 224.81 0 M0 0 C59.78 0, 119.56 0, 224.81 0" stroke="#000000" stroke-width="4" fill="none"></path></g></g><mask></mask><g stroke-linecap="round"><g transform="translate(877.3859176090406 138.78654838930106) rotate(0 -106.10083873653508 15.662911954273397)"><path d="M0 0 C-14.48 4.61, -51.49 22.42, -86.85 27.64 C-122.22 32.86, -191.31 30.71, -212.2 31.33 M0 0 C-14.48 4.61, -51.49 22.42, -86.85 27.64 C-122.22 32.86, -191.31 30.71, -212.2 31.33" stroke="#364fc7" stroke-width="4" fill="none"></path></g><g transform="translate(877.3859176090406 138.78654838930106) rotate(0 -106.10083873653508 15.662911954273397)"><path d="M-212.2 31.33 L-198.62 24.95 L-198.59 37.63 L-212.2 31.33" stroke="none" stroke-width="0" fill="#364fc7" fill-rule="evenodd"></path><path d="M-212.2 31.33 C-207.3 29.02, -202.39 26.72, -198.62 24.95 M-212.2 31.33 C-208.77 29.71, -205.33 28.1, -198.62 24.95 M-198.62 24.95 C-198.61 30.01, -198.6 35.08, -198.59 37.63 M-198.62 24.95 C-198.62 27.86, -198.61 30.77, -198.59 37.63 M-198.59 37.63 C-201.42 36.32, -204.25 35.01, -212.2 31.33 M-198.59 37.63 C-203.93 35.15, -209.27 32.68, -212.2 31.33 M-212.2 31.33 C-212.2 31.33, -212.2 31.33, -212.2 31.33 M-212.2 31.33 C-212.2 31.33, -212.2 31.33, -212.2 31.33" stroke="#364fc7" stroke-width="4" fill="none"></path></g></g><mask></mask><g stroke-linecap="round"><g transform="translate(910.8403951440665 121.2701618361582) rotate(0 -114.44379760244385 -14.096299691123221)"><path d="M0 0 C-12.27 -5.29, -47.57 -26.85, -73.61 -31.76 C-99.65 -36.67, -130.35 -35.86, -156.23 -29.44 C-182.11 -23.03, -216.78 0.71, -228.89 6.74 M0 0 C-12.27 -5.29, -47.57 -26.85, -73.61 -31.76 C-99.65 -36.67, -130.35 -35.86, -156.23 -29.44 C-182.11 -23.03, -216.78 0.71, -228.89 6.74" stroke="#364fc7" stroke-width="4" fill="none"></path></g><g transform="translate(910.8403951440665 121.2701618361582) rotate(0 -114.44379760244385 -14.096299691123221)"><path d="M-228.89 6.74 L-220.25 -5.53 L-213.94 5.47 L-228.89 6.74" stroke="none" stroke-width="0" fill="#364fc7" fill-rule="evenodd"></path><path d="M-228.89 6.74 C-226.02 2.67, -223.16 -1.4, -220.25 -5.53 M-228.89 6.74 C-227.13 4.24, -225.37 1.74, -220.25 -5.53 M-220.25 -5.53 C-218.34 -2.2, -216.44 1.12, -213.94 5.47 M-220.25 -5.53 C-217.95 -1.51, -215.64 2.51, -213.94 5.47 M-213.94 5.47 C-219.35 5.93, -224.77 6.39, -228.89 6.74 M-213.94 5.47 C-218.65 5.87, -223.35 6.27, -228.89 6.74 M-228.89 6.74 C-228.89 6.74, -228.89 6.74, -228.89 6.74 M-228.89 6.74 C-228.89 6.74, -228.89 6.74, -228.89 6.74" stroke="#364fc7" stroke-width="4" fill="none"></path></g></g><mask></mask><g stroke-linecap="round"><g transform="translate(65.8103075178355 156.41210598167032) rotate(0 -11.918544568214259 51.88241706418482)"><path d="M0 0 C-2.17 2.23, -10.53 -1.23, -13 13.36 C-15.47 27.95, -13.02 72.49, -14.83 87.55 C-16.64 102.62, -22.34 101.06, -23.84 103.76 M0 0 C-2.17 2.23, -10.53 -1.23, -13 13.36 C-15.47 27.95, -13.02 72.49, -14.83 87.55 C-16.64 102.62, -22.34 101.06, -23.84 103.76" stroke="#000000" stroke-width="2" fill="none"></path></g></g><mask></mask><g stroke-linecap="round"><g transform="translate(41.524830989006375 260.2633162398996) rotate(0 12.696119251238628 50.38772925141879)"><path d="M0 0 C1.76 3.3, 8.79 5.39, 10.55 19.78 C12.31 34.16, 8.08 72.79, 10.55 86.29 C13.03 99.79, 22.92 98.36, 25.39 100.78 M0 0 C1.76 3.3, 8.79 5.39, 10.55 19.78 C12.31 34.16, 8.08 72.79, 10.55 86.29 C13.03 99.79, 22.92 98.36, 25.39 100.78" stroke="#000000" stroke-width="2" fill="none"></path></g></g><mask></mask><g transform="translate(-30 243.25155894272666) rotate(270 51.5 11.5)"><text x="51.5" y="18" font-family="Helvetica, Segoe UI Emoji" font-size="20px" fill="#000000" text-anchor="middle" style="white-space: pre;" direction="ltr">linePerWay</text></g><g stroke-linecap="round"><g transform="translate(107.31471903379867 5.894746246896148) rotate(28.617043386373666 -7.4722695955222775 32.52741182885896)"><path d="M0 0 C-1.36 1.4, -6.6 -0.77, -8.15 8.38 C-9.7 17.52, -8.17 45.44, -9.3 54.89 C-10.43 64.34, -14 63.36, -14.94 65.05 M0 0 C-1.36 1.4, -6.6 -0.77, -8.15 8.38 C-9.7 17.52, -8.17 45.44, -9.3 54.89 C-10.43 64.34, -14 63.36, -14.94 65.05" stroke="#000000" stroke-width="2" fill="none"></path></g></g><mask></mask><g stroke-linecap="round"><g transform="translate(61.32853465560527 63.263367165726436) rotate(28.617043386373666 7.95976600323857 31.590325070135464)"><path d="M0 0 C1.1 2.07, 5.51 3.38, 6.62 12.4 C7.72 21.42, 5.07 45.64, 6.62 54.1 C8.17 62.56, 14.37 61.67, 15.92 63.18 M0 0 C1.1 2.07, 5.51 3.38, 6.62 12.4 C7.72 21.42, 5.07 45.64, 6.62 54.1 C8.17 62.56, 14.37 61.67, 15.92 63.18" stroke="#000000" stroke-width="2" fill="none"></path></g></g><mask></mask><g transform="translate(14.077809635959738 43.22114317029974) rotate(299.99999999999994 45 11.5)"><text x="45" y="18" font-family="Helvetica, Segoe UI Emoji" font-size="20px" fill="#000000" text-anchor="middle" style="white-space: pre;" direction="ltr">wayCount</text></g><g stroke-linecap="round"><g transform="translate(382.1811867518841 284.3961361636809) rotate(270 -13.156031539670005 101.11388102584769)"><path d="M0 0 C-2.39 4.34, -11.62 -2.4, -14.35 26.04 C-17.08 54.47, -14.38 141.27, -16.37 170.63 C-18.36 200, -24.66 196.96, -26.31 202.23 M0 0 C-2.39 4.34, -11.62 -2.4, -14.35 26.04 C-17.08 54.47, -14.38 141.27, -16.37 170.63 C-18.36 200, -24.66 196.96, -26.31 202.23" stroke="#000000" stroke-width="2" fill="none"></path></g></g><mask></mask><g stroke-linecap="round"><g transform="translate(554.1090199772606 286.3953672508327) rotate(270 14.399232176375435 98.20087707917654)"><path d="M0 0 C1.99 6.42, 9.97 10.51, 11.97 38.54 C13.96 66.57, 9.16 141.86, 11.97 168.17 C14.77 194.48, 25.99 191.7, 28.8 196.4 M0 0 C1.99 6.42, 9.97 10.51, 11.97 38.54 C13.96 66.57, 9.16 141.86, 11.97 168.17 C14.77 194.48, 25.99 191.7, 28.8 196.4" stroke="#000000" stroke-width="2" fill="none"></path></g></g><mask></mask><g transform="translate(402.76031268879444 408.9680246233027) rotate(0 69 11.5)"><text x="69" y="18" font-family="Helvetica, Segoe UI Emoji" font-size="20px" fill="#000000" text-anchor="middle" style="white-space: pre;" direction="ltr">lineSize (bytes)</text></g><g stroke-linecap="round"><g transform="translate(1075.8803975988508 214.467748757425) rotate(179.58482045885566 -11.918544568214259 51.88241706418482)"><path d="M0 0 C-2.17 2.23, -10.53 -1.23, -13 13.36 C-15.47 27.95, -13.02 72.49, -14.83 87.55 C-16.64 102.62, -22.34 101.06, -23.84 103.76 M0 0 C-2.17 2.23, -10.53 -1.23, -13 13.36 C-15.47 27.95, -13.02 72.49, -14.83 87.55 C-16.64 102.62, -22.34 101.06, -23.84 103.76" stroke="#000000" stroke-width="2" fill="none"></path></g></g><mask></mask><g stroke-linecap="round"><g transform="translate(1050.1948606734 113.6109867407344) rotate(179.58482045885566 12.696119251238656 50.38772925141879)"><path d="M0 0 C1.76 3.3, 8.79 5.39, 10.55 19.78 C12.31 34.16, 8.08 72.79, 10.55 86.29 C13.03 99.79, 22.92 98.36, 25.39 100.78 M0 0 C1.76 3.3, 8.79 5.39, 10.55 19.78 C12.31 34.16, 8.08 72.79, 10.55 86.29 C13.03 99.79, 22.92 98.36, 25.39 100.78" stroke="#000000" stroke-width="2" fill="none"></path></g></g><mask></mask><g transform="translate(1046.8025080059642 203.95217091799196) rotate(89.99999999999994 51.5 11.5)"><text x="51.5" y="18" font-family="Helvetica, Segoe UI Emoji" font-size="20px" fill="#000000" text-anchor="middle" style="white-space: pre;" direction="ltr">linePerWay</text></g></svg>

The cache memory is composed of 3 areas :
- `banks` area for data
- `ways` area for tag
- `status` area for dirty bit

To define the cache architecture, there is several parameters :
- Firstly, arguments of `DataCache` component.
	- `lineSize` : size of a cache line (in bytes)
	- `cacheSize` : size of the cache (in bytes)
	- `wayCount` : number of ways
	- `memDataWidth` : memory bus data width
- The following parameters are then calculated from these arguments :
	- `linePerWay` : number of cache line in each way
		- `linePerWay` = (`cacheSize`/`wayCount`) / `lineSize`
	- `bankWordCount` : number of words in each way
		- `bankWordCount` = ((`cacheSize`/`wayCount`) * 8) / `memDataWidth`
	- `bankWordPerLine` : number of words in a cache line
		- `bankWordPerLine` = (`lineSize` * 8) / `memDataWidth`

###### banks

This is a list of `wayCount` areas where the data are stored.
Each area corresponds to a way :
- `banks(0)` -> way 0
- `banks(1)` -> way 1
- ...

The main field is `mem`, which is the data memory of length `bankWordCount`.

<svg version="1.1" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 664.4601817321044 348.4918733426697" width="664.4601817321044" height="348.4918733426697">
  <!-- svg-source:excalidraw -->
  
  <defs>
    <style class="style-fonts">
      @font-face {
        font-family: "Virgil";
        src: url("https://excalidraw.com/Virgil.woff2");
      }
      @font-face {
        font-family: "Cascadia";
        src: url("https://excalidraw.com/Cascadia.woff2");
      }
    </style>
  </defs>
  <rect x="0" y="0" width="664.4601817321044" height="348.4918733426697" fill="#ffffff"></rect><g stroke-linecap="round" transform="translate(219.49497177784087 10) rotate(0 114.06993372090051 125.26371226360578)"><path d="M0 0 C76.86 0, 153.72 0, 228.14 0 M0 0 C74.31 0, 148.61 0, 228.14 0 M228.14 0 C228.14 73.5, 228.14 147, 228.14 250.53 M228.14 0 C228.14 88.93, 228.14 177.86, 228.14 250.53 M228.14 250.53 C179.49 250.53, 130.84 250.53, 0 250.53 M228.14 250.53 C156.54 250.53, 84.95 250.53, 0 250.53 M0 250.53 C0 151.77, 0 53.01, 0 0 M0 250.53 C0 198.03, 0 145.53, 0 0" stroke="#000000" stroke-width="4" fill="none"></path></g><g stroke-linecap="round"><g transform="translate(219.49497177784087 41.98222440772906) rotate(0 113.53689664743843 0)"><path d="M0 0 C62.86 0, 125.73 0, 227.07 0 M0 0 C46.48 0, 92.97 0, 227.07 0" stroke="#000000" stroke-width="4" fill="none"></path></g></g><mask></mask><g stroke-linecap="round"><g transform="translate(220.5610459247651 72.89837466853385) rotate(0 112.47082250051412 0)"><path d="M0 0 C45.53 0, 91.06 0, 224.94 0 M0 0 C72.3 0, 144.59 0, 224.94 0" stroke="#000000" stroke-width="4" fill="none"></path></g></g><mask></mask><g stroke-linecap="round"><g transform="translate(219.49497177784093 103.81452492933875) rotate(0 113.5368966474384 0)"><path d="M0 0 C74.89 0, 149.78 0, 227.07 0 M0 0 C88.23 0, 176.45 0, 227.07 0" stroke="#000000" stroke-width="4" fill="none"></path></g></g><mask></mask><g stroke-linecap="round"><g transform="translate(220.5610459247652 135.7967493370678) rotate(0 111.93778542705192 0)"><path d="M0 0 C56.85 0, 113.7 0, 223.88 0 M0 0 C62.67 0, 125.35 0, 223.88 0" stroke="#000000" stroke-width="4" fill="none"></path></g></g><mask></mask><g stroke-linecap="round"><g transform="translate(219.4949717778407 167.77897374479699) rotate(0 113.00385957397631 0)"><path d="M0 0 C65.33 0, 130.67 0, 226.01 0 M0 0 C68.13 0, 136.26 0, 226.01 0" stroke="#000000" stroke-width="4" fill="none"></path></g></g><mask></mask><g stroke-linecap="round"><g transform="translate(219.4949717778407 198.69512400560166) rotate(0 113.53689664743851 0)"><path d="M0 0 C55.28 0, 110.56 0, 227.07 0 M0 0 C76.07 0, 152.14 0, 227.07 0" stroke="#000000" stroke-width="4" fill="none"></path></g></g><mask></mask><g transform="translate(303.0649054987414 14.85896391001586) rotate(0 30.5 11.5)"><text x="30.5" y="18" font-family="Helvetica, Segoe UI Emoji" font-size="20px" fill="#000000" text-anchor="middle" style="white-space: pre;" direction="ltr">word 0</text></g><g transform="translate(303.0649054987414 45.77511417082076) rotate(0 30.5 11.5)"><text x="30.5" y="18" font-family="Helvetica, Segoe UI Emoji" font-size="20px" fill="#000000" text-anchor="middle" style="white-space: pre;" direction="ltr">word 1</text></g><g transform="translate(294.0649054987414 108.67348883935472) rotate(0 39.5 11.5)"><text x="39.5" y="18" font-family="Helvetica, Segoe UI Emoji" font-size="20px" fill="#000000" text-anchor="middle" style="white-space: pre;" direction="ltr">word n-1</text></g><g transform="translate(303.0649054987414 139.5896391001594) rotate(0 30.5 11.5)"><text x="30.5" y="18" font-family="Helvetica, Segoe UI Emoji" font-size="20px" fill="#000000" text-anchor="middle" style="white-space: pre;" direction="ltr">word n</text></g><g transform="translate(252.06490549874138 205.6862362094663) rotate(0 81.5 23)"><text x="81.5" y="18" font-family="Helvetica, Segoe UI Emoji" font-size="20px" fill="#000000" text-anchor="middle" style="white-space: pre;" direction="ltr">word </text><text x="81.5" y="41" font-family="Helvetica, Segoe UI Emoji" font-size="20px" fill="#000000" text-anchor="middle" style="white-space: pre;" direction="ltr">bankWordCount-1</text></g><g transform="translate(324.5649054987414 77.75733857854993) rotate(0 9 11.5)"><text x="9" y="18" font-family="Helvetica, Segoe UI Emoji" font-size="20px" fill="#000000" text-anchor="middle" style="white-space: pre;" direction="ltr">...</text></g><g transform="translate(324.5649054987414 173.70401180173712) rotate(0 9 11.5)"><text x="9" y="18" font-family="Helvetica, Segoe UI Emoji" font-size="20px" fill="#000000" text-anchor="middle" style="white-space: pre;" direction="ltr">...</text></g><g stroke-linecap="round"><g transform="translate(486.01350850891697 12.132148293848559) rotate(0 0 124.19763811668145)"><path d="M0 0 C0 82.49, 0 164.99, 0 248.4 M0 0 C0 59.89, 0 119.77, 0 248.4" stroke="#000000" stroke-width="4" fill="none"></path></g><g transform="translate(486.01350850891697 12.132148293848559) rotate(0 0 124.19763811668145)"><path d="M0 0 L6.34 13.59 L-6.34 13.59 L0 0" stroke="none" stroke-width="0" fill="#000000" fill-rule="evenodd"></path><path d="M0 0 C2.11 4.51, 4.21 9.03, 6.34 13.59 M0 0 C1.53 3.28, 3.06 6.56, 6.34 13.59 M6.34 13.59 C3.26 13.59, 0.17 13.59, -6.34 13.59 M6.34 13.59 C2.58 13.59, -1.18 13.59, -6.34 13.59 M-6.34 13.59 C-4.23 9.07, -2.12 4.54, 0 0 M-6.34 13.59 C-4.12 8.84, -1.91 4.09, 0 0 M0 0 C0 0, 0 0, 0 0 M0 0 C0 0, 0 0, 0 0" stroke="#000000" stroke-width="4" fill="none"></path></g><g transform="translate(486.01350850891697 12.132148293848559) rotate(0 0 124.19763811668145)"><path d="M0 248.4 L-6.34 234.8 L6.34 234.8 L0 248.4" stroke="none" stroke-width="0" fill="#000000" fill-rule="evenodd"></path><path d="M0 248.4 C-2.11 243.88, -4.21 239.37, -6.34 234.8 M0 248.4 C-1.53 245.12, -3.06 241.84, -6.34 234.8 M-6.34 234.8 C-3.26 234.8, -0.17 234.8, 6.34 234.8 M-6.34 234.8 C-2.58 234.8, 1.18 234.8, 6.34 234.8 M6.34 234.8 C4.23 239.33, 2.12 243.85, 0 248.4 M6.34 234.8 C4.12 239.55, 1.91 244.3, 0 248.4 M0 248.4 C0 248.4, 0 248.4, 0 248.4 M0 248.4 C0 248.4, 0 248.4, 0 248.4" stroke="#000000" stroke-width="4" fill="none"></path></g></g><mask></mask><g stroke-linecap="round"><g transform="translate(221.62712007168955 293.5757230818648) rotate(0 111.93778542705189 0)"><path d="M0 0 C69.73 0, 139.46 0, 223.88 0 M0 0 C83.21 0, 166.42 0, 223.88 0" stroke="#000000" stroke-width="4" fill="none"></path></g><g transform="translate(221.62712007168955 293.5757230818648) rotate(0 111.93778542705189 0)"><path d="M0 0 L13.59 -6.34 L13.59 6.34 L0 0" stroke="none" stroke-width="0" fill="#000000" fill-rule="evenodd"></path><path d="M0 0 C4.23 -1.97, 8.47 -3.95, 13.59 -6.34 M0 0 C5.05 -2.36, 10.11 -4.71, 13.59 -6.34 M13.59 -6.34 C13.59 -3.14, 13.59 0.05, 13.59 6.34 M13.59 -6.34 C13.59 -3.25, 13.59 -0.15, 13.59 6.34 M13.59 6.34 C8.97 4.18, 4.34 2.02, 0 0 M13.59 6.34 C10.05 4.69, 6.51 3.04, 0 0 M0 0 C0 0, 0 0, 0 0 M0 0 C0 0, 0 0, 0 0" stroke="#000000" stroke-width="4" fill="none"></path></g><g transform="translate(221.62712007168955 293.5757230818648) rotate(0 111.93778542705189 0)"><path d="M223.88 0 L210.28 6.34 L210.28 -6.34 L223.88 0" stroke="none" stroke-width="0" fill="#000000" fill-rule="evenodd"></path><path d="M223.88 0 C219.64 1.97, 215.41 3.95, 210.28 6.34 M223.88 0 C218.82 2.36, 213.77 4.71, 210.28 6.34 M210.28 6.34 C210.28 3.14, 210.28 -0.05, 210.28 -6.34 M210.28 6.34 C210.28 3.25, 210.28 0.15, 210.28 -6.34 M210.28 -6.34 C214.91 -4.18, 219.54 -2.02, 223.88 0 M210.28 -6.34 C213.82 -4.69, 217.37 -3.04, 223.88 0 M223.88 0 C223.88 0, 223.88 0, 223.88 0 M223.88 0 C223.88 0, 223.88 0, 223.88 0" stroke="#000000" stroke-width="4" fill="none"></path></g></g><mask></mask><g transform="translate(509.4601817321044 115.06993372090051) rotate(0 72.5 11.5)"><text x="72.5" y="18" font-family="Helvetica, Segoe UI Emoji" font-size="20px" fill="#000000" text-anchor="middle" style="white-space: pre;" direction="ltr">bankWordCount</text></g><g transform="translate(269.395276233363 315.4918733426697) rotate(0 69.5 11.5)"><text x="69.5" y="18" font-family="Helvetica, Segoe UI Emoji" font-size="20px" fill="#000000" text-anchor="middle" style="white-space: pre;" direction="ltr">memDataWidth</text></g><g stroke-linecap="round"><g transform="translate(184.3145249293389 12.132148293848559) rotate(0 -1.4210854715202004e-14 59.16711515429887)"><path d="M0 0 C0 31.94, 0 63.88, 0 118.33 M0 0 C0 45.23, 0 90.45, 0 118.33" stroke="#000000" stroke-width="4" fill="none"></path></g><g transform="translate(184.3145249293389 12.132148293848559) rotate(0 -1.4210854715202004e-14 59.16711515429887)"><path d="M0 0 L6.34 13.59 L-6.34 13.59 L0 0" stroke="none" stroke-width="0" fill="#000000" fill-rule="evenodd"></path><path d="M0 0 C1.71 3.67, 3.42 7.34, 6.34 13.59 M0 0 C2.42 5.2, 4.85 10.39, 6.34 13.59 M6.34 13.59 C3.56 13.59, 0.78 13.59, -6.34 13.59 M6.34 13.59 C2.9 13.59, -0.55 13.59, -6.34 13.59 M-6.34 13.59 C-4.15 8.9, -1.96 4.2, 0 0 M-6.34 13.59 C-4.97 10.65, -3.59 7.7, 0 0 M0 0 C0 0, 0 0, 0 0 M0 0 C0 0, 0 0, 0 0" stroke="#000000" stroke-width="4" fill="none"></path></g><g transform="translate(184.3145249293389 12.132148293848559) rotate(0 -1.4210854715202004e-14 59.16711515429887)"><path d="M0 118.33 L-6.34 104.74 L6.34 104.74 L0 118.33" stroke="none" stroke-width="0" fill="#000000" fill-rule="evenodd"></path><path d="M0 118.33 C-1.71 114.67, -3.42 111, -6.34 104.74 M0 118.33 C-2.42 113.14, -4.85 107.94, -6.34 104.74 M-6.34 104.74 C-3.56 104.74, -0.78 104.74, 6.34 104.74 M-6.34 104.74 C-2.9 104.74, 0.55 104.74, 6.34 104.74 M6.34 104.74 C4.15 109.44, 1.96 114.14, 0 118.33 M6.34 104.74 C4.97 107.69, 3.59 110.63, 0 118.33 M0 118.33 C0 118.33, 0 118.33, 0 118.33 M0 118.33 C0 118.33, 0 118.33, 0 118.33" stroke="#000000" stroke-width="4" fill="none"></path></g></g><mask></mask><g transform="translate(10 59.63407808083673) rotate(0 80.5 11.5)"><text x="80.5" y="18" font-family="Helvetica, Segoe UI Emoji" font-size="20px" fill="#000000" text-anchor="middle" style="white-space: pre;" direction="ltr">bankWordPerLine</text></g></svg>
  
`mem` is not an array with a cache line width. There is a word of width `memDataWidth` in each line.
So several `mem` lines are used to form a cache line, `bankWordPerLine` lines more precisely

Two ports are declared in `banks` :
- `write` : to store data in `mem` memory
	- This port has a mask field, if you want to store only part of a word, such as a byte.
- `read` : to read data in `mem` memory
	- This port is split into two, a `cmd` port for sending the address, and a `rsp` port for receiving the data read.
	- There is also a variable called `usedByWriteBack` which prevents the load pipeline from reading the bank when it is being used by a `writeback` slot.

As we are writing or reading a line, i.e. a word, if we want to read/write an entire line of cache, we need to send several `read`/`write` commands. `bankWordPerLine` commands more precisely.

###### ways

As `banks`, this is a list of `wayCount` areas where the tags are stored.
Each area corresponds to a way :
- `ways(0)` -> way 0
- `ways(1)` -> way 1
- ...

The main field is `mem`, which is the tags memory of length `linePerWay`.
Each `mem` line is linked to a data cache line.
In each line, in addition to the tag, which is in `address` field, we have the following fields :
- `loaded` : to know whether the cache line is valid
- `fault` : to know whether the cache line is faulty
The 3 fields form the `Tag` object.

Two read ports are declared in `ways` :
- `loadRead` : to read tag from `mem` memory into `load` pipeline
	- This port is split into two, a `cmd` port for sending the address, and a `rsp` port for receiving the `Tag` object read.
- `storeRead` : to read tag from `mem` memory into `store` pipeline
	- This port is split into two, a `cmd` port for sending the address, and a `rsp` port for receiving the `Tag` object read.
We have these two read ports to enable tags to be read in parallel from both pipelines.

The `ways` memory can be built with LUTs, i.e. distributed RAM, or with block RAM. 
Depending on this choice : 
- the `Tag` object is read asynchronously, i.e. the read command is sent and we receive the response in the same clock cycle.
- the `Tag` object is read asynchronously, i.e. the read command is sent and we receive the response 1 clock cycle later.
> By default, we use distributed RAM for `ways`

To write in `ways`, we use an area defined outside, `waysWrite`.
This area has 3 fields :
- `address` : the cache line address
- `tag` : the `Tag` object to be written, we can write one or more sub-fields(`loaded`, `fault`, `address`) of this object by defining them
- `mask` : to define in which `ways` we want to write

###### status

Here, there is only one area, and it stores the dirty bits.

The main field is `mem`, which is the dirty bits memory of length `linePerWay`.
In each line, a vector stores the dirty bits of each way for a given cache line.
That's why we only have one `status` area for several ways.

3 ports are declared in `ways` :
- `loadRead` : to read the dirty bit vector from `mem` memory into the `load` pipeline.
	- This port is split into two, a `cmd` port for sending the address, and a `rsp` port for receiving the dirty bit vector read.
- `storeRead` : to read the dirty bit vector from `mem` memory into the `store` pipeline.
	- This port is split into two, a `cmd` port for sending the address, and a `rsp` port for receiving the dirty bit vector read.
We have two read ports to enable tags to be read in parallel from both pipelines.
- `write` : to write the dirty bit vector in `mem` memory

The `status` memory can be built with LUTs, i.e. distributed RAM, or with block RAM. 
Depending on this choice : 
- the dirty bit vector is read asynchronously, i.e. the read command is sent and we receive the response in the same clock cycle.
- the dirty bit vector is read asynchronously, i.e. the read command is sent and we receive the response 1 clock cycle later.
> By default, we use distributed RAM for `status`

Finally, the `bypass` function is set to update the `STATUS` stageable with the dirty bit vector being written, instead of the dirty bit vector that was read.
___
#### Load pipeline

<svg version="1.1" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 1077.472635963924 1071.7899295951393" width="1077.472635963924" height="1071.7899295951393">
  <!-- svg-source:excalidraw -->
  
  <defs>
    <style class="style-fonts">
      @font-face {
        font-family: "Virgil";
        src: url("https://excalidraw.com/Virgil.woff2");
      }
      @font-face {
        font-family: "Cascadia";
        src: url("https://excalidraw.com/Cascadia.woff2");
      }
    </style>
  </defs>
  <rect x="0" y="0" width="1077.472635963924" height="1071.7899295951393" fill="#ffffff"></rect><g stroke-linecap="round"><g transform="translate(207.53214831082497 135.39713925177705) rotate(0 220.74547950392068 427.8509388690844)"><path d="M0 0 C89.92 1.79, 448.82 -5.79, 539.49 10.72 C630.16 27.24, 652.18 81.8, 544.02 99.08 C435.87 116.35, 1.31 78.3, -109.43 114.38 C-220.17 150.45, -229.48 278.1, -120.45 315.55 C-11.41 353, 434.06 316.84, 544.79 339.08 C655.51 361.31, 651.79 427.89, 543.9 448.96 C436.01 470.03, 5.93 434.21, -102.55 465.48 C-211.03 496.76, -218.56 605.45, -106.96 636.62 C4.63 667.79, 454.24 619.72, 567.01 652.5 C679.78 685.29, 643.94 799.5, 569.66 833.35 C495.37 867.19, 196.03 851.87, 121.31 855.58 M0 0 C89.92 1.79, 448.82 -5.79, 539.49 10.72 C630.16 27.24, 652.18 81.8, 544.02 99.08 C435.87 116.35, 1.31 78.3, -109.43 114.38 C-220.17 150.45, -229.48 278.1, -120.45 315.55 C-11.41 353, 434.06 316.84, 544.79 339.08 C655.51 361.31, 651.79 427.89, 543.9 448.96 C436.01 470.03, 5.93 434.21, -102.55 465.48 C-211.03 496.76, -218.56 605.45, -106.96 636.62 C4.63 667.79, 454.24 619.72, 567.01 652.5 C679.78 685.29, 643.94 799.5, 569.66 833.35 C495.37 867.19, 196.03 851.87, 121.31 855.58" stroke="#364fc7" stroke-width="4" fill="none"></path></g><g transform="translate(207.53214831082497 135.39713925177705) rotate(0 220.74547950392068 427.8509388690844)"><path d="M121.31 855.58 L134.9 849.24 L134.9 861.91 L121.31 855.58" stroke="none" stroke-width="0" fill="#364fc7" fill-rule="evenodd"></path><path d="M121.31 855.58 C124.95 853.88, 128.6 852.18, 134.9 849.24 M121.31 855.58 C126.39 853.21, 131.47 850.84, 134.9 849.24 M134.9 849.24 C134.9 853.93, 134.9 858.62, 134.9 861.91 M134.9 849.24 C134.9 852.77, 134.9 856.3, 134.9 861.91 M134.9 861.91 C131.44 860.3, 127.98 858.69, 121.31 855.58 M134.9 861.91 C129.52 859.4, 124.13 856.89, 121.31 855.58 M121.31 855.58 C121.31 855.58, 121.31 855.58, 121.31 855.58 M121.31 855.58 C121.31 855.58, 121.31 855.58, 121.31 855.58" stroke="#364fc7" stroke-width="4" fill="none"></path></g></g><mask></mask><g stroke-linecap="round" transform="translate(271.0331593793853 114.73879145189755) rotate(0 74.5 20.5)"><path d="M10.25 0 L138.75 0 L143.23 0.64 L146.44 2.56 L148.36 5.77 L149 10.25 L149 30.75 L148.36 35.23 L146.44 38.44 L143.23 40.36 L138.75 41 L10.25 41 L5.77 40.36 L2.56 38.44 L0.64 35.23 L0 30.75 L0 10.25 L0.64 5.77 L2.56 2.56 L5.77 0.64 L10.25 0" stroke="none" stroke-width="0" fill="#82c91e"></path><path d="M10.25 0 M10.25 0 C53.07 0, 95.89 0, 138.75 0 M10.25 0 C41.72 0, 73.19 0, 138.75 0 M138.75 0 C145.58 0, 149 3.42, 149 10.25 M138.75 0 C145.58 0, 149 3.42, 149 10.25 M149 10.25 C149 14.76, 149 19.27, 149 30.75 M149 10.25 C149 18.32, 149 26.38, 149 30.75 M149 30.75 C149 37.58, 145.58 41, 138.75 41 M149 30.75 C149 37.58, 145.58 41, 138.75 41 M138.75 41 C107.69 41, 76.63 41, 10.25 41 M138.75 41 C101.77 41, 64.79 41, 10.25 41 M10.25 41 C3.42 41, 0 37.58, 0 30.75 M10.25 41 C3.42 41, 0 37.58, 0 30.75 M0 30.75 C0 24.71, 0 18.67, 0 10.25 M0 30.75 C0 25.84, 0 20.93, 0 10.25 M0 10.25 C0 3.42, 3.42 0, 10.25 0 M0 10.25 C0 3.42, 3.42 0, 10.25 0" stroke="#000000" stroke-width="4" fill="none"></path></g><g transform="translate(308.5331593793853 123.73879145189755) rotate(0 37 11.5)"><text x="37" y="18" font-family="Helvetica, Segoe UI Emoji" font-size="20px" fill="#000000" text-anchor="middle" style="white-space: pre;" direction="ltr">stage(0)</text></g><g stroke-linecap="round" transform="translate(457.90382637966576 114.73879145189755) rotate(0 113.5 20.5)"><path d="M10.25 0 L216.75 0 L221.23 0.64 L224.44 2.56 L226.36 5.77 L227 10.25 L227 30.75 L226.36 35.23 L224.44 38.44 L221.23 40.36 L216.75 41 L10.25 41 L5.77 40.36 L2.56 38.44 L0.64 35.23 L0 30.75 L0 10.25 L0.64 5.77 L2.56 2.56 L5.77 0.64 L10.25 0" stroke="none" stroke-width="0" fill="#82c91e"></path><path d="M10.25 0 M10.25 0 C81.04 0, 151.83 0, 216.75 0 M10.25 0 C91.94 0, 173.62 0, 216.75 0 M216.75 0 C223.58 0, 227 3.42, 227 10.25 M216.75 0 C223.58 0, 227 3.42, 227 10.25 M227 10.25 C227 14.54, 227 18.84, 227 30.75 M227 10.25 C227 15.56, 227 20.87, 227 30.75 M227 30.75 C227 37.58, 223.58 41, 216.75 41 M227 30.75 C227 37.58, 223.58 41, 216.75 41 M216.75 41 C160.72 41, 104.69 41, 10.25 41 M216.75 41 C175.19 41, 133.64 41, 10.25 41 M10.25 41 C3.42 41, 0 37.58, 0 30.75 M10.25 41 C3.42 41, 0 37.58, 0 30.75 M0 30.75 C0 26.34, 0 21.93, 0 10.25 M0 30.75 C0 22.96, 0 15.17, 0 10.25 M0 10.25 C0 3.42, 3.42 0, 10.25 0 M0 10.25 C0 3.42, 3.42 0, 10.25 0" stroke="#000000" stroke-width="4" fill="none"></path></g><g transform="translate(484.90382637966576 123.73879145189755) rotate(0 86.5 11.5)"><text x="86.5" y="18" font-family="Helvetica, Segoe UI Emoji" font-size="20px" fill="#000000" text-anchor="middle" style="white-space: pre;" direction="ltr">readBanksStage(0)</text></g><g transform="translate(35.76949936983755 116.47446172478874) rotate(0 78.5 17.5)"><text x="0" y="25" font-family="Virgil, Segoe UI Emoji" font-size="28px" fill="#364fc7" text-anchor="start" style="white-space: pre;" direction="ltr">load.pipeline</text></g><g stroke-linecap="round" transform="translate(457.90382637966576 217.81194025484808) rotate(0 129.5 20.5)"><path d="M10.25 0 L248.75 0 L253.23 0.64 L256.44 2.56 L258.36 5.77 L259 10.25 L259 30.75 L258.36 35.23 L256.44 38.44 L253.23 40.36 L248.75 41 L10.25 41 L5.77 40.36 L2.56 38.44 L0.64 35.23 L0 30.75 L0 10.25 L0.64 5.77 L2.56 2.56 L5.77 0.64 L10.25 0" stroke="none" stroke-width="0" fill="#40c057"></path><path d="M10.25 0 M10.25 0 C97.03 0, 183.81 0, 248.75 0 M10.25 0 C102.88 0, 195.51 0, 248.75 0 M248.75 0 C255.58 0, 259 3.42, 259 10.25 M248.75 0 C255.58 0, 259 3.42, 259 10.25 M259 10.25 C259 16.2, 259 22.14, 259 30.75 M259 10.25 C259 17.81, 259 25.38, 259 30.75 M259 30.75 C259 37.58, 255.58 41, 248.75 41 M259 30.75 C259 37.58, 255.58 41, 248.75 41 M248.75 41 C195.67 41, 142.59 41, 10.25 41 M248.75 41 C188.7 41, 128.65 41, 10.25 41 M10.25 41 C3.42 41, 0 37.58, 0 30.75 M10.25 41 C3.42 41, 0 37.58, 0 30.75 M0 30.75 C0 25.91, 0 21.08, 0 10.25 M0 30.75 C0 25.56, 0 20.36, 0 10.25 M0 10.25 C0 3.42, 3.42 0, 10.25 0 M0 10.25 C0 3.42, 3.42 0, 10.25 0" stroke="#000000" stroke-width="4" fill="none"></path></g><g transform="translate(483.90382637966576 226.81194025484808) rotate(0 103.5 11.5)"><text x="103.5" y="18" font-family="Helvetica, Segoe UI Emoji" font-size="20px" fill="#000000" text-anchor="middle" style="white-space: pre;" direction="ltr">readBanksStage + 1(1)</text></g><g stroke-linecap="round" transform="translate(193.03315937938532 217.81194025484808) rotate(0 113.5 20.5)"><path d="M10.25 0 L216.75 0 L221.23 0.64 L224.44 2.56 L226.36 5.77 L227 10.25 L227 30.75 L226.36 35.23 L224.44 38.44 L221.23 40.36 L216.75 41 L10.25 41 L5.77 40.36 L2.56 38.44 L0.64 35.23 L0 30.75 L0 10.25 L0.64 5.77 L2.56 2.56 L5.77 0.64 L10.25 0" stroke="none" stroke-width="0" fill="#40c057"></path><path d="M10.25 0 M10.25 0 C63.95 0, 117.66 0, 216.75 0 M10.25 0 C68.29 0, 126.34 0, 216.75 0 M216.75 0 C223.58 0, 227 3.42, 227 10.25 M216.75 0 C223.58 0, 227 3.42, 227 10.25 M227 10.25 C227 14.83, 227 19.42, 227 30.75 M227 10.25 C227 14.87, 227 19.48, 227 30.75 M227 30.75 C227 37.58, 223.58 41, 216.75 41 M227 30.75 C227 37.58, 223.58 41, 216.75 41 M216.75 41 C174.87 41, 132.99 41, 10.25 41 M216.75 41 C153.59 41, 90.43 41, 10.25 41 M10.25 41 C3.42 41, 0 37.58, 0 30.75 M10.25 41 C3.42 41, 0 37.58, 0 30.75 M0 30.75 C0 22.88, 0 15.01, 0 10.25 M0 30.75 C0 24.73, 0 18.71, 0 10.25 M0 10.25 C0 3.42, 3.42 0, 10.25 0 M0 10.25 C0 3.42, 3.42 0, 10.25 0" stroke="#000000" stroke-width="4" fill="none"></path></g><g transform="translate(226.53315937938532 226.81194025484808) rotate(0 80 11.5)"><text x="80" y="18" font-family="Helvetica, Segoe UI Emoji" font-size="20px" fill="#000000" text-anchor="middle" style="white-space: pre;" direction="ltr">readTagsStage(1)</text></g><g stroke-linecap="round" transform="translate(140.56654041214148 444.96939262009425) rotate(0 113.5 20.5)"><path d="M10.25 0 L216.75 0 L221.23 0.64 L224.44 2.56 L226.36 5.77 L227 10.25 L227 30.75 L226.36 35.23 L224.44 38.44 L221.23 40.36 L216.75 41 L10.25 41 L5.77 40.36 L2.56 38.44 L0.64 35.23 L0 30.75 L0 10.25 L0.64 5.77 L2.56 2.56 L5.77 0.64 L10.25 0" stroke="none" stroke-width="0" fill="#40c057"></path><path d="M10.25 0 M10.25 0 C66.44 0, 122.63 0, 216.75 0 M10.25 0 C51.57 0, 92.88 0, 216.75 0 M216.75 0 C223.58 0, 227 3.42, 227 10.25 M216.75 0 C223.58 0, 227 3.42, 227 10.25 M227 10.25 C227 15.05, 227 19.84, 227 30.75 M227 10.25 C227 15.02, 227 19.79, 227 30.75 M227 30.75 C227 37.58, 223.58 41, 216.75 41 M227 30.75 C227 37.58, 223.58 41, 216.75 41 M216.75 41 C167.43 41, 118.11 41, 10.25 41 M216.75 41 C160.61 41, 104.47 41, 10.25 41 M10.25 41 C3.42 41, 0 37.58, 0 30.75 M10.25 41 C3.42 41, 0 37.58, 0 30.75 M0 30.75 C0 24.69, 0 18.62, 0 10.25 M0 30.75 C0 24.26, 0 17.78, 0 10.25 M0 10.25 C0 3.42, 3.42 0, 10.25 0 M0 10.25 C0 3.42, 3.42 0, 10.25 0" stroke="#000000" stroke-width="4" fill="none"></path></g><g transform="translate(171.06654041214148 453.96939262009425) rotate(0 83 11.5)"><text x="83" y="18" font-family="Helvetica, Segoe UI Emoji" font-size="20px" fill="#000000" text-anchor="middle" style="white-space: pre;" direction="ltr">translatedStage(1)</text></g><g stroke-linecap="round" transform="translate(398.8816779865666 444.96939262009414) rotate(0 73 20.500000000000057)"><path d="M10.25 0 L135.75 0 L140.23 0.64 L143.44 2.56 L145.36 5.77 L146 10.25 L146 30.75 L145.36 35.23 L143.44 38.44 L140.23 40.36 L135.75 41 L10.25 41 L5.77 40.36 L2.56 38.44 L0.64 35.23 L0 30.75 L0 10.25 L0.64 5.77 L2.56 2.56 L5.77 0.64 L10.25 0" stroke="none" stroke-width="0" fill="#40c057"></path><path d="M10.25 0 M10.25 0 C45.82 0, 81.39 0, 135.75 0 M10.25 0 C55.93 0, 101.61 0, 135.75 0 M135.75 0 C142.58 0, 146 3.42, 146 10.25 M135.75 0 C142.58 0, 146 3.42, 146 10.25 M146 10.25 C146 18.2, 146 26.15, 146 30.75 M146 10.25 C146 14.64, 146 19.02, 146 30.75 M146 30.75 C146 37.58, 142.58 41, 135.75 41 M146 30.75 C146 37.58, 142.58 41, 135.75 41 M135.75 41 C92.87 41, 50 41, 10.25 41 M135.75 41 C104.32 41, 72.89 41, 10.25 41 M10.25 41 C3.42 41, 0 37.58, 0 30.75 M10.25 41 C3.42 41, 0 37.58, 0 30.75 M0 30.75 C0 24.35, 0 17.95, 0 10.25 M0 30.75 C0 23.44, 0 16.13, 0 10.25 M0 10.25 C0 3.42, 3.42 0, 10.25 0 M0 10.25 C0 3.42, 3.42 0, 10.25 0" stroke="#000000" stroke-width="4" fill="none"></path></g><g transform="translate(417.3816779865666 453.969392620094) rotate(0 54.5 11.5)"><text x="54.5" y="18" font-family="Helvetica, Segoe UI Emoji" font-size="20px" fill="#000000" text-anchor="middle" style="white-space: pre;" direction="ltr">hitsStage(1)</text></g><g stroke-linecap="round" transform="translate(579.7286723347854 444.96939262009425) rotate(0 65.5 20.5)"><path d="M10.25 0 L120.75 0 L125.23 0.64 L128.44 2.56 L130.36 5.77 L131 10.25 L131 30.75 L130.36 35.23 L128.44 38.44 L125.23 40.36 L120.75 41 L10.25 41 L5.77 40.36 L2.56 38.44 L0.64 35.23 L0 30.75 L0 10.25 L0.64 5.77 L2.56 2.56 L5.77 0.64 L10.25 0" stroke="none" stroke-width="0" fill="#40c057"></path><path d="M10.25 0 M10.25 0 C35.49 0, 60.74 0, 120.75 0 M10.25 0 C39.64 0, 69.04 0, 120.75 0 M120.75 0 C127.58 0, 131 3.42, 131 10.25 M120.75 0 C127.58 0, 131 3.42, 131 10.25 M131 10.25 C131 14.94, 131 19.63, 131 30.75 M131 10.25 C131 16.8, 131 23.36, 131 30.75 M131 30.75 C131 37.58, 127.58 41, 120.75 41 M131 30.75 C131 37.58, 127.58 41, 120.75 41 M120.75 41 C85.73 41, 50.7 41, 10.25 41 M120.75 41 C91.04 41, 61.32 41, 10.25 41 M10.25 41 C3.42 41, 0 37.58, 0 30.75 M10.25 41 C3.42 41, 0 37.58, 0 30.75 M0 30.75 C0 24.65, 0 18.55, 0 10.25 M0 30.75 C0 25.86, 0 20.97, 0 10.25 M0 10.25 C0 3.42, 3.42 0, 10.25 0 M0 10.25 C0 3.42, 3.42 0, 10.25 0" stroke="#000000" stroke-width="4" fill="none"></path></g><g transform="translate(595.7286723347854 453.96939262009425) rotate(0 49.5 11.5)"><text x="49.5" y="18" font-family="Helvetica, Segoe UI Emoji" font-size="20px" fill="#000000" text-anchor="middle" style="white-space: pre;" direction="ltr">hitStage(1)</text></g><g stroke-linecap="round" transform="translate(474.0248588356873 572.4422154036982) rotate(0 113.5 20.5)"><path d="M10.25 0 L216.75 0 L221.23 0.64 L224.44 2.56 L226.36 5.77 L227 10.25 L227 30.75 L226.36 35.23 L224.44 38.44 L221.23 40.36 L216.75 41 L10.25 41 L5.77 40.36 L2.56 38.44 L0.64 35.23 L0 30.75 L0 10.25 L0.64 5.77 L2.56 2.56 L5.77 0.64 L10.25 0" stroke="none" stroke-width="0" fill="#40c057"></path><path d="M10.25 0 M10.25 0 C64.53 0, 118.8 0, 216.75 0 M10.25 0 C83.58 0, 156.91 0, 216.75 0 M216.75 0 C223.58 0, 227 3.42, 227 10.25 M216.75 0 C223.58 0, 227 3.42, 227 10.25 M227 10.25 C227 15.36, 227 20.47, 227 30.75 M227 10.25 C227 17.37, 227 24.5, 227 30.75 M227 30.75 C227 37.58, 223.58 41, 216.75 41 M227 30.75 C227 37.58, 223.58 41, 216.75 41 M216.75 41 C140.45 41, 64.14 41, 10.25 41 M216.75 41 C136.33 41, 55.91 41, 10.25 41 M10.25 41 C3.42 41, 0 37.58, 0 30.75 M10.25 41 C3.42 41, 0 37.58, 0 30.75 M0 30.75 C0 24.58, 0 18.41, 0 10.25 M0 30.75 C0 24.65, 0 18.55, 0 10.25 M0 10.25 C0 3.42, 3.42 0, 10.25 0 M0 10.25 C0 3.42, 3.42 0, 10.25 0" stroke="#000000" stroke-width="4" fill="none"></path></g><g transform="translate(497.5248588356873 581.4422154036982) rotate(0 90 11.5)"><text x="90" y="18" font-family="Helvetica, Segoe UI Emoji" font-size="20px" fill="#000000" text-anchor="middle" style="white-space: pre;" direction="ltr">bankMuxesStage(1)</text></g><g stroke-linecap="round" transform="translate(209.3753997693811 572.4422154036982) rotate(0 113.5 20.5)"><path d="M10.25 0 L216.75 0 L221.23 0.64 L224.44 2.56 L226.36 5.77 L227 10.25 L227 30.75 L226.36 35.23 L224.44 38.44 L221.23 40.36 L216.75 41 L10.25 41 L5.77 40.36 L2.56 38.44 L0.64 35.23 L0 30.75 L0 10.25 L0.64 5.77 L2.56 2.56 L5.77 0.64 L10.25 0" stroke="none" stroke-width="0" fill="#40c057"></path><path d="M10.25 0 M10.25 0 C72.27 0, 134.28 0, 216.75 0 M10.25 0 C53.37 0, 96.5 0, 216.75 0 M216.75 0 C223.58 0, 227 3.42, 227 10.25 M216.75 0 C223.58 0, 227 3.42, 227 10.25 M227 10.25 C227 18.1, 227 25.94, 227 30.75 M227 10.25 C227 17.66, 227 25.08, 227 30.75 M227 30.75 C227 37.58, 223.58 41, 216.75 41 M227 30.75 C227 37.58, 223.58 41, 216.75 41 M216.75 41 C168.62 41, 120.49 41, 10.25 41 M216.75 41 C149.07 41, 81.38 41, 10.25 41 M10.25 41 C3.42 41, 0 37.58, 0 30.75 M10.25 41 C3.42 41, 0 37.58, 0 30.75 M0 30.75 C0 23.08, 0 15.42, 0 10.25 M0 30.75 C0 23.92, 0 17.08, 0 10.25 M0 10.25 C0 3.42, 3.42 0, 10.25 0 M0 10.25 C0 3.42, 3.42 0, 10.25 0" stroke="#000000" stroke-width="4" fill="none"></path></g><g transform="translate(237.3753997693811 581.4422154036982) rotate(0 85.5 11.5)"><text x="85.5" y="18" font-family="Helvetica, Segoe UI Emoji" font-size="20px" fill="#000000" text-anchor="middle" style="white-space: pre;" direction="ltr">preControlStage(1)</text></g><g stroke-linecap="round" transform="translate(126.86912155219557 760.3433313407764) rotate(0 100.5 20.5)"><path d="M10.25 0 L190.75 0 L195.23 0.64 L198.44 2.56 L200.36 5.77 L201 10.25 L201 30.75 L200.36 35.23 L198.44 38.44 L195.23 40.36 L190.75 41 L10.25 41 L5.77 40.36 L2.56 38.44 L0.64 35.23 L0 30.75 L0 10.25 L0.64 5.77 L2.56 2.56 L5.77 0.64 L10.25 0" stroke="none" stroke-width="0" fill="#12b886"></path><path d="M10.25 0 M10.25 0 C64.92 0, 119.59 0, 190.75 0 M10.25 0 C46.73 0, 83.21 0, 190.75 0 M190.75 0 C197.58 0, 201 3.42, 201 10.25 M190.75 0 C197.58 0, 201 3.42, 201 10.25 M201 10.25 C201 18.33, 201 26.4, 201 30.75 M201 10.25 C201 14.75, 201 19.25, 201 30.75 M201 30.75 C201 37.58, 197.58 41, 190.75 41 M201 30.75 C201 37.58, 197.58 41, 190.75 41 M190.75 41 C125.13 41, 59.51 41, 10.25 41 M190.75 41 C145.95 41, 101.16 41, 10.25 41 M10.25 41 C3.42 41, 0 37.58, 0 30.75 M10.25 41 C3.42 41, 0 37.58, 0 30.75 M0 30.75 C0 24.79, 0 18.83, 0 10.25 M0 30.75 C0 26.26, 0 21.78, 0 10.25 M0 10.25 C0 3.42, 3.42 0, 10.25 0 M0 10.25 C0 3.42, 3.42 0, 10.25 0" stroke="#000000" stroke-width="4" fill="none"></path></g><g transform="translate(147.86912155219557 769.3433313407764) rotate(0 79.5 11.5)"><text x="79.5" y="18" font-family="Helvetica, Segoe UI Emoji" font-size="20px" fill="#000000" text-anchor="middle" style="white-space: pre;" direction="ltr">bankMuxStage(2)</text></g><g stroke-linecap="round" transform="translate(362.8720860278389 762.1076610678848) rotate(0 189.5 20.5)"><path d="M10.25 0 L368.75 0 L373.23 0.64 L376.44 2.56 L378.36 5.77 L379 10.25 L379 30.75 L378.36 35.23 L376.44 38.44 L373.23 40.36 L368.75 41 L10.25 41 L5.77 40.36 L2.56 38.44 L0.64 35.23 L0 30.75 L0 10.25 L0.64 5.77 L2.56 2.56 L5.77 0.64 L10.25 0" stroke="none" stroke-width="0" fill="#12b886"></path><path d="M10.25 0 M10.25 0 C129.86 0, 249.47 0, 368.75 0 M10.25 0 C127.07 0, 243.89 0, 368.75 0 M368.75 0 C375.58 0, 379 3.42, 379 10.25 M368.75 0 C375.58 0, 379 3.42, 379 10.25 M379 10.25 C379 14.41, 379 18.57, 379 30.75 M379 10.25 C379 14.67, 379 19.1, 379 30.75 M379 30.75 C379 37.58, 375.58 41, 368.75 41 M379 30.75 C379 37.58, 375.58 41, 368.75 41 M368.75 41 C248.44 41, 128.12 41, 10.25 41 M368.75 41 C287.25 41, 205.74 41, 10.25 41 M10.25 41 C3.42 41, 0 37.58, 0 30.75 M10.25 41 C3.42 41, 0 37.58, 0 30.75 M0 30.75 C0 23.21, 0 15.67, 0 10.25 M0 30.75 C0 24.58, 0 18.4, 0 10.25 M0 10.25 C0 3.42, 3.42 0, 10.25 0 M0 10.25 C0 3.42, 3.42 0, 10.25 0" stroke="#000000" stroke-width="4" fill="none"></path></g><g transform="translate(483.3720860278389 771.1076610678848) rotate(0 69 11.5)"><text x="69" y="18" font-family="Helvetica, Segoe UI Emoji" font-size="20px" fill="#000000" text-anchor="middle" style="white-space: pre;" direction="ltr">controlStage(2)</text></g><g stroke-linecap="round" transform="translate(451.97073724682843 971.1807337302665) rotate(0 113.5 20.5)"><path d="M10.25 0 L216.75 0 L221.23 0.64 L224.44 2.56 L226.36 5.77 L227 10.25 L227 30.75 L226.36 35.23 L224.44 38.44 L221.23 40.36 L216.75 41 L10.25 41 L5.77 40.36 L2.56 38.44 L0.64 35.23 L0 30.75 L0 10.25 L0.64 5.77 L2.56 2.56 L5.77 0.64 L10.25 0" stroke="none" stroke-width="0" fill="#12b886"></path><path d="M10.25 0 M10.25 0 C57.58 0, 104.91 0, 216.75 0 M10.25 0 C91.01 0, 171.76 0, 216.75 0 M216.75 0 C223.58 0, 227 3.42, 227 10.25 M216.75 0 C223.58 0, 227 3.42, 227 10.25 M227 10.25 C227 16.03, 227 21.8, 227 30.75 M227 10.25 C227 14.49, 227 18.72, 227 30.75 M227 30.75 C227 37.58, 223.58 41, 216.75 41 M227 30.75 C227 37.58, 223.58 41, 216.75 41 M216.75 41 C146.45 41, 76.16 41, 10.25 41 M216.75 41 C168.88 41, 121.01 41, 10.25 41 M10.25 41 C3.42 41, 0 37.58, 0 30.75 M10.25 41 C3.42 41, 0 37.58, 0 30.75 M0 30.75 C0 23.92, 0 17.09, 0 10.25 M0 30.75 C0 25.56, 0 20.37, 0 10.25 M0 10.25 C0 3.42, 3.42 0, 10.25 0 M0 10.25 C0 3.42, 3.42 0, 10.25 0" stroke="#000000" stroke-width="4" fill="none"></path></g><g transform="translate(512.9707372468284 980.1807337302665) rotate(0 52.5 11.5)"><text x="52.5" y="18" font-family="Helvetica, Segoe UI Emoji" font-size="20px" fill="#000000" text-anchor="middle" style="white-space: pre;" direction="ltr">rspStage(2)</text></g><g stroke-linecap="round"><g transform="translate(344.04735649468626 110.39803503946769) rotate(0 -29.552522929070847 -24.700616179521887)"><path d="M0 0 C0 -15.48, 0 -30.95, 0 -49.4 M0 0 C0 -15.53, 0 -31.07, 0 -49.4 M0 -49.4 C-13.89 -49.4, -27.79 -49.4, -59.11 -49.4 M0 -49.4 C-14.34 -49.4, -28.68 -49.4, -59.11 -49.4" stroke="#000000" stroke-width="4" fill="none"></path></g><g transform="translate(344.04735649468626 110.39803503946769) rotate(0 -29.552522929070847 -24.700616179521887)"><path d="M0 0 L-6.34 -13.59 L6.34 -13.59 L0 0" stroke="none" stroke-width="0" fill="#000000" fill-rule="evenodd"></path><path d="M0 0 C-1.99 -4.26, -3.97 -8.52, -6.34 -13.59 M0 0 C-1.99 -4.28, -3.99 -8.55, -6.34 -13.59 M-6.34 -13.59 C-3.36 -13.59, -0.38 -13.59, 6.34 -13.59 M-6.34 -13.59 C-3.26 -13.59, -0.19 -13.59, 6.34 -13.59 M6.34 -13.59 C4.38 -9.4, 2.43 -5.2, 0 0 M6.34 -13.59 C3.89 -8.35, 1.45 -3.11, 0 0 M0 0 C0 0, 0 0, 0 0 M0 0 C0 0, 0 0, 0 0" stroke="#000000" stroke-width="4" fill="none"></path></g></g><mask></mask><g transform="translate(170.25500928330564 48.09702909028874) rotate(0 51.5 11.5)"><text x="51.5" y="18" font-family="Helvetica, Segoe UI Emoji" font-size="20px" fill="#000000" text-anchor="middle" style="white-space: pre;" direction="ltr">io.load.cmd</text></g><g stroke-linecap="round" transform="translate(636.7062910977539 10) rotate(0 49.5 36)"><path d="M0 0 C34.08 0, 68.16 0, 99 0 M0 0 C34.35 0, 68.71 0, 99 0 M99 0 C99 19.79, 99 39.58, 99 72 M99 0 C99 19.94, 99 39.87, 99 72 M99 72 C77.82 72, 56.64 72, 0 72 M99 72 C73.3 72, 47.59 72, 0 72 M0 72 C0 53, 0 34, 0 0 M0 72 C0 57.43, 0 42.86, 0 0" stroke="#000000" stroke-width="4" fill="none"></path></g><g transform="translate(659.2062910977539 34.5) rotate(0 27 11.5)"><text x="27" y="18" font-family="Helvetica, Segoe UI Emoji" font-size="20px" fill="#000000" text-anchor="middle" style="white-space: pre;" direction="ltr">banks</text></g><g stroke-linecap="round"><g transform="translate(566.3529021103834 113.0445296301308) rotate(0 33.96334724684266 -33.5222648150654)"><path d="M0 0 C0 -18, 0 -35.99, 0 -67.04 M0 0 C0 -14.23, 0 -28.45, 0 -67.04 M0 -67.04 C22.64 -67.04, 45.29 -67.04, 67.93 -67.04 M0 -67.04 C14.46 -67.04, 28.91 -67.04, 67.93 -67.04" stroke="#000000" stroke-width="4" fill="none"></path></g><g transform="translate(566.3529021103834 113.0445296301308) rotate(0 33.96334724684266 -33.5222648150654)"><path d="M67.93 -67.04 L54.33 -60.71 L54.33 -73.38 L67.93 -67.04" stroke="none" stroke-width="0" fill="#000000" fill-rule="evenodd"></path><path d="M67.93 -67.04 C64.28 -65.34, 60.63 -63.64, 54.33 -60.71 M67.93 -67.04 C65.04 -65.7, 62.16 -64.35, 54.33 -60.71 M54.33 -60.71 C54.33 -64.93, 54.33 -69.16, 54.33 -73.38 M54.33 -60.71 C54.33 -63.4, 54.33 -66.1, 54.33 -73.38 M54.33 -73.38 C58.26 -71.55, 62.18 -69.72, 67.93 -67.04 M54.33 -73.38 C57.14 -72.08, 59.94 -70.77, 67.93 -67.04 M67.93 -67.04 C67.93 -67.04, 67.93 -67.04, 67.93 -67.04 M67.93 -67.04 C67.93 -67.04, 67.93 -67.04, 67.93 -67.04" stroke="#000000" stroke-width="4" fill="none"></path></g></g><mask></mask><g transform="translate(492.9420777926118 14.035054093369354) rotate(0 69 9)"><text x="69" y="14" font-family="Helvetica, Segoe UI Emoji" font-size="16px" fill="#000000" text-anchor="middle" style="white-space: pre;" direction="ltr">banks(id).read.cmd</text></g><g stroke-linecap="round" transform="translate(754.1552504065048 280.82461311118686) rotate(0 49.5 36)"><path d="M0 0 C35.81 0, 71.62 0, 99 0 M0 0 C26.18 0, 52.37 0, 99 0 M99 0 C99 18.87, 99 37.73, 99 72 M99 0 C99 24.09, 99 48.17, 99 72 M99 72 C59.57 72, 20.15 72, 0 72 M99 72 C74.79 72, 50.58 72, 0 72 M0 72 C0 46.3, 0 20.6, 0 0 M0 72 C0 55.54, 0 39.08, 0 0" stroke="#000000" stroke-width="4" fill="none"></path></g><g transform="translate(776.6552504065048 305.32461311118686) rotate(0 27 11.5)"><text x="27" y="18" font-family="Helvetica, Segoe UI Emoji" font-size="20px" fill="#000000" text-anchor="middle" style="white-space: pre;" direction="ltr">banks</text></g><g stroke-linecap="round"><g transform="translate(752.4896883203521 317.70677797474104) rotate(0 -53.81205667681559 -28.670358065516496)"><path d="M0 0 C-31.18 0, -62.36 0, -107.62 0 M0 0 C-35.52 0, -71.04 0, -107.62 0 M-107.62 0 C-107.62 -19.6, -107.62 -39.21, -107.62 -57.34 M-107.62 0 C-107.62 -19.77, -107.62 -39.54, -107.62 -57.34" stroke="#000000" stroke-width="4" fill="none"></path></g><g transform="translate(752.4896883203521 317.70677797474104) rotate(0 -53.81205667681559 -28.670358065516496)"><path d="M-107.62 -57.34 L-101.28 -43.75 L-113.96 -43.75 L-107.62 -57.34" stroke="none" stroke-width="0" fill="#000000" fill-rule="evenodd"></path><path d="M-107.62 -57.34 C-105.79 -53.4, -103.95 -49.46, -101.28 -43.75 M-107.62 -57.34 C-105.53 -52.85, -103.44 -48.37, -101.28 -43.75 M-101.28 -43.75 C-105.62 -43.75, -109.95 -43.75, -113.96 -43.75 M-101.28 -43.75 C-105.66 -43.75, -110.03 -43.75, -113.96 -43.75 M-113.96 -43.75 C-112.67 -46.51, -111.38 -49.28, -107.62 -57.34 M-113.96 -43.75 C-112.57 -46.73, -111.18 -49.72, -107.62 -57.34 M-107.62 -57.34 C-107.62 -57.34, -107.62 -57.34, -107.62 -57.34 M-107.62 -57.34 C-107.62 -57.34, -107.62 -57.34, -107.62 -57.34" stroke="#000000" stroke-width="4" fill="none"></path></g></g><mask></mask><g transform="translate(618.6808289631126 324.82141579161066) rotate(0 65 9)"><text x="65" y="14" font-family="Helvetica, Segoe UI Emoji" font-size="16px" fill="#000000" text-anchor="middle" style="white-space: pre;" direction="ltr">banks(id).read.rsp</text></g><g stroke-linecap="round" transform="translate(500.04467615611134 313.9057954944749) rotate(0 49.5 36)"><path d="M0 0 C38.29 0, 76.59 0, 99 0 M0 0 C35.2 0, 70.4 0, 99 0 M99 0 C99 22.49, 99 44.97, 99 72 M99 0 C99 25.86, 99 51.72, 99 72 M99 72 C67.14 72, 35.28 72, 0 72 M99 72 C60.06 72, 21.12 72, 0 72 M0 72 C0 54.64, 0 37.29, 0 0 M0 72 C0 57.06, 0 42.12, 0 0" stroke="#000000" stroke-width="4" fill="none"></path></g><g transform="translate(522.5446761561113 338.4057954944749) rotate(0 27 11.5)"><text x="27" y="18" font-family="Helvetica, Segoe UI Emoji" font-size="20px" fill="#000000" text-anchor="middle" style="white-space: pre;" direction="ltr">status</text></g><g stroke-linecap="round" transform="translate(74.00614060609803 312.1414657673662) rotate(0 49.5 36)"><path d="M0 0 C29.33 0, 58.66 0, 99 0 M0 0 C37.52 0, 75.05 0, 99 0 M99 0 C99 20.93, 99 41.86, 99 72 M99 0 C99 20.9, 99 41.8, 99 72 M99 72 C75.17 72, 51.35 72, 0 72 M99 72 C75.88 72, 52.76 72, 0 72 M0 72 C0 56.9, 0 41.8, 0 0 M0 72 C0 45.75, 0 19.5, 0 0" stroke="#000000" stroke-width="4" fill="none"></path></g><g transform="translate(100.00614060609803 336.6414657673662) rotate(0 23.5 11.5)"><text x="23.5" y="18" font-family="Helvetica, Segoe UI Emoji" font-size="20px" fill="#000000" text-anchor="middle" style="white-space: pre;" direction="ltr">ways</text></g><g stroke-linecap="round"><g transform="translate(396.97724830794743 260.36606184370805) rotate(0 51.03531064651975 37.93308913283721)"><path d="M0 0 C0 19.7, 0 39.4, 0 75.87 M0 0 C0 18.77, 0 37.53, 0 75.87 M0 75.87 C24.28 75.87, 48.56 75.87, 102.07 75.87 M0 75.87 C27.67 75.87, 55.34 75.87, 102.07 75.87" stroke="#000000" stroke-width="4" fill="none"></path></g><g transform="translate(396.97724830794743 260.36606184370805) rotate(0 51.03531064651975 37.93308913283721)"><path d="M102.07 75.87 L88.48 82.21 L88.48 69.53 L102.07 75.87" stroke="none" stroke-width="0" fill="#000000" fill-rule="evenodd"></path><path d="M102.07 75.87 C98.54 77.51, 95.01 79.16, 88.48 82.21 M102.07 75.87 C98.71 77.43, 95.35 79, 88.48 82.21 M88.48 82.21 C88.48 79.19, 88.48 76.17, 88.48 69.53 M88.48 82.21 C88.48 78.77, 88.48 75.33, 88.48 69.53 M88.48 69.53 C93.54 71.89, 98.61 74.25, 102.07 75.87 M88.48 69.53 C92.53 71.42, 96.58 73.3, 102.07 75.87 M102.07 75.87 C102.07 75.87, 102.07 75.87, 102.07 75.87 M102.07 75.87 C102.07 75.87, 102.07 75.87, 102.07 75.87" stroke="#000000" stroke-width="4" fill="none"></path></g></g><mask></mask><g stroke-linecap="round"><g transform="translate(499.0478696009869 359.1685265617956) rotate(0 -63.38561873628066 -49.401232359043775)"><path d="M0 0 C-46.42 0, -92.83 0, -126.77 0 M0 0 C-31.97 0, -63.93 0, -126.77 0 M-126.77 0 C-126.77 -32.39, -126.77 -64.77, -126.77 -98.8 M-126.77 0 C-126.77 -33.65, -126.77 -67.3, -126.77 -98.8" stroke="#000000" stroke-width="4" fill="none"></path></g><g transform="translate(499.0478696009869 359.1685265617956) rotate(0 -63.38561873628066 -49.401232359043775)"><path d="M-126.77 -98.8 L-120.43 -85.21 L-133.11 -85.21 L-126.77 -98.8" stroke="none" stroke-width="0" fill="#000000" fill-rule="evenodd"></path><path d="M-126.77 -98.8 C-124.45 -93.82, -122.13 -88.85, -120.43 -85.21 M-126.77 -98.8 C-125.17 -95.37, -123.57 -91.95, -120.43 -85.21 M-120.43 -85.21 C-124.59 -85.21, -128.74 -85.21, -133.11 -85.21 M-120.43 -85.21 C-124.75 -85.21, -129.07 -85.21, -133.11 -85.21 M-133.11 -85.21 C-130.88 -89.99, -128.65 -94.77, -126.77 -98.8 M-133.11 -85.21 C-130.97 -89.79, -128.84 -94.38, -126.77 -98.8 M-126.77 -98.8 C-126.77 -98.8, -126.77 -98.8, -126.77 -98.8 M-126.77 -98.8 C-126.77 -98.8, -126.77 -98.8, -126.77 -98.8" stroke="#000000" stroke-width="4" fill="none"></path></g></g><mask></mask><g transform="translate(404.7372090431951 279.6786791972519) rotate(0 75.5 9)"><text x="75.5" y="14" font-family="Helvetica, Segoe UI Emoji" font-size="16px" fill="#000000" text-anchor="middle" style="white-space: pre;" direction="ltr">status.loadRead.cmd</text></g><g transform="translate(351.9979582000519 367.94982115816936) rotate(0 71.5 9)"><text x="71.5" y="14" font-family="Helvetica, Segoe UI Emoji" font-size="16px" fill="#000000" text-anchor="middle" style="white-space: pre;" direction="ltr">status.loadRead.rsp</text></g><g stroke-linecap="round"><g transform="translate(174.67170269225034 337.9965698364912) rotate(0 30.875770224402373 -38.81525399639156)"><path d="M0 0 C22.16 0, 44.32 0, 61.75 0 M0 0 C16.79 0, 33.58 0, 61.75 0 M61.75 0 C61.75 -22.99, 61.75 -45.99, 61.75 -77.63 M61.75 0 C61.75 -16.61, 61.75 -33.23, 61.75 -77.63" stroke="#000000" stroke-width="4" fill="none"></path></g><g transform="translate(174.67170269225034 337.9965698364912) rotate(0 30.875770224402373 -38.81525399639156)"><path d="M0 0 L13.59 -6.34 L13.59 6.34 L0 0" stroke="none" stroke-width="0" fill="#000000" fill-rule="evenodd"></path><path d="M0 0 C4.88 -2.27, 9.76 -4.55, 13.59 -6.34 M0 0 C3.7 -1.72, 7.39 -3.45, 13.59 -6.34 M13.59 -6.34 C13.59 -2.58, 13.59 1.17, 13.59 6.34 M13.59 -6.34 C13.59 -3.63, 13.59 -0.91, 13.59 6.34 M13.59 6.34 C9.61 4.48, 5.62 2.62, 0 0 M13.59 6.34 C10.69 4.99, 7.79 3.63, 0 0 M0 0 C0 0, 0 0, 0 0 M0 0 C0 0, 0 0, 0 0" stroke="#000000" stroke-width="4" fill="none"></path></g></g><mask></mask><g stroke-linecap="round"><g transform="translate(173.78953782869598 360.05069142535) rotate(0 43.226078314163345 -49.40123235904383)"><path d="M0 0 C26.97 0, 53.95 0, 86.45 0 M0 0 C23.54 0, 47.08 0, 86.45 0 M86.45 0 C86.45 -24.07, 86.45 -48.14, 86.45 -98.8 M86.45 0 C86.45 -25.57, 86.45 -51.14, 86.45 -98.8" stroke="#000000" stroke-width="4" fill="none"></path></g><g transform="translate(173.78953782869598 360.05069142535) rotate(0 43.226078314163345 -49.40123235904383)"><path d="M86.45 -98.8 L92.79 -85.21 L80.11 -85.21 L86.45 -98.8" stroke="none" stroke-width="0" fill="#000000" fill-rule="evenodd"></path><path d="M86.45 -98.8 C88.43 -94.56, 90.41 -90.32, 92.79 -85.21 M86.45 -98.8 C88.18 -95.1, 89.9 -91.4, 92.79 -85.21 M92.79 -85.21 C89.7 -85.21, 86.61 -85.21, 80.11 -85.21 M92.79 -85.21 C89.51 -85.21, 86.23 -85.21, 80.11 -85.21 M80.11 -85.21 C81.87 -88.98, 83.63 -92.75, 86.45 -98.8 M80.11 -85.21 C81.51 -88.2, 82.9 -91.18, 86.45 -98.8 M86.45 -98.8 C86.45 -98.8, 86.45 -98.8, 86.45 -98.8 M86.45 -98.8 C86.45 -98.8, 86.45 -98.8, 86.45 -98.8" stroke="#000000" stroke-width="4" fill="none"></path></g></g><mask></mask><g transform="translate(61.22379863381832 278.33952867443793) rotate(0 84 9)"><text x="84" y="14" font-family="Helvetica, Segoe UI Emoji" font-size="16px" fill="#000000" text-anchor="middle" style="white-space: pre;" direction="ltr">ways(id).loadRead.cmd</text></g><g transform="translate(179.3831656956758 367.94982115816936) rotate(0 80 9)"><text x="80" y="14" font-family="Helvetica, Segoe UI Emoji" font-size="16px" fill="#000000" text-anchor="middle" style="white-space: pre;" direction="ltr">ways(id).loadRead.rsp</text></g><g stroke-linecap="round"><g transform="translate(259.3595295934683 488.8467615042856) rotate(0 -40.13850129172312 21.17195672530454)"><path d="M0 0 C0 10.28, 0 20.56, 0 42.34 M0 0 C0 11.51, 0 23.03, 0 42.34 M0 42.34 C-25.93 42.34, -51.85 42.34, -80.28 42.34 M0 42.34 C-16.79 42.34, -33.58 42.34, -80.28 42.34" stroke="#000000" stroke-width="4" fill="none"></path></g><g transform="translate(259.3595295934683 488.8467615042856) rotate(0 -40.13850129172312 21.17195672530454)"><path d="M0 0 L6.34 13.59 L-6.34 13.59 L0 0" stroke="none" stroke-width="0" fill="#000000" fill-rule="evenodd"></path><path d="M0 0 C1.54 3.3, 3.08 6.6, 6.34 13.59 M0 0 C1.72 3.7, 3.45 7.39, 6.34 13.59 M6.34 13.59 C2.24 13.59, -1.85 13.59, -6.34 13.59 M6.34 13.59 C3.69 13.59, 1.04 13.59, -6.34 13.59 M-6.34 13.59 C-4.2 9, -2.05 4.4, 0 0 M-6.34 13.59 C-4.17 8.94, -1.99 4.28, 0 0 M0 0 C0 0, 0 0, 0 0 M0 0 C0 0, 0 0, 0 0" stroke="#000000" stroke-width="4" fill="none"></path></g></g><mask></mask><g transform="translate(13.58126706950759 519.1796242272584) rotate(0 76.5 11.5)"><text x="76.5" y="18" font-family="Helvetica, Segoe UI Emoji" font-size="20px" fill="#000000" text-anchor="middle" style="white-space: pre;" direction="ltr">io.load.translated</text></g><g stroke-linecap="round" transform="translate(772.3760554349725 641.4844174735703) rotate(0 64.5 25)"><path d="M0 0 C44.03 0, 88.05 0, 129 0 M0 0 C40.71 0, 81.42 0, 129 0 M129 0 C129 10.09, 129 20.17, 129 50 M129 0 C129 13.65, 129 27.31, 129 50 M129 50 C102.37 50, 75.74 50, 0 50 M129 50 C97.39 50, 65.78 50, 0 50 M0 50 C0 31.56, 0 13.13, 0 0 M0 50 C0 36.09, 0 22.19, 0 0" stroke="#000000" stroke-width="4" fill="none"></path></g><g transform="translate(799.8760554349725 654.9844174735703) rotate(0 37 11.5)"><text x="37" y="18" font-family="Helvetica, Segoe UI Emoji" font-size="20px" fill="#000000" text-anchor="middle" style="white-space: pre;" direction="ltr">refill slot</text></g><g stroke-linecap="round" transform="translate(772.3760554349725 707.0641380215706) rotate(0 84.5 25)"><path d="M0 0 C59.19 0, 118.37 0, 169 0 M0 0 C41.71 0, 83.42 0, 169 0 M169 0 C169 15.2, 169 30.4, 169 50 M169 0 C169 18.06, 169 36.11, 169 50 M169 50 C130.98 50, 92.95 50, 0 50 M169 50 C134.19 50, 99.38 50, 0 50 M0 50 C0 35.82, 0 21.63, 0 0 M0 50 C0 35.6, 0 21.2, 0 0" stroke="#000000" stroke-width="4" fill="none"></path></g><g transform="translate(795.8760554349725 720.5641380215706) rotate(0 61 11.5)"><text x="61" y="18" font-family="Helvetica, Segoe UI Emoji" font-size="20px" fill="#000000" text-anchor="middle" style="white-space: pre;" direction="ltr">writeback slot</text></g><g stroke-linecap="round" transform="translate(523.2441425114671 857.0640437273677) rotate(0 49.5 36)"><path d="M0 0 C29.04 0, 58.09 0, 99 0 M0 0 C22.43 0, 44.86 0, 99 0 M99 0 C99 18.46, 99 36.92, 99 72 M99 0 C99 28.35, 99 56.71, 99 72 M99 72 C60.8 72, 22.59 72, 0 72 M99 72 C70.32 72, 41.64 72, 0 72 M0 72 C0 49.96, 0 27.93, 0 0 M0 72 C0 43.54, 0 15.08, 0 0" stroke="#000000" stroke-width="4" fill="none"></path></g><g transform="translate(549.2441425114671 881.5640437273677) rotate(0 23.5 11.5)"><text x="23.5" y="18" font-family="Helvetica, Segoe UI Emoji" font-size="20px" fill="#000000" text-anchor="middle" style="white-space: pre;" direction="ltr">ways</text></g><g stroke-linecap="round" transform="translate(251.43680871063629 857.0640437273677) rotate(0 49.5 36)"><path d="M0 0 C21.32 0, 42.64 0, 99 0 M0 0 C27.41 0, 54.81 0, 99 0 M99 0 C99 20.72, 99 41.44, 99 72 M99 0 C99 25.34, 99 50.68, 99 72 M99 72 C77.49 72, 55.97 72, 0 72 M99 72 C66.03 72, 33.06 72, 0 72 M0 72 C0 44.85, 0 17.71, 0 0 M0 72 C0 52.5, 0 33.01, 0 0" stroke="#000000" stroke-width="4" fill="none"></path></g><g transform="translate(273.9368087106363 881.5640437273677) rotate(0 27 11.5)"><text x="27" y="18" font-family="Helvetica, Segoe UI Emoji" font-size="20px" fill="#000000" text-anchor="middle" style="white-space: pre;" direction="ltr">status</text></g><g stroke-linecap="round"><g transform="translate(517.059758316478 760.7559219408396) rotate(0 126.64090185092681 -46.697173669154154)"><path d="M0 0 C0 -20.46, 0 -40.93, 0 -93.1 M0 0 C0 -21.55, 0 -43.1, 0 -93.1 M0 -93.1 C75.31 -93.19, 150.61 -93.28, 253.28 -93.39 M0 -93.1 C69.8 -93.18, 139.6 -93.26, 253.28 -93.39" stroke="#000000" stroke-width="4" fill="none"></path></g><g transform="translate(517.059758316478 760.7559219408396) rotate(0 126.64090185092681 -46.697173669154154)"><path d="M253.28 -93.39 L239.69 -87.04 L239.68 -99.72 L253.28 -93.39" stroke="none" stroke-width="0" fill="#000000" fill-rule="evenodd"></path><path d="M253.28 -93.39 C250.3 -92, 247.31 -90.6, 239.69 -87.04 M253.28 -93.39 C250.14 -91.92, 246.99 -90.45, 239.69 -87.04 M239.69 -87.04 C239.69 -90.81, 239.69 -94.58, 239.68 -99.72 M239.69 -87.04 C239.69 -90.53, 239.69 -94.03, 239.68 -99.72 M239.68 -99.72 C244.05 -97.69, 248.42 -95.66, 253.28 -93.39 M239.68 -99.72 C242.71 -98.31, 245.75 -96.9, 253.28 -93.39 M253.28 -93.39 C253.28 -93.39, 253.28 -93.39, 253.28 -93.39 M253.28 -93.39 C253.28 -93.39, 253.28 -93.39, 253.28 -93.39" stroke="#000000" stroke-width="4" fill="none"></path></g></g><mask></mask><g stroke-linecap="round"><g transform="translate(612.2331526474447 759.7214285241988) rotate(0 78.52675389549029 -14.482907832973297)"><path d="M0 0 C0 -6.71, 0 -13.42, 0 -28.97 M0 0 C0 -11.49, 0 -22.97, 0 -28.97 M0 -28.97 C49.07 -28.85, 98.14 -28.74, 157.05 -28.61 M0 -28.97 C57.94 -28.83, 115.89 -28.7, 157.05 -28.61" stroke="#000000" stroke-width="4" fill="none"></path></g><g transform="translate(612.2331526474447 759.7214285241988) rotate(0 78.52675389549029 -14.482907832973297)"><path d="M157.05 -28.61 L143.44 -22.3 L143.47 -34.98 L157.05 -28.61" stroke="none" stroke-width="0" fill="#000000" fill-rule="evenodd"></path><path d="M157.05 -28.61 C153.9 -27.15, 150.75 -25.68, 143.44 -22.3 M157.05 -28.61 C151.66 -26.11, 146.26 -23.61, 143.44 -22.3 M143.44 -22.3 C143.45 -26.26, 143.46 -30.22, 143.47 -34.98 M143.44 -22.3 C143.46 -26.98, 143.47 -31.66, 143.47 -34.98 M143.47 -34.98 C148.61 -32.57, 153.75 -30.16, 157.05 -28.61 M143.47 -34.98 C148.87 -32.45, 154.26 -29.92, 157.05 -28.61 M157.05 -28.61 C157.05 -28.61, 157.05 -28.61, 157.05 -28.61 M157.05 -28.61 C157.05 -28.61, 157.05 -28.61, 157.05 -28.61" stroke="#000000" stroke-width="4" fill="none"></path></g></g><mask></mask><g transform="translate(625.4752247291061 704.1002379420739) rotate(0 54 9)"><text x="54" y="14" font-family="Helvetica, Segoe UI Emoji" font-size="16px" fill="#000000" text-anchor="middle" style="white-space: pre;" direction="ltr">writeback.push</text></g><g transform="translate(644.9752247291061 639.9616461103361) rotate(0 34.5 9)"><text x="34.5" y="14" font-family="Helvetica, Segoe UI Emoji" font-size="16px" fill="#000000" text-anchor="middle" style="white-space: pre;" direction="ltr">refill.push</text></g><g stroke-linecap="round"><g transform="translate(707.4065469784116 804.2046454397592) rotate(0 -40.86248995731728 46.552203748842544)"><path d="M0 0 C0 30.19, 0 60.38, 0 93.1 M0 0 C0 27.37, 0 54.74, 0 93.1 M0 93.1 C-22.81 93.1, -45.62 93.1, -81.72 93.1 M0 93.1 C-28.11 93.1, -56.23 93.1, -81.72 93.1" stroke="#000000" stroke-width="4" fill="none"></path></g><g transform="translate(707.4065469784116 804.2046454397592) rotate(0 -40.86248995731728 46.552203748842544)"><path d="M-81.72 93.1 L-68.13 86.77 L-68.13 99.44 L-81.72 93.1" stroke="none" stroke-width="0" fill="#000000" fill-rule="evenodd"></path><path d="M-81.72 93.1 C-77.32 91.05, -72.91 88.99, -68.13 86.77 M-81.72 93.1 C-77.73 91.24, -73.73 89.38, -68.13 86.77 M-68.13 86.77 C-68.13 90.3, -68.13 93.84, -68.13 99.44 M-68.13 86.77 C-68.13 91.13, -68.13 95.49, -68.13 99.44 M-68.13 99.44 C-72.4 97.45, -76.66 95.46, -81.72 93.1 M-68.13 99.44 C-72.81 97.26, -77.48 95.08, -81.72 93.1 M-81.72 93.1 C-81.72 93.1, -81.72 93.1, -81.72 93.1 M-81.72 93.1 C-81.72 93.1, -81.72 93.1, -81.72 93.1" stroke="#000000" stroke-width="4" fill="none"></path></g></g><mask></mask><g stroke-linecap="round"><g transform="translate(461.19711381786703 804.2046454397592) rotate(0 -54.82815108196996 47.06945045716293)"><path d="M0 0 C0 35.06, 0 70.12, 0 94.14 M0 0 C0 28.83, 0 57.65, 0 94.14 M0 94.14 C-25.96 94.14, -51.92 94.14, -109.66 94.14 M0 94.14 C-42.18 94.14, -84.36 94.14, -109.66 94.14" stroke="#000000" stroke-width="4" fill="none"></path></g><g transform="translate(461.19711381786703 804.2046454397592) rotate(0 -54.82815108196996 47.06945045716293)"><path d="M-109.66 94.14 L-96.06 87.8 L-96.06 100.48 L-109.66 94.14" stroke="none" stroke-width="0" fill="#000000" fill-rule="evenodd"></path><path d="M-109.66 94.14 C-104.59 91.78, -99.53 89.42, -96.06 87.8 M-109.66 94.14 C-105.49 92.2, -101.33 90.26, -96.06 87.8 M-96.06 87.8 C-96.06 90.8, -96.06 93.8, -96.06 100.48 M-96.06 87.8 C-96.06 92.68, -96.06 97.55, -96.06 100.48 M-96.06 100.48 C-99.99 98.65, -103.92 96.81, -109.66 94.14 M-96.06 100.48 C-100.23 98.53, -104.4 96.59, -109.66 94.14 M-109.66 94.14 C-109.66 94.14, -109.66 94.14, -109.66 94.14 M-109.66 94.14 C-109.66 94.14, -109.66 94.14, -109.66 94.14" stroke="#000000" stroke-width="4" fill="none"></path></g></g><mask></mask><g stroke-linecap="round"><g transform="translate(901.891309306909 667.6515144431547) rotate(0 68.27656549830226 0)"><path d="M0 0 C51.74 0, 103.48 0, 136.55 0 M0 0 C54.49 0, 108.98 0, 136.55 0" stroke="#000000" stroke-width="4" fill="none"></path></g><g transform="translate(901.891309306909 667.6515144431547) rotate(0 68.27656549830226 0)"><path d="M0 0 L13.59 -6.34 L13.59 6.34 L0 0" stroke="none" stroke-width="0" fill="#000000" fill-rule="evenodd"></path><path d="M0 0 C5.15 -2.4, 10.3 -4.8, 13.59 -6.34 M0 0 C5.42 -2.53, 10.85 -5.06, 13.59 -6.34 M13.59 -6.34 C13.59 -3.36, 13.59 -0.38, 13.59 6.34 M13.59 -6.34 C13.59 -2.22, 13.59 1.89, 13.59 6.34 M13.59 6.34 C9.3 4.34, 5 2.33, 0 0 M13.59 6.34 C8.68 4.05, 3.77 1.76, 0 0 M0 0 C0 0, 0 0, 0 0 M0 0 C0 0, 0 0, 0 0" stroke="#000000" stroke-width="4" fill="none"></path></g><g transform="translate(901.891309306909 667.6515144431547) rotate(0 68.27656549830226 0)"><path d="M136.55 0 L122.96 6.34 L122.96 -6.34 L136.55 0" stroke="none" stroke-width="0" fill="#000000" fill-rule="evenodd"></path><path d="M136.55 0 C131.4 2.4, 126.25 4.8, 122.96 6.34 M136.55 0 C131.13 2.53, 125.7 5.06, 122.96 6.34 M122.96 6.34 C122.96 3.36, 122.96 0.38, 122.96 -6.34 M122.96 6.34 C122.96 2.22, 122.96 -1.89, 122.96 -6.34 M122.96 -6.34 C127.26 -4.34, 131.55 -2.33, 136.55 0 M122.96 -6.34 C127.87 -4.05, 132.79 -1.76, 136.55 0 M136.55 0 C136.55 0, 136.55 0, 136.55 0 M136.55 0 C136.55 0, 136.55 0, 136.55 0" stroke="#000000" stroke-width="4" fill="none"></path></g></g><mask></mask><g stroke-linecap="round"><g transform="translate(943.2710459725466 734.8935865248162) rotate(0 48.10394387380393 0)"><path d="M0 0 C33.96 0, 67.92 0, 96.21 0 M0 0 C21.99 0, 43.98 0, 96.21 0" stroke="#000000" stroke-width="4" fill="none"></path></g><g transform="translate(943.2710459725466 734.8935865248162) rotate(0 48.10394387380393 0)"><path d="M0 0 L13.59 -6.34 L13.59 6.34 L0 0" stroke="none" stroke-width="0" fill="#000000" fill-rule="evenodd"></path><path d="M0 0 C4.8 -2.24, 9.6 -4.48, 13.59 -6.34 M0 0 C3.11 -1.45, 6.21 -2.9, 13.59 -6.34 M13.59 -6.34 C13.59 -2.15, 13.59 2.04, 13.59 6.34 M13.59 -6.34 C13.59 -1.75, 13.59 2.84, 13.59 6.34 M13.59 6.34 C9.38 4.37, 5.16 2.41, 0 0 M13.59 6.34 C9.49 4.42, 5.38 2.51, 0 0 M0 0 C0 0, 0 0, 0 0 M0 0 C0 0, 0 0, 0 0" stroke="#000000" stroke-width="4" fill="none"></path></g><g transform="translate(943.2710459725466 734.8935865248162) rotate(0 48.10394387380393 0)"><path d="M96.21 0 L82.61 6.34 L82.61 -6.34 L96.21 0" stroke="none" stroke-width="0" fill="#000000" fill-rule="evenodd"></path><path d="M96.21 0 C91.41 2.24, 86.61 4.48, 82.61 6.34 M96.21 0 C93.1 1.45, 89.99 2.9, 82.61 6.34 M82.61 6.34 C82.61 2.15, 82.61 -2.04, 82.61 -6.34 M82.61 6.34 C82.61 1.75, 82.61 -2.84, 82.61 -6.34 M82.61 -6.34 C86.83 -4.37, 91.05 -2.41, 96.21 0 M82.61 -6.34 C86.72 -4.42, 90.82 -2.51, 96.21 0 M96.21 0 C96.21 0, 96.21 0, 96.21 0 M96.21 0 C96.21 0, 96.21 0, 96.21 0" stroke="#000000" stroke-width="4" fill="none"></path></g></g><mask></mask><g transform="translate(918.1464973864596 627.0572774464107) rotate(0 56 11.5)"><text x="56" y="18" font-family="Helvetica, Segoe UI Emoji" font-size="20px" fill="#000000" text-anchor="middle" style="white-space: pre;" direction="ltr">io.mem.read</text></g><g transform="translate(953.4726359639241 694.5181351109032) rotate(0 57 11.5)"><text x="57" y="18" font-family="Helvetica, Segoe UI Emoji" font-size="20px" fill="#000000" text-anchor="middle" style="white-space: pre;" direction="ltr">io.mem.write</text></g><g transform="translate(654.3891457287983 904.7919607704181) rotate(0 37.5 9)"><text x="37.5" y="14" font-family="Helvetica, Segoe UI Emoji" font-size="16px" fill="#000000" text-anchor="middle" style="white-space: pre;" direction="ltr">waysWrite</text></g><g transform="translate(376.7483903189483 904.7919607704181) rotate(0 41 9)"><text x="41" y="14" font-family="Helvetica, Segoe UI Emoji" font-size="16px" fill="#000000" text-anchor="middle" style="white-space: pre;" direction="ltr">status.write</text></g><g stroke-linecap="round"><g transform="translate(576.3792993407287 1014.4513966093879) rotate(0 -177.96561792506395 18.172545492348036)"><path d="M0 0 C0 8.1, 0 16.21, 0 36.35 M0 0 C0 8.86, 0 17.72, 0 36.35 M0 36.35 C-113.2 36.35, -226.4 36.35, -355.93 36.35 M0 36.35 C-105.78 36.35, -211.57 36.35, -355.93 36.35" stroke="#000000" stroke-width="4" fill="none"></path></g><g transform="translate(576.3792993407287 1014.4513966093879) rotate(0 -177.96561792506395 18.172545492348036)"><path d="M-355.93 36.35 L-342.34 30.01 L-342.34 42.68 L-355.93 36.35" stroke="none" stroke-width="0" fill="#000000" fill-rule="evenodd"></path><path d="M-355.93 36.35 C-352.9 34.93, -349.87 33.52, -342.34 30.01 M-355.93 36.35 C-352.62 34.8, -349.3 33.25, -342.34 30.01 M-342.34 30.01 C-342.34 34.04, -342.34 38.07, -342.34 42.68 M-342.34 30.01 C-342.34 33.77, -342.34 37.54, -342.34 42.68 M-342.34 42.68 C-345.63 41.15, -348.92 39.61, -355.93 36.35 M-342.34 42.68 C-345.89 41.03, -349.45 39.37, -355.93 36.35 M-355.93 36.35 C-355.93 36.35, -355.93 36.35, -355.93 36.35 M-355.93 36.35 C-355.93 36.35, -355.93 36.35, -355.93 36.35" stroke="#000000" stroke-width="4" fill="none"></path></g></g><mask></mask><g transform="translate(111.28411351698674 1038.7899295951393) rotate(0 46.5 11.5)"><text x="46.5" y="18" font-family="Helvetica, Segoe UI Emoji" font-size="20px" fill="#000000" text-anchor="middle" style="white-space: pre;" direction="ltr">io.load.rsp</text></g><g stroke-linecap="round"><g transform="translate(327.0103517543549 617.2957400423992) rotate(0 -40.13850129172312 21.17195672530454)"><path d="M0 0 C0 9.79, 0 19.59, 0 42.34 M0 0 C0 10.94, 0 21.89, 0 42.34 M0 42.34 C-19.91 42.34, -39.81 42.34, -80.28 42.34 M0 42.34 C-24.54 42.34, -49.08 42.34, -80.28 42.34" stroke="#000000" stroke-width="4" fill="none"></path></g><g transform="translate(327.0103517543549 617.2957400423992) rotate(0 -40.13850129172312 21.17195672530454)"><path d="M0 0 L6.34 13.59 L-6.34 13.59 L0 0" stroke="none" stroke-width="0" fill="#000000" fill-rule="evenodd"></path><path d="M0 0 C1.47 3.14, 2.93 6.29, 6.34 13.59 M0 0 C1.64 3.51, 3.28 7.03, 6.34 13.59 M6.34 13.59 C3.2 13.59, 0.05 13.59, -6.34 13.59 M6.34 13.59 C2.46 13.59, -1.41 13.59, -6.34 13.59 M-6.34 13.59 C-4.83 10.35, -3.31 7.11, 0 0 M-6.34 13.59 C-4.28 9.17, -2.21 4.75, 0 0 M0 0 C0 0, 0 0, 0 0 M0 0 C0 0, 0 0, 0 0" stroke="#000000" stroke-width="4" fill="none"></path></g></g><mask></mask><g transform="translate(172.64887849851652 648.2668817597875) rotate(0 29 11.5)"><text x="29" y="18" font-family="Helvetica, Segoe UI Emoji" font-size="20px" fill="#000000" text-anchor="middle" style="white-space: pre;" direction="ltr">io.lock</text></g><g transform="translate(755.9039392562938 180.79381495662653) rotate(0 21 11.5)"><text x="21" y="18" font-family="Helvetica, Segoe UI Emoji" font-size="20px" fill="#000000" text-anchor="middle" style="white-space: pre;" direction="ltr">M2S</text></g><g transform="translate(41.53490955709333 675.8455777471221) rotate(0 21 11.5)"><text x="21" y="18" font-family="Helvetica, Segoe UI Emoji" font-size="20px" fill="#000000" text-anchor="middle" style="white-space: pre;" direction="ltr">M2S</text></g></svg>
  
**load.pipeline stages**

This load pipeline : 
- receives load commands
- communicates with cache areas (banks, ways, status)
- checks whether a refill operation is needed
- checks if we need a writeback operation, if the refill operation removes a dirty cache line
- sends load responses

By default, the pipeline has 3 stages :
- in stage 0, we have `stage(0)`, `readBanksStage`
- in stage 1, we have `readTagsStage`, `translatedStage`, `hitsStage`, `hitStage` and `bankMuxesStage` and `preControlStage`
- in stage 2, we have `bankMuxStage`, `controlStage`, `rspStage`


- `stage(0)`

	This is the first stage of the pipeline, it receives the load command from the `DataCachePlugin` wrapper, which has arbitrated between the `Lsu2Plugin` and `MmuPlugin` load commands.
	
	With values in load command fields, we fill the following stageables :
	- `io.load.cmd.virtual` => `ADDRESS_PRE_TRANSLATION`
	- `io.load.cmd.redoOnDataHazard` => `REDO_ON_DATA_HAZARD`
	- `io.load.cmd.unlocked` => `UNLOCKED`
	
	Finally, the `io.load.cmd.valid` field makes this stage valid. So it's only when we receive a valid load command that the `load.pipeline` starts working.

> **Reminder :** Stageables are variables that are transmitted through the pipeline, so a stageable filled in at stage 0 can be read two cycle later at stage 2.

- `readBanksStage`

	At this stage, we send read commands to each `banks(bankId)` in order to have the word pointed to by the virtual address in each way.
	
	But first, we check that `banks(bankId)` is not being used by a `writeback` slot by reading the `usedByWriteBack` value. If `usedByWriteBack = true` for a `banks(bankId)`, we don't send a read command to that `banks(bankId)`, as a writeback slot is using the read port to this `banks(bankId)`.
	
	Otherwise, we send a read command to `banks(bankId)`, by filling the `banks(bankId).read.cmd.payload` with the index and offset part of the virtual address contained in `ADDRESS_PRE_TRANSLATION`.

___

- `readBanksStage + 1`

	We receive 1 clock cycle after the `banks(bankId)` responses.
	The responses are stored in the `BANKS_WORD` stageable. This stageable is a vector, so each `banks(bankId)` response is stored in its associated entry `BANKS_WORD(bankId)`.
	So `BANKS_WORD` contains the cache set, and each entry `BANKS_WORD(bankId)` contains a word.

	> This part should be reviewed
	We also check that during the previous stage, there were no writes to `ways` with the same address, using the `waysHazard` function.
	If this is the case, we can have a hazard, `ways` is written when there is a push to a refill slot, or when there is a flush. If we haven't taken the `ways` update into account, we'll have a bad association between the data in `banks` and the tag in `ways`.
	If there is an hazard in a way of `ways`, we set to 1 the bit associated in `WAYS_HAZARD`.

- `readTagsStage`

	We send now read commands to each `ways(wayId)` in order to have the tag set pointed to by the virtual address.
	We send the read command by filling `ways(wayId).loadRead.cmd.payload` with the index part of the virtual address contained in `ADDRESS_PRE_TRANSLATION`.
	
	We do the same with `status` by filling `status.loadRead.cmd.payload`.

	Depending on the type of memory used by `ways` and by `status` :
	- **Distributed RAM(default)** : `readTagsStage` is in stage 1, we send the read command and we receive the response in the same stage.
	- **Block RAM** : `readTagsStage` is in stage 0, we send the read command in stage 0, and we receive the response in the next stage, stage 1.
	In both cases, we receive the read response in stage 1.
	
	The `ways(wayId).loadRead` responses are stored in the `WAYS_TAGS` stageable, which will be a vector of `Tag` object.
	
	The `status.loadRead` response is stored in the `STATUS` stageable, which will be a vector of dirty bit, as seen above, 1 bit for each way.

- `translatedStage`

	We receive the physical address via the `io.load.translated` bus.
	We fill the following stageables :
	- `io.load.translated.physical` => `ADDRESS_POST_TRANSLATION`
	- `io.load.translated.abord` => `ABORD`
	
	We receive an abord command, if there is a TLB miss or an error in the address translation process, or if the load is a peripheral access, for example.

- `hitsStage`

	By taking the tag part of `ADDRESS_POST_TRANSLATION`, we can see if we have a cache hit.
	
	We check for each `WAYS_TAGS(wayId)` :
	- if we have the same tag by comparing `WAYS_TAGS(wayId).address` and the tag part of `ADDRESS_POST_TRANSLATION`
	AND
	- if the cache line associated to `WAYS_TAGS(wayId)` is valid, by checking `WAYS_TAGS(wayId).loaded`
	
	The results of theses checks are stored in the `WAYS_HITS` stageable, which is a n-bits word (where n = number of ways). If a bit is equal to 1, this means that the checks on the associated way give a true result.

- `hitStage`

	Here, we simply OR all the bits in `WAYS_HITS` and store the boolean result in `WAYS_HIT`.
	
	If we have `WAYS_HIT = True`, this means that at least 1 bit of `WAYS_HITS` is equal to 1, and we have a cache hit.

- `bankMuxesStage`

	If `memDataWidth != cpuWordWidth` : 
	- In each `BANKS_WORD` entry, we have a word of size `memDataWidth`, so we extract the necessary sub-word of size `cpuWordWidth` using an offset taken from `ADDRESS_PRE_TRANSLATION`.
	- We store the extracted words in the `BANKS_MUXES` stageable, which will be a vector of CPU words.

	If `memDataWidth = cpuWordWidth` (by default)
	- We store directly the `BANKS_WORD` words in the `BANKS_MUXES` stageable, which will be a vector of CPU words.

- `preControlStage`

	We define the `LOCKED` stageable using the `io.lock` command received and the `UNLOCKED` stageable.
	- `LOCKED = True` : if `UNLOCKED = False` and the `io.lock` received is valid and has the same address as `ADDRESS_PRE_TRANSLATION`
	- Otherwise `LOCKED = False`

___

- `bankMuxStage`

	On the one hand, when there is a cache hit, at least 1 bit of `WAYS_HITS` is equal to 1.
	Secondly, thanks to the virtual address offset, we have extracted the CPU word, and stored them in the `BANKS_MUXES` stageable.
	
	Using a multiplexer, we can select the correct word for the CPU, i.e. the value `BANKS_MUXES(wayId)` for the `wayId` way which gives the cache hit.
	
	When there is more than one bit equal to 1 in `WAYS_HITS`, i.e. when several ways give a cache hit, we select the CPU word of the first way that gives a hit.
	Example : `WAYS_HITS = 1001`, we select the word from  `BANKS_MUXES(0)`
	
	The CPU word selected is stored in the `CPU_WORD` stageable.

- `controlStage`

	First of all, we check that the load being processed is not already in a [[#Refill slots|refill slot]]. If there is cache miss, we have to wait for this refill slot and not use a new one.
	So, for each refill slot, we check whether it is valid and whether its address = `ADDRESS_POST_TRANSLATION`.
	We store the result in the `REFILL_HITS` stageable, which is an n-bit word (where n = number of refill slots). If any bit is equal to 1, there is a hit with the associated refill slot, and `refillHit = True`
	
	>If the `loadRefillCheckEarly` argument to `DataCachePlugin` is equal to True, the above check is made 1 stage before `controlStage`. In the default `NaxRiscv`, `loadRefillCheckEarly = False`.
	
	A number of things are then done and checked :
	1. Take a reservation to write to the `ways` and `status` zones. The reservation is allocated according to the other agents writing to these areas (`refill`, `invalidate`, `store`), and to our priority(2).
	
	 2. Choose the way, i.e. the cache line in the cache set, where we will write the refilled data. It's a random number taken from a free running counter, and the value is stored in `refillWay`.  The value is used if we need to perform a refill operation.
	
	3. Check that the cache line chosen for refill is not dirty. If it is, this cache line must be written back to memory and we set `refillWayNeedWriteback = True`
	
	4. Check that the chosen cache line is not already being used by another refill operation pushed previously. This is done by checking the chosen cache line for each valid refill slot. If the cache line is already in use, we can't use it, we set `lineBusy = True`, and we won't push anything into a refill slot. We will have to redo the load, in order to use another cache line in the cache set by changing the way chosen randomly
	
	5. Check that the cache line giving a cache hit has not been used by a writeback slot. If it has, we'll have to redo the load command, as we didn't have access to the `banks` read port as explained in `readBanksStage`. So we know the cache line has the same tag, but we couldn't read any data from that cache line. We set `bankBusy = True`.
	
	6. If there is an hazard in the cache line giving a cache hit, set `waysHitHazard = True`.
	
	7. Check that the cache line giving a cache hit is not faulty, by checking the `fault` field associated with it. If it is faulty, set `FAULT = True`
	
	With the variables set above, we can set the stageables `REDO` and `MISS`.
	`REDO = True` if there is either :
	- a cache miss, `WAYS_HIT = False`
	- a `ways` hazard, `waysHitHazard = True`
	- the cache line chosen randomly for refill used by another refill operation, `lineBusy = True`
	- the same load is already processed in a refill slot, `refillHit = True`
	- a lock command sent, `LOCKED = True`
	
	`REDO = False` always if `ABORD = True`
	
	
	`MISS = True` if there is :
	- a cache miss, `WAYS_HIT = False` 
	AND
	- a not `ways` hazard, `waysHitHazard = False`
	AND
	- not this load processed in a refill slot, `refillHit = False`
	AND
	- no lock command sent, `LOCKED = False`
	
	`MISS = False` always if `ABORD = True`
	
	**Refill**
	We can start refill operation by pushing data in a refill slot when in the same time :
	- there is at least one free refill slot
	- the cache line chosen randomly for refill is not used by another refill operation
	- we win the reservation on `ways` and `status` areas
	- there is at least one free writeback slot, if we need to perform a writeback operation
	- `MISS = True`
	- this load is already processed in a refill slot, so we won't duplicate the refill operation
	
	When we start refill :
	- we push to a refill slot the physical address `ADDRESS_POST_TRANSLATION` and the chosen way `refillWay`. If we need a writeback operation, we also push in the `refill.push.victim` field, the writeback slot which will be used.
	- we write in `ways` the tag and that the cache line is valid by setting `loaded = True`
	- we update the dirty bit vector in the `status` area, by initialising the dirty bit associated with the chosen way to False.
	- if the chosen cache line requires a writeback, we push this victim cache line to a writeback slot
	
	If there is a cache miss, but the refill slots are full, we set `REFILL_SLOT_FULL = True`.
	
	We set the `REFILL_SLOT` stageable with the refill slot number : 
	- It is the refill slot where we pushed
	- When there is a `refillHit`, it is the number of the refill slot that gave that hit, unless the refill slot has finished loading data from memory, in which case it is 0.

- `injectStage`

	Finally, at this point, we send the load response, and fill in the `io.load.rsp` fields with all the stageables defined earlier :
	- `io.load.rsp.data` <= `CPU_WORD` 
	- `io.load.rsp.fault` <= `FAULT` 
	- `io.load.rsp.redo` <= `REDO` 
	- `io.load.rsp.refillSlotAny` <= `REFILL_SLOT_FULL` 
	- `io.load.rsp.refillSlot` <= `REFILL_SLOT` 

___
#### Store pipeline

<svg version="1.1" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 1032.6158612429947 965.0294329772088" width="1032.6158612429947" height="965.0294329772088">
  <!-- svg-source:excalidraw -->
  
  <defs>
    <style class="style-fonts">
      @font-face {
        font-family: "Virgil";
        src: url("https://excalidraw.com/Virgil.woff2");
      }
      @font-face {
        font-family: "Cascadia";
        src: url("https://excalidraw.com/Cascadia.woff2");
      }
    </style>
  </defs>
  <rect x="0" y="0" width="1032.6158612429947" height="965.0294329772088" fill="#ffffff"></rect><g stroke-linecap="round"><g transform="translate(367.3776026925161 97.50024971808898) rotate(0 123.12291377530505 428.3194365847875)"><path d="M0 0 C47.39 1.55, 236.64 -7, 284.37 9.27 C332.1 25.54, 354.02 79.72, 286.39 97.62 C218.76 115.53, -53.49 80.4, -121.42 116.68 C-189.34 152.97, -201.16 277.48, -121.15 315.35 C-41.15 353.22, 277.95 311, 358.59 343.89 C439.24 376.78, 443.25 481.58, 362.72 512.68 C282.2 543.77, -44.08 493.75, -124.56 530.45 C-205.05 567.16, -203.18 695.49, -120.2 732.93 C-37.23 770.36, 289.15 736.07, 373.3 755.07 C457.45 774.07, 436.23 830.01, 384.72 846.93 C333.2 863.86, 117.62 855.02, 64.2 856.63 M0 0 C47.39 1.55, 236.64 -7, 284.37 9.27 C332.1 25.54, 354.02 79.72, 286.39 97.62 C218.76 115.53, -53.49 80.4, -121.42 116.68 C-189.34 152.97, -201.16 277.48, -121.15 315.35 C-41.15 353.22, 277.95 311, 358.59 343.89 C439.24 376.78, 443.25 481.58, 362.72 512.68 C282.2 543.77, -44.08 493.75, -124.56 530.45 C-205.05 567.16, -203.18 695.49, -120.2 732.93 C-37.23 770.36, 289.15 736.07, 373.3 755.07 C457.45 774.07, 436.23 830.01, 384.72 846.93 C333.2 863.86, 117.62 855.02, 64.2 856.63" stroke="#364fc7" stroke-width="4" fill="none"></path></g><g transform="translate(367.3776026925161 97.50024971808898) rotate(0 123.12291377530505 428.3194365847875)"><path d="M64.2 856.63 L77.83 850.36 L77.77 863.04 L64.2 856.63" stroke="none" stroke-width="0" fill="#364fc7" fill-rule="evenodd"></path><path d="M64.2 856.63 C67.99 854.89, 71.77 853.15, 77.83 850.36 M64.2 856.63 C68.56 854.63, 72.91 852.62, 77.83 850.36 M77.83 850.36 C77.81 853.35, 77.8 856.35, 77.77 863.04 M77.83 850.36 C77.81 853.66, 77.8 856.97, 77.77 863.04 M77.77 863.04 C72.92 860.75, 68.07 858.46, 64.2 856.63 M77.77 863.04 C74.62 861.55, 71.46 860.06, 64.2 856.63 M64.2 856.63 C64.2 856.63, 64.2 856.63, 64.2 856.63 M64.2 856.63 C64.2 856.63, 64.2 856.63, 64.2 856.63" stroke="#364fc7" stroke-width="4" fill="none"></path></g></g><mask></mask><g stroke-linecap="round" transform="translate(430.1712407542161 76.64176236160893) rotate(0 74.5 20.5)"><path d="M10.25 0 L138.75 0 L143.23 0.64 L146.44 2.56 L148.36 5.77 L149 10.25 L149 30.75 L148.36 35.23 L146.44 38.44 L143.23 40.36 L138.75 41 L10.25 41 L5.77 40.36 L2.56 38.44 L0.64 35.23 L0 30.75 L0 10.25 L0.64 5.77 L2.56 2.56 L5.77 0.64 L10.25 0" stroke="none" stroke-width="0" fill="#82c91e"></path><path d="M10.25 0 M10.25 0 C51.5 0, 92.76 0, 138.75 0 M10.25 0 C41.8 0, 73.35 0, 138.75 0 M138.75 0 C145.58 0, 149 3.42, 149 10.25 M138.75 0 C145.58 0, 149 3.42, 149 10.25 M149 10.25 C149 16.15, 149 22.05, 149 30.75 M149 10.25 C149 17.06, 149 23.86, 149 30.75 M149 30.75 C149 37.58, 145.58 41, 138.75 41 M149 30.75 C149 37.58, 145.58 41, 138.75 41 M138.75 41 C107.87 41, 76.98 41, 10.25 41 M138.75 41 C112.78 41, 86.82 41, 10.25 41 M10.25 41 C3.42 41, 0 37.58, 0 30.75 M10.25 41 C3.42 41, 0 37.58, 0 30.75 M0 30.75 C0 25.32, 0 19.9, 0 10.25 M0 30.75 C0 25.28, 0 19.82, 0 10.25 M0 10.25 C0 3.42, 3.42 0, 10.25 0 M0 10.25 C0 3.42, 3.42 0, 10.25 0" stroke="#000000" stroke-width="4" fill="none"></path></g><g transform="translate(467.6712407542161 85.64176236160893) rotate(0 37 11.5)"><text x="37" y="18" font-family="Helvetica, Segoe UI Emoji" font-size="20px" fill="#000000" text-anchor="middle" style="white-space: pre;" direction="ltr">stage(0)</text></g><g transform="translate(178.61495375152867 78.37743263450011) rotate(0 87 17.5)"><text x="0" y="25" font-family="Virgil, Segoe UI Emoji" font-size="28px" fill="#364fc7" text-anchor="start" style="white-space: pre;" direction="ltr">store.pipeline</text></g><g stroke-linecap="round" transform="translate(352.1712407542161 179.71491116455945) rotate(0 113.5 20.5)"><path d="M10.25 0 L216.75 0 L221.23 0.64 L224.44 2.56 L226.36 5.77 L227 10.25 L227 30.75 L226.36 35.23 L224.44 38.44 L221.23 40.36 L216.75 41 L10.25 41 L5.77 40.36 L2.56 38.44 L0.64 35.23 L0 30.75 L0 10.25 L0.64 5.77 L2.56 2.56 L5.77 0.64 L10.25 0" stroke="none" stroke-width="0" fill="#40c057"></path><path d="M10.25 0 M10.25 0 C91.24 0, 172.24 0, 216.75 0 M10.25 0 C87.66 0, 165.08 0, 216.75 0 M216.75 0 C223.58 0, 227 3.42, 227 10.25 M216.75 0 C223.58 0, 227 3.42, 227 10.25 M227 10.25 C227 18.07, 227 25.88, 227 30.75 M227 10.25 C227 17.87, 227 25.49, 227 30.75 M227 30.75 C227 37.58, 223.58 41, 216.75 41 M227 30.75 C227 37.58, 223.58 41, 216.75 41 M216.75 41 C138.71 41, 60.67 41, 10.25 41 M216.75 41 C157.14 41, 97.54 41, 10.25 41 M10.25 41 C3.42 41, 0 37.58, 0 30.75 M10.25 41 C3.42 41, 0 37.58, 0 30.75 M0 30.75 C0 23.75, 0 16.74, 0 10.25 M0 30.75 C0 26.22, 0 21.69, 0 10.25 M0 10.25 C0 3.42, 3.42 0, 10.25 0 M0 10.25 C0 3.42, 3.42 0, 10.25 0" stroke="#000000" stroke-width="4" fill="none"></path></g><g transform="translate(385.6712407542161 188.71491116455945) rotate(0 80 11.5)"><text x="80" y="18" font-family="Helvetica, Segoe UI Emoji" font-size="20px" fill="#000000" text-anchor="middle" style="white-space: pre;" direction="ltr">readTagsStage(1)</text></g><g stroke-linecap="round" transform="translate(321.15002846113634 406.8723635298053) rotate(0 73 20.5)"><path d="M10.25 0 L135.75 0 L140.23 0.64 L143.44 2.56 L145.36 5.77 L146 10.25 L146 30.75 L145.36 35.23 L143.44 38.44 L140.23 40.36 L135.75 41 L10.25 41 L5.77 40.36 L2.56 38.44 L0.64 35.23 L0 30.75 L0 10.25 L0.64 5.77 L2.56 2.56 L5.77 0.64 L10.25 0" stroke="none" stroke-width="0" fill="#40c057"></path><path d="M10.25 0 M10.25 0 C37.97 0, 65.69 0, 135.75 0 M10.25 0 C39.41 0, 68.58 0, 135.75 0 M135.75 0 C142.58 0, 146 3.42, 146 10.25 M135.75 0 C142.58 0, 146 3.42, 146 10.25 M146 10.25 C146 16.07, 146 21.89, 146 30.75 M146 10.25 C146 14.49, 146 18.74, 146 30.75 M146 30.75 C146 37.58, 142.58 41, 135.75 41 M146 30.75 C146 37.58, 142.58 41, 135.75 41 M135.75 41 C105.17 41, 74.59 41, 10.25 41 M135.75 41 C97.02 41, 58.29 41, 10.25 41 M10.25 41 C3.42 41, 0 37.58, 0 30.75 M10.25 41 C3.42 41, 0 37.58, 0 30.75 M0 30.75 C0 23.13, 0 15.52, 0 10.25 M0 30.75 C0 25.42, 0 20.08, 0 10.25 M0 10.25 C0 3.42, 3.42 0, 10.25 0 M0 10.25 C0 3.42, 3.42 0, 10.25 0" stroke="#000000" stroke-width="4" fill="none"></path></g><g transform="translate(339.65002846113634 415.8723635298053) rotate(0 54.5 11.5)"><text x="54.5" y="18" font-family="Helvetica, Segoe UI Emoji" font-size="20px" fill="#000000" text-anchor="middle" style="white-space: pre;" direction="ltr">hitsStage(1)</text></g><g stroke-linecap="round" transform="translate(501.99702280935503 406.87236352980574) rotate(0 65.5 20.5)"><path d="M10.25 0 L120.75 0 L125.23 0.64 L128.44 2.56 L130.36 5.77 L131 10.25 L131 30.75 L130.36 35.23 L128.44 38.44 L125.23 40.36 L120.75 41 L10.25 41 L5.77 40.36 L2.56 38.44 L0.64 35.23 L0 30.75 L0 10.25 L0.64 5.77 L2.56 2.56 L5.77 0.64 L10.25 0" stroke="none" stroke-width="0" fill="#40c057"></path><path d="M10.25 0 M10.25 0 C37.38 0, 64.51 0, 120.75 0 M10.25 0 C46.78 0, 83.3 0, 120.75 0 M120.75 0 C127.58 0, 131 3.42, 131 10.25 M120.75 0 C127.58 0, 131 3.42, 131 10.25 M131 10.25 C131 17.06, 131 23.86, 131 30.75 M131 10.25 C131 14.68, 131 19.11, 131 30.75 M131 30.75 C131 37.58, 127.58 41, 120.75 41 M131 30.75 C131 37.58, 127.58 41, 120.75 41 M120.75 41 C98.42 41, 76.09 41, 10.25 41 M120.75 41 C92.54 41, 64.32 41, 10.25 41 M10.25 41 C3.42 41, 0 37.58, 0 30.75 M10.25 41 C3.42 41, 0 37.58, 0 30.75 M0 30.75 C0 25.28, 0 19.82, 0 10.25 M0 30.75 C0 24.18, 0 17.6, 0 10.25 M0 10.25 C0 3.42, 3.42 0, 10.25 0 M0 10.25 C0 3.42, 3.42 0, 10.25 0" stroke="#000000" stroke-width="4" fill="none"></path></g><g transform="translate(517.997022809355 415.87236352980574) rotate(0 49.5 11.5)"><text x="49.5" y="18" font-family="Helvetica, Segoe UI Emoji" font-size="20px" fill="#000000" text-anchor="middle" style="white-space: pre;" direction="ltr">hitStage(1)</text></g><g stroke-linecap="round" transform="translate(292.66011049924214 602.442569028785) rotate(0 189.5 20.5)"><path d="M10.25 0 L368.75 0 L373.23 0.64 L376.44 2.56 L378.36 5.77 L379 10.25 L379 30.75 L378.36 35.23 L376.44 38.44 L373.23 40.36 L368.75 41 L10.25 41 L5.77 40.36 L2.56 38.44 L0.64 35.23 L0 30.75 L0 10.25 L0.64 5.77 L2.56 2.56 L5.77 0.64 L10.25 0" stroke="none" stroke-width="0" fill="#12b886"></path><path d="M10.25 0 M10.25 0 C121.41 0, 232.57 0, 368.75 0 M10.25 0 C101.69 0, 193.13 0, 368.75 0 M368.75 0 C375.58 0, 379 3.42, 379 10.25 M368.75 0 C375.58 0, 379 3.42, 379 10.25 M379 10.25 C379 17.41, 379 24.57, 379 30.75 M379 10.25 C379 15.51, 379 20.76, 379 30.75 M379 30.75 C379 37.58, 375.58 41, 368.75 41 M379 30.75 C379 37.58, 375.58 41, 368.75 41 M368.75 41 C246.64 41, 124.53 41, 10.25 41 M368.75 41 C288.47 41, 208.18 41, 10.25 41 M10.25 41 C3.42 41, 0 37.58, 0 30.75 M10.25 41 C3.42 41, 0 37.58, 0 30.75 M0 30.75 C0 23.31, 0 15.88, 0 10.25 M0 30.75 C0 26.63, 0 22.51, 0 10.25 M0 10.25 C0 3.42, 3.42 0, 10.25 0 M0 10.25 C0 3.42, 3.42 0, 10.25 0" stroke="#000000" stroke-width="4" fill="none"></path></g><g transform="translate(413.16011049924214 611.442569028785) rotate(0 69 11.5)"><text x="69" y="18" font-family="Helvetica, Segoe UI Emoji" font-size="20px" fill="#000000" text-anchor="middle" style="white-space: pre;" direction="ltr">controlStage(2)</text></g><g stroke-linecap="round" transform="translate(354.1866237298416 822.7951526864173) rotate(0 113.5 20.5)"><path d="M10.25 0 L216.75 0 L221.23 0.64 L224.44 2.56 L226.36 5.77 L227 10.25 L227 30.75 L226.36 35.23 L224.44 38.44 L221.23 40.36 L216.75 41 L10.25 41 L5.77 40.36 L2.56 38.44 L0.64 35.23 L0 30.75 L0 10.25 L0.64 5.77 L2.56 2.56 L5.77 0.64 L10.25 0" stroke="none" stroke-width="0" fill="#12b886"></path><path d="M10.25 0 M10.25 0 C84.52 0, 158.8 0, 216.75 0 M10.25 0 C60.83 0, 111.42 0, 216.75 0 M216.75 0 C223.58 0, 227 3.42, 227 10.25 M216.75 0 C223.58 0, 227 3.42, 227 10.25 M227 10.25 C227 16.68, 227 23.11, 227 30.75 M227 10.25 C227 17.14, 227 24.03, 227 30.75 M227 30.75 C227 37.58, 223.58 41, 216.75 41 M227 30.75 C227 37.58, 223.58 41, 216.75 41 M216.75 41 C164.24 41, 111.74 41, 10.25 41 M216.75 41 C163.71 41, 110.67 41, 10.25 41 M10.25 41 C3.42 41, 0 37.58, 0 30.75 M10.25 41 C3.42 41, 0 37.58, 0 30.75 M0 30.75 C0 23.45, 0 16.15, 0 10.25 M0 30.75 C0 23.71, 0 16.67, 0 10.25 M0 10.25 C0 3.42, 3.42 0, 10.25 0 M0 10.25 C0 3.42, 3.42 0, 10.25 0" stroke="#000000" stroke-width="4" fill="none"></path></g><g transform="translate(415.1866237298416 831.7951526864173) rotate(0 52.5 11.5)"><text x="52.5" y="18" font-family="Helvetica, Segoe UI Emoji" font-size="20px" fill="#000000" text-anchor="middle" style="white-space: pre;" direction="ltr">rspStage(2)</text></g><g stroke-linecap="round"><g transform="translate(503.1854378695173 72.30100594917894) rotate(0 -27.802522929070847 -24.700616179521887)"><path d="M0 0 C0 -16.37, 0 -32.73, 0 -49.4 M0 0 C0 -17.11, 0 -34.22, 0 -49.4 M0 -49.4 C-14.44 -49.4, -28.87 -49.4, -55.61 -49.4 M0 -49.4 C-16.03 -49.4, -32.07 -49.4, -55.61 -49.4" stroke="#000000" stroke-width="4" fill="none"></path></g><g transform="translate(503.1854378695173 72.30100594917894) rotate(0 -27.802522929070847 -24.700616179521887)"><path d="M0 0 L-6.34 -13.59 L6.34 -13.59 L0 0" stroke="none" stroke-width="0" fill="#000000" fill-rule="evenodd"></path><path d="M0 0 C-2.1 -4.5, -4.2 -9.01, -6.34 -13.59 M0 0 C-2.2 -4.71, -4.39 -9.42, -6.34 -13.59 M-6.34 -13.59 C-3.05 -13.59, 0.24 -13.59, 6.34 -13.59 M-6.34 -13.59 C-2.68 -13.59, 0.97 -13.59, 6.34 -13.59 M6.34 -13.59 C4.07 -8.74, 1.81 -3.88, 0 0 M6.34 -13.59 C3.91 -8.37, 1.47 -3.15, 0 0 M0 0 C0 0, 0 0, 0 0 M0 0 C0 0, 0 0, 0 0" stroke="#000000" stroke-width="4" fill="none"></path></g></g><mask></mask><g transform="translate(325.89309065813654 10) rotate(0 55 11.5)"><text x="55" y="18" font-family="Helvetica, Segoe UI Emoji" font-size="20px" fill="#000000" text-anchor="middle" style="white-space: pre;" direction="ltr">io.store.cmd</text></g><g stroke-linecap="round" transform="translate(659.1827575309424 275.80876640418614) rotate(0 49.5 36)"><path d="M0 0 C29.4 0, 58.79 0, 99 0 M0 0 C29.63 0, 59.27 0, 99 0 M99 0 C99 27.27, 99 54.54, 99 72 M99 0 C99 18.92, 99 37.84, 99 72 M99 72 C75.58 72, 52.16 72, 0 72 M99 72 C69.31 72, 39.61 72, 0 72 M0 72 C0 48.19, 0 24.39, 0 0 M0 72 C0 47.51, 0 23.02, 0 0" stroke="#000000" stroke-width="4" fill="none"></path></g><g transform="translate(681.6827575309424 300.30876640418614) rotate(0 27 11.5)"><text x="27" y="18" font-family="Helvetica, Segoe UI Emoji" font-size="20px" fill="#000000" text-anchor="middle" style="white-space: pre;" direction="ltr">status</text></g><g stroke-linecap="round" transform="translate(233.14422198092893 274.04443667707756) rotate(0 49.5 36)"><path d="M0 0 C27.59 0, 55.18 0, 99 0 M0 0 C34.95 0, 69.89 0, 99 0 M99 0 C99 15.5, 99 31, 99 72 M99 0 C99 16.94, 99 33.87, 99 72 M99 72 C61.21 72, 23.43 72, 0 72 M99 72 C68.08 72, 37.15 72, 0 72 M0 72 C0 48.38, 0 24.76, 0 0 M0 72 C0 53.52, 0 35.03, 0 0" stroke="#000000" stroke-width="4" fill="none"></path></g><g transform="translate(259.14422198092893 298.54443667707756) rotate(0 23.5 11.5)"><text x="23.5" y="18" font-family="Helvetica, Segoe UI Emoji" font-size="20px" fill="#000000" text-anchor="middle" style="white-space: pre;" direction="ltr">ways</text></g><g stroke-linecap="round"><g transform="translate(556.1153296827783 222.26903275341942) rotate(0 51.03371392408201 37.93308913283721)"><path d="M0 0 C0 28.47, 0 56.94, 0 75.87 M0 0 C0 19.78, 0 39.57, 0 75.87 M0 75.87 C40.55 75.87, 81.11 75.87, 102.07 75.87 M0 75.87 C38.26 75.87, 76.53 75.87, 102.07 75.87" stroke="#000000" stroke-width="4" fill="none"></path></g><g transform="translate(556.1153296827783 222.26903275341942) rotate(0 51.03371392408201 37.93308913283721)"><path d="M102.07 75.87 L88.47 82.21 L88.47 69.53 L102.07 75.87" stroke="none" stroke-width="0" fill="#000000" fill-rule="evenodd"></path><path d="M102.07 75.87 C96.97 78.24, 91.87 80.62, 88.47 82.21 M102.07 75.87 C98.52 77.52, 94.98 79.17, 88.47 82.21 M88.47 82.21 C88.47 77.17, 88.47 72.13, 88.47 69.53 M88.47 82.21 C88.47 77.45, 88.47 72.7, 88.47 69.53 M88.47 69.53 C91.67 71.02, 94.86 72.51, 102.07 75.87 M88.47 69.53 C93.53 71.88, 98.58 74.24, 102.07 75.87 M102.07 75.87 C102.07 75.87, 102.07 75.87, 102.07 75.87 M102.07 75.87 C102.07 75.87, 102.07 75.87, 102.07 75.87" stroke="#000000" stroke-width="4" fill="none"></path></g></g><mask></mask><g stroke-linecap="round"><g transform="translate(659.0673617477503 321.071497471507) rotate(0 -63.82632412224689 -49.401232359043775)"><path d="M0 0 C-39.36 0, -78.72 0, -127.65 0 M0 0 C-28.91 0, -57.81 0, -127.65 0 M-127.65 0 C-127.65 -31.72, -127.65 -63.44, -127.65 -98.8 M-127.65 0 C-127.65 -35.54, -127.65 -71.07, -127.65 -98.8" stroke="#000000" stroke-width="4" fill="none"></path></g><g transform="translate(659.0673617477503 321.071497471507) rotate(0 -63.82632412224689 -49.401232359043775)"><path d="M-127.65 -98.8 L-121.31 -85.21 L-133.99 -85.21 L-127.65 -98.8" stroke="none" stroke-width="0" fill="#000000" fill-rule="evenodd"></path><path d="M-127.65 -98.8 C-125.7 -94.61, -123.74 -90.42, -121.31 -85.21 M-127.65 -98.8 C-126.22 -95.72, -124.78 -92.65, -121.31 -85.21 M-121.31 -85.21 C-125.38 -85.21, -129.45 -85.21, -133.99 -85.21 M-121.31 -85.21 C-125.87 -85.21, -130.43 -85.21, -133.99 -85.21 M-133.99 -85.21 C-132.17 -89.12, -130.34 -93.04, -127.65 -98.8 M-133.99 -85.21 C-132 -89.47, -130.01 -93.74, -127.65 -98.8 M-127.65 -98.8 C-127.65 -98.8, -127.65 -98.8, -127.65 -98.8 M-127.65 -98.8 C-127.65 -98.8, -127.65 -98.8, -127.65 -98.8" stroke="#000000" stroke-width="4" fill="none"></path></g></g><mask></mask><g transform="translate(560.875290418026 241.58165010696325) rotate(0 78.5 9)"><text x="78.5" y="14" font-family="Helvetica, Segoe UI Emoji" font-size="16px" fill="#000000" text-anchor="middle" style="white-space: pre;" direction="ltr">status.storeRead.cmd</text></g><g transform="translate(506.88276057541066 329.8527920678807) rotate(0 74.5 9)"><text x="74.5" y="14" font-family="Helvetica, Segoe UI Emoji" font-size="16px" fill="#000000" text-anchor="middle" style="white-space: pre;" direction="ltr">status.storeRead.rsp</text></g><g stroke-linecap="round"><g transform="translate(333.8097840670814 299.89954074620255) rotate(0 30.875770224402345 -38.81525399639156)"><path d="M0 0 C13.75 0, 27.49 0, 61.75 0 M0 0 C22.61 0, 45.22 0, 61.75 0 M61.75 0 C61.75 -30.45, 61.75 -60.9, 61.75 -77.63 M61.75 0 C61.75 -25.66, 61.75 -51.32, 61.75 -77.63" stroke="#000000" stroke-width="4" fill="none"></path></g><g transform="translate(333.8097840670814 299.89954074620255) rotate(0 30.875770224402345 -38.81525399639156)"><path d="M0 0 L13.59 -6.34 L13.59 6.34 L0 0" stroke="none" stroke-width="0" fill="#000000" fill-rule="evenodd"></path><path d="M0 0 C3.03 -1.41, 6.05 -2.82, 13.59 -6.34 M0 0 C4.98 -2.32, 9.96 -4.64, 13.59 -6.34 M13.59 -6.34 C13.59 -1.37, 13.59 3.61, 13.59 6.34 M13.59 -6.34 C13.59 -2.15, 13.59 2.04, 13.59 6.34 M13.59 6.34 C8.41 3.92, 3.23 1.5, 0 0 M13.59 6.34 C10.66 4.97, 7.72 3.6, 0 0 M0 0 C0 0, 0 0, 0 0 M0 0 C0 0, 0 0, 0 0" stroke="#000000" stroke-width="4" fill="none"></path></g></g><mask></mask><g stroke-linecap="round"><g transform="translate(333.21482188495725 321.9536623350614) rotate(0 43.08247697344814 -49.40123235904383)"><path d="M0 0 C29.84 0, 59.68 0, 86.16 0 M0 0 C22.37 0, 44.74 0, 86.16 0 M86.16 0 C86.16 -28.49, 86.16 -56.98, 86.16 -98.8 M86.16 0 C86.16 -35.31, 86.16 -70.62, 86.16 -98.8" stroke="#000000" stroke-width="4" fill="none"></path></g><g transform="translate(333.21482188495725 321.9536623350614) rotate(0 43.08247697344814 -49.40123235904383)"><path d="M86.16 -98.8 L92.5 -85.21 L79.83 -85.21 L86.16 -98.8" stroke="none" stroke-width="0" fill="#000000" fill-rule="evenodd"></path><path d="M86.16 -98.8 C88.36 -94.09, 90.56 -89.39, 92.5 -85.21 M86.16 -98.8 C87.81 -95.27, 89.46 -91.74, 92.5 -85.21 M92.5 -85.21 C88.85 -85.21, 85.19 -85.21, 79.83 -85.21 M92.5 -85.21 C87.97 -85.21, 83.44 -85.21, 79.83 -85.21 M79.83 -85.21 C82.26 -90.43, 84.69 -95.65, 86.16 -98.8 M79.83 -85.21 C81.24 -88.24, 82.66 -91.28, 86.16 -98.8 M86.16 -98.8 C86.16 -98.8, 86.16 -98.8, 86.16 -98.8 M86.16 -98.8 C86.16 -98.8, 86.16 -98.8, 86.16 -98.8" stroke="#000000" stroke-width="4" fill="none"></path></g></g><mask></mask><g transform="translate(217.36188000864922 240.2424995841493) rotate(0 87 9)"><text x="87" y="14" font-family="Helvetica, Segoe UI Emoji" font-size="16px" fill="#000000" text-anchor="middle" style="white-space: pre;" direction="ltr">ways(id).storeRead.cmd</text></g><g transform="translate(335.52124707050666 329.8527920678807) rotate(0 83 9)"><text x="83" y="14" font-family="Helvetica, Segoe UI Emoji" font-size="16px" fill="#000000" text-anchor="middle" style="white-space: pre;" direction="ltr">ways(id).storeRead.rsp</text></g><g stroke-linecap="round" transform="translate(709.6837539032097 724.9554513320928) rotate(0 64.5 25)"><path d="M0 0 C28.63 0, 57.26 0, 129 0 M0 0 C34.49 0, 68.99 0, 129 0 M129 0 C129 12.28, 129 24.55, 129 50 M129 0 C129 12.25, 129 24.5, 129 50 M129 50 C86.17 50, 43.34 50, 0 50 M129 50 C85.63 50, 42.27 50, 0 50 M0 50 C0 39.9, 0 29.79, 0 0 M0 50 C0 37.16, 0 24.31, 0 0" stroke="#000000" stroke-width="4" fill="none"></path></g><g transform="translate(737.1837539032097 738.4554513320928) rotate(0 37 11.5)"><text x="37" y="18" font-family="Helvetica, Segoe UI Emoji" font-size="20px" fill="#000000" text-anchor="middle" style="white-space: pre;" direction="ltr">refill slot</text></g><g stroke-linecap="round" transform="translate(709.6837539032097 657.6875979360312) rotate(0 84.5 25)"><path d="M0 0 C58.08 0, 116.15 0, 169 0 M0 0 C64.56 0, 129.11 0, 169 0 M169 0 C169 15.5, 169 31.01, 169 50 M169 0 C169 14.17, 169 28.33, 169 50 M169 50 C109.96 50, 50.92 50, 0 50 M169 50 C134.52 50, 100.04 50, 0 50 M0 50 C0 32.97, 0 15.94, 0 0 M0 50 C0 38.29, 0 26.58, 0 0" stroke="#000000" stroke-width="4" fill="none"></path></g><g transform="translate(733.1837539032097 671.1875979360312) rotate(0 61 11.5)"><text x="61" y="18" font-family="Helvetica, Segoe UI Emoji" font-size="20px" fill="#000000" text-anchor="middle" style="white-space: pre;" direction="ltr">writeback slot</text></g><g stroke-linecap="round" transform="translate(501.6035955542984 479.9550452798268) rotate(0 49.5 36)"><path d="M0 0 C22.42 0, 44.84 0, 99 0 M0 0 C31.78 0, 63.56 0, 99 0 M99 0 C99 25.9, 99 51.79, 99 72 M99 0 C99 20.73, 99 41.46, 99 72 M99 72 C67.94 72, 36.89 72, 0 72 M99 72 C75.21 72, 51.41 72, 0 72 M0 72 C0 53.69, 0 35.38, 0 0 M0 72 C0 52.94, 0 33.89, 0 0" stroke="#000000" stroke-width="4" fill="none"></path></g><g transform="translate(527.6035955542984 504.4550452798268) rotate(0 23.5 11.5)"><text x="23.5" y="18" font-family="Helvetica, Segoe UI Emoji" font-size="20px" fill="#000000" text-anchor="middle" style="white-space: pre;" direction="ltr">ways</text></g><g stroke-linecap="round" transform="translate(345.68583989685294 479.9550452798268) rotate(0 49.5 36)"><path d="M0 0 C27.19 0, 54.39 0, 99 0 M0 0 C23.14 0, 46.28 0, 99 0 M99 0 C99 14.41, 99 28.82, 99 72 M99 0 C99 14.53, 99 29.06, 99 72 M99 72 C77.54 72, 56.08 72, 0 72 M99 72 C74.48 72, 49.96 72, 0 72 M0 72 C0 57.25, 0 42.49, 0 0 M0 72 C0 44.94, 0 17.89, 0 0" stroke="#000000" stroke-width="4" fill="none"></path></g><g transform="translate(368.18583989685294 504.4550452798268) rotate(0 27 11.5)"><text x="27" y="18" font-family="Helvetica, Segoe UI Emoji" font-size="20px" fill="#000000" text-anchor="middle" style="white-space: pre;" direction="ltr">status</text></g><g stroke-linecap="round"><g transform="translate(453.1141777852429 646.2088738827416) rotate(0 126.64090185092698 51.83019770973169)"><path d="M0 0 C0 26.91, 0 53.82, 0 103.66 M0 0 C0 29.89, 0 59.78, 0 103.66 M0 103.66 C90.52 103.56, 181.04 103.45, 253.28 103.37 M0 103.66 C97.25 103.55, 194.51 103.44, 253.28 103.37" stroke="#000000" stroke-width="4" fill="none"></path></g><g transform="translate(453.1141777852429 646.2088738827416) rotate(0 126.64090185092698 51.83019770973169)"><path d="M253.28 103.37 L239.69 109.73 L239.68 97.05 L253.28 103.37" stroke="none" stroke-width="0" fill="#000000" fill-rule="evenodd"></path><path d="M253.28 103.37 C249.75 105.02, 246.23 106.67, 239.69 109.73 M253.28 103.37 C249.36 105.2, 245.45 107.04, 239.69 109.73 M239.69 109.73 C239.69 105.19, 239.68 100.66, 239.68 97.05 M239.69 109.73 C239.69 104.86, 239.68 99.99, 239.68 97.05 M239.68 97.05 C242.72 98.46, 245.75 99.87, 253.28 103.37 M239.68 97.05 C244.32 99.21, 248.97 101.36, 253.28 103.37 M253.28 103.37 C253.28 103.37, 253.28 103.37, 253.28 103.37 M253.28 103.37 C253.28 103.37, 253.28 103.37, 253.28 103.37" stroke="#000000" stroke-width="4" fill="none"></path></g></g><mask></mask><g stroke-linecap="round"><g transform="translate(549.5408511156818 646.4276594655731) rotate(0 78.52675389549029 17.654598236725633)"><path d="M0 0 C0 12.46, 0 24.92, 0 34.95 M0 0 C0 7.72, 0 15.44, 0 34.95 M0 34.95 C40.06 35.04, 80.12 35.13, 157.05 35.31 M0 34.95 C44.58 35.05, 89.16 35.15, 157.05 35.31" stroke="#000000" stroke-width="4" fill="none"></path></g><g transform="translate(549.5408511156818 646.4276594655731) rotate(0 78.52675389549029 17.654598236725633)"><path d="M157.05 35.31 L143.44 41.62 L143.47 28.94 L157.05 35.31" stroke="none" stroke-width="0" fill="#000000" fill-rule="evenodd"></path><path d="M157.05 35.31 C152.2 37.56, 147.35 39.81, 143.44 41.62 M157.05 35.31 C154.05 36.7, 151.04 38.1, 143.44 41.62 M143.44 41.62 C143.45 38.38, 143.46 35.15, 143.47 28.94 M143.44 41.62 C143.45 38.02, 143.46 34.42, 143.47 28.94 M143.47 28.94 C146.96 30.57, 150.44 32.21, 157.05 35.31 M143.47 28.94 C146.78 30.49, 150.09 32.04, 157.05 35.31 M157.05 35.31 C157.05 35.31, 157.05 35.31, 157.05 35.31 M157.05 35.31 C157.05 35.31, 157.05 35.31, 157.05 35.31" stroke="#000000" stroke-width="4" fill="none"></path></g></g><mask></mask><g transform="translate(562.782923197343 654.7236978565348) rotate(0 54 9)"><text x="54" y="14" font-family="Helvetica, Segoe UI Emoji" font-size="16px" fill="#000000" text-anchor="middle" style="white-space: pre;" direction="ltr">writeback.push</text></g><g transform="translate(582.2829231973435 723.4326799688585) rotate(0 34.5 9)"><text x="34.5" y="14" font-family="Helvetica, Segoe UI Emoji" font-size="16px" fill="#000000" text-anchor="middle" style="white-space: pre;" direction="ltr">refill.push</text></g><g stroke-linecap="round"><g transform="translate(635.9412924503429 601.442569028785) rotate(0 -16.820320119258326 -42.18785601878096)"><path d="M0 0 C0 -18.16, 0 -36.32, 0 -84.38 M0 0 C0 -19.85, 0 -39.7, 0 -84.38 M0 -84.38 C-12.84 -84.38, -25.68 -84.38, -33.64 -84.38 M0 -84.38 C-10.51 -84.38, -21.02 -84.38, -33.64 -84.38" stroke="#000000" stroke-width="4" fill="none"></path></g><g transform="translate(635.9412924503429 601.442569028785) rotate(0 -16.820320119258326 -42.18785601878096)"><path d="M-33.64 -84.38 L-20.05 -90.71 L-20.05 -78.04 L-33.64 -84.38" stroke="none" stroke-width="0" fill="#000000" fill-rule="evenodd"></path><path d="M-33.64 -84.38 C-30.71 -85.74, -27.79 -87.1, -20.05 -90.71 M-33.64 -84.38 C-30.44 -85.87, -27.24 -87.36, -20.05 -90.71 M-20.05 -90.71 C-20.05 -85.88, -20.05 -81.04, -20.05 -78.04 M-20.05 -90.71 C-20.05 -86.75, -20.05 -82.79, -20.05 -78.04 M-20.05 -78.04 C-24.51 -80.12, -28.97 -82.2, -33.64 -84.38 M-20.05 -78.04 C-23.54 -79.66, -27.03 -81.29, -33.64 -84.38 M-33.64 -84.38 C-33.64 -84.38, -33.64 -84.38, -33.64 -84.38 M-33.64 -84.38 C-33.64 -84.38, -33.64 -84.38, -33.64 -84.38" stroke="#000000" stroke-width="4" fill="none"></path></g></g><mask></mask><g stroke-linecap="round"><g transform="translate(487.1756144797466 601.442569028785) rotate(0 -19.104147800626833 -42.92388830993286)"><path d="M0 0 C0 -32.79, 0 -65.59, 0 -85.85 M0 0 C0 -26.62, 0 -53.24, 0 -85.85 M0 -85.85 C-10.82 -85.85, -21.65 -85.85, -38.21 -85.85 M0 -85.85 C-13.35 -85.85, -26.7 -85.85, -38.21 -85.85" stroke="#000000" stroke-width="4" fill="none"></path></g><g transform="translate(487.1756144797466 601.442569028785) rotate(0 -19.104147800626833 -42.92388830993286)"><path d="M-38.21 -85.85 L-24.61 -92.19 L-24.61 -79.51 L-38.21 -85.85" stroke="none" stroke-width="0" fill="#000000" fill-rule="evenodd"></path><path d="M-38.21 -85.85 C-33.02 -88.27, -27.82 -90.69, -24.61 -92.19 M-38.21 -85.85 C-33.99 -87.81, -29.78 -89.78, -24.61 -92.19 M-24.61 -92.19 C-24.61 -88.6, -24.61 -85, -24.61 -79.51 M-24.61 -92.19 C-24.61 -87.76, -24.61 -83.33, -24.61 -79.51 M-24.61 -79.51 C-27.39 -80.8, -30.16 -82.1, -38.21 -85.85 M-24.61 -79.51 C-29.24 -81.67, -33.87 -83.83, -38.21 -85.85 M-38.21 -85.85 C-38.21 -85.85, -38.21 -85.85, -38.21 -85.85 M-38.21 -85.85 C-38.21 -85.85, -38.21 -85.85, -38.21 -85.85" stroke="#000000" stroke-width="4" fill="none"></path></g></g><mask></mask><g stroke-linecap="round"><g transform="translate(839.6837539032097 751.122548301677) rotate(0 91.46605366989252 0)"><path d="M0 0 C72.68 0, 145.37 0, 182.93 0 M0 0 C68.58 0, 137.16 0, 182.93 0" stroke="#000000" stroke-width="4" fill="none"></path></g><g transform="translate(839.6837539032097 751.122548301677) rotate(0 91.46605366989252 0)"><path d="M0 0 L13.59 -6.34 L13.59 6.34 L0 0" stroke="none" stroke-width="0" fill="#000000" fill-rule="evenodd"></path><path d="M0 0 C5.4 -2.52, 10.8 -5.04, 13.59 -6.34 M0 0 C5.1 -2.38, 10.19 -4.75, 13.59 -6.34 M13.59 -6.34 C13.59 -3.36, 13.59 -0.38, 13.59 6.34 M13.59 -6.34 C13.59 -1.63, 13.59 3.09, 13.59 6.34 M13.59 6.34 C10.11 4.72, 6.64 3.09, 0 0 M13.59 6.34 C9.67 4.51, 5.75 2.68, 0 0 M0 0 C0 0, 0 0, 0 0 M0 0 C0 0, 0 0, 0 0" stroke="#000000" stroke-width="4" fill="none"></path></g><g transform="translate(839.6837539032097 751.122548301677) rotate(0 91.46605366989252 0)"><path d="M182.93 0 L169.34 6.34 L169.34 -6.34 L182.93 0" stroke="none" stroke-width="0" fill="#000000" fill-rule="evenodd"></path><path d="M182.93 0 C177.53 2.52, 172.13 5.04, 169.34 6.34 M182.93 0 C177.84 2.38, 172.74 4.75, 169.34 6.34 M169.34 6.34 C169.34 3.36, 169.34 0.38, 169.34 -6.34 M169.34 6.34 C169.34 1.63, 169.34 -3.09, 169.34 -6.34 M169.34 -6.34 C172.82 -4.72, 176.3 -3.09, 182.93 0 M169.34 -6.34 C173.26 -4.51, 177.19 -2.68, 182.93 0 M182.93 0 C182.93 0, 182.93 0, 182.93 0 M182.93 0 C182.93 0, 182.93 0, 182.93 0" stroke="#000000" stroke-width="4" fill="none"></path></g></g><mask></mask><g stroke-linecap="round"><g transform="translate(880.5787444407836 685.5170464392769) rotate(0 48.10394387380393 0)"><path d="M0 0 C30.89 0, 61.77 0, 96.21 0 M0 0 C34.6 0, 69.21 0, 96.21 0" stroke="#000000" stroke-width="4" fill="none"></path></g><g transform="translate(880.5787444407836 685.5170464392769) rotate(0 48.10394387380393 0)"><path d="M0 0 L13.59 -6.34 L13.59 6.34 L0 0" stroke="none" stroke-width="0" fill="#000000" fill-rule="evenodd"></path><path d="M0 0 C4.36 -2.04, 8.73 -4.07, 13.59 -6.34 M0 0 C4.89 -2.28, 9.78 -4.56, 13.59 -6.34 M13.59 -6.34 C13.59 -2.69, 13.59 0.96, 13.59 6.34 M13.59 -6.34 C13.59 -2.36, 13.59 1.62, 13.59 6.34 M13.59 6.34 C10.33 4.82, 7.06 3.29, 0 0 M13.59 6.34 C10.14 4.73, 6.68 3.12, 0 0 M0 0 C0 0, 0 0, 0 0 M0 0 C0 0, 0 0, 0 0" stroke="#000000" stroke-width="4" fill="none"></path></g><g transform="translate(880.5787444407836 685.5170464392769) rotate(0 48.10394387380393 0)"><path d="M96.21 0 L82.61 6.34 L82.61 -6.34 L96.21 0" stroke="none" stroke-width="0" fill="#000000" fill-rule="evenodd"></path><path d="M96.21 0 C91.84 2.04, 87.48 4.07, 82.61 6.34 M96.21 0 C91.32 2.28, 86.43 4.56, 82.61 6.34 M82.61 6.34 C82.61 2.69, 82.61 -0.96, 82.61 -6.34 M82.61 6.34 C82.61 2.36, 82.61 -1.62, 82.61 -6.34 M82.61 -6.34 C85.88 -4.82, 89.15 -3.29, 96.21 0 M82.61 -6.34 C86.07 -4.73, 89.53 -3.12, 96.21 0 M96.21 0 C96.21 0, 96.21 0, 96.21 0 M96.21 0 C96.21 0, 96.21 0, 96.21 0" stroke="#000000" stroke-width="4" fill="none"></path></g></g><mask></mask><g transform="translate(855.4541958546968 716.7947063022945) rotate(0 56 11.5)"><text x="56" y="18" font-family="Helvetica, Segoe UI Emoji" font-size="20px" fill="#000000" text-anchor="middle" style="white-space: pre;" direction="ltr">io.mem.read</text></g><g transform="translate(890.7803344321612 651.4079900227254) rotate(0 57 11.5)"><text x="57" y="18" font-family="Helvetica, Segoe UI Emoji" font-size="20px" fill="#000000" text-anchor="middle" style="white-space: pre;" direction="ltr">io.mem.write</text></g><g transform="translate(554.9542587234837 567.2522928871193) rotate(0 37.5 9)"><text x="37.5" y="14" font-family="Helvetica, Segoe UI Emoji" font-size="16px" fill="#000000" text-anchor="middle" style="white-space: pre;" direction="ltr">waysWrite</text></g><g transform="translate(398.81799354909003 567.6028777453176) rotate(0 41 9)"><text x="41" y="14" font-family="Helvetica, Segoe UI Emoji" font-size="16px" fill="#000000" text-anchor="middle" style="white-space: pre;" direction="ltr">status.write</text></g><g stroke-linecap="round"><g transform="translate(478.595185823742 866.0658155655384) rotate(0 -177.96561792506395 18.172545492348036)"><path d="M0 0 C0 8.03, 0 16.06, 0 36.35 M0 0 C0 9.27, 0 18.54, 0 36.35 M0 36.35 C-101.03 36.35, -202.06 36.35, -355.93 36.35 M0 36.35 C-91.27 36.35, -182.55 36.35, -355.93 36.35" stroke="#000000" stroke-width="4" fill="none"></path></g><g transform="translate(478.595185823742 866.0658155655384) rotate(0 -177.96561792506395 18.172545492348036)"><path d="M-355.93 36.35 L-342.34 30.01 L-342.34 42.68 L-355.93 36.35" stroke="none" stroke-width="0" fill="#000000" fill-rule="evenodd"></path><path d="M-355.93 36.35 C-352.93 34.94, -349.93 33.54, -342.34 30.01 M-355.93 36.35 C-352.46 34.73, -349 33.11, -342.34 30.01 M-342.34 30.01 C-342.34 33.6, -342.34 37.2, -342.34 42.68 M-342.34 30.01 C-342.34 33.26, -342.34 36.51, -342.34 42.68 M-342.34 42.68 C-345.65 41.14, -348.96 39.6, -355.93 36.35 M-342.34 42.68 C-345.38 41.26, -348.43 39.85, -355.93 36.35 M-355.93 36.35 C-355.93 36.35, -355.93 36.35, -355.93 36.35 M-355.93 36.35 C-355.93 36.35, -355.93 36.35, -355.93 36.35" stroke="#000000" stroke-width="4" fill="none"></path></g></g><mask></mask><g transform="translate(10 890.4043485512899) rotate(0 50 11.5)"><text x="50" y="18" font-family="Helvetica, Segoe UI Emoji" font-size="20px" fill="#000000" text-anchor="middle" style="white-space: pre;" direction="ltr">io.store.rsp</text></g><g transform="translate(633.0542457498611 140.19022786739333) rotate(0 21 11.5)"><text x="21" y="18" font-family="Helvetica, Segoe UI Emoji" font-size="20px" fill="#000000" text-anchor="middle" style="white-space: pre;" direction="ltr">M2S</text></g><g transform="translate(719.5304967134487 514.9272067085498) rotate(0 21 11.5)"><text x="21" y="18" font-family="Helvetica, Segoe UI Emoji" font-size="20px" fill="#000000" text-anchor="middle" style="white-space: pre;" direction="ltr">M2S</text></g><g stroke-linecap="round" transform="translate(191.55576492037972 479.9442806443941) rotate(0 49.5 36)"><path d="M0 0 C32.98 0, 65.96 0, 99 0 M0 0 C20.26 0, 40.52 0, 99 0 M99 0 C99 25.92, 99 51.84, 99 72 M99 0 C99 28.66, 99 57.31, 99 72 M99 72 C77.03 72, 55.07 72, 0 72 M99 72 C62.22 72, 25.44 72, 0 72 M0 72 C0 52.93, 0 33.85, 0 0 M0 72 C0 56.06, 0 40.11, 0 0" stroke="#000000" stroke-width="4" fill="none"></path></g><g transform="translate(214.05576492037972 504.4442806443941) rotate(0 27 11.5)"><text x="27" y="18" font-family="Helvetica, Segoe UI Emoji" font-size="20px" fill="#000000" text-anchor="middle" style="white-space: pre;" direction="ltr">banks</text></g><g stroke-linecap="round"><g transform="translate(333.0455395032732 601.4318043933525) rotate(0 -19.104147800626833 -42.92388830993286)"><path d="M0 0 C0 -28.24, 0 -56.47, 0 -85.85 M0 0 C0 -20.8, 0 -41.6, 0 -85.85 M0 -85.85 C-10.03 -85.85, -20.07 -85.85, -38.21 -85.85 M0 -85.85 C-9.5 -85.85, -18.99 -85.85, -38.21 -85.85" stroke="#000000" stroke-width="4" fill="none"></path></g><g transform="translate(333.0455395032732 601.4318043933525) rotate(0 -19.104147800626833 -42.92388830993286)"><path d="M-38.21 -85.85 L-24.61 -92.19 L-24.61 -79.51 L-38.21 -85.85" stroke="none" stroke-width="0" fill="#000000" fill-rule="evenodd"></path><path d="M-38.21 -85.85 C-33.74 -87.93, -29.27 -90.02, -24.61 -92.19 M-38.21 -85.85 C-34.91 -87.38, -31.62 -88.92, -24.61 -92.19 M-24.61 -92.19 C-24.61 -88.86, -24.61 -85.53, -24.61 -79.51 M-24.61 -92.19 C-24.61 -89.04, -24.61 -85.89, -24.61 -79.51 M-24.61 -79.51 C-28.47 -81.31, -32.33 -83.11, -38.21 -85.85 M-24.61 -79.51 C-29.84 -81.95, -35.07 -84.39, -38.21 -85.85 M-38.21 -85.85 C-38.21 -85.85, -38.21 -85.85, -38.21 -85.85 M-38.21 -85.85 C-38.21 -85.85, -38.21 -85.85, -38.21 -85.85" stroke="#000000" stroke-width="4" fill="none"></path></g></g><mask></mask><g transform="translate(219.85458523928355 569.4968750146467) rotate(0 52.5 9)"><text x="52.5" y="14" font-family="Helvetica, Segoe UI Emoji" font-size="16px" fill="#000000" text-anchor="middle" style="white-space: pre;" direction="ltr">banks(id).write</text></g></svg>

**store.pipeline stages**

This store pipeline : 
- receives store commands
- communicates with cache areas (banks, ways, status)
- checks whether a refill operation is needed
- checks if we need a writeback operation, if the refill operation removes a dirty cache line
- manage flush operation
- sends store responses

By default, the pipeline has 3 stages :
- in stage 0, we have `stage(0)`
- in stage 1, we have `readTagsStage`, `hitsStage`, `hitStage`
- in stage 2, we have `controlStage`, `rspStage`

- `stage(0)`

	This is the first stage of the pipeline, it receives the store command from the `Lsu2Plugin`.
	
	With values in store command fields, we fill the following stageables :
	- `io.store.cmd.address` => `ADDRESS_POST_TRANSLATION`
	- `io.store.cmd.data` => `CPU_WORD`
	- `io.store.cmd.mask` => `CPU_MASK`
	- `io.store.cmd.io && !io.store.cmd.flush` => `IO`
	- `io.store.cmd.flush` => `FLUSH`
	- `io.store.cmd.flushFree` => `FLUSH_FREE`
	- `io.store.cmd.prefetch` => `PREFETCH`
	- `io.store.cmd.generation` => `GENERATION`
	
	Finally, the `io.store.cmd.valid` field makes this stage valid. So it's only when we receive a valid store command that the `store.pipeline` starts working.

___

- `readTagsStage`

	We send read commands to each `ways(wayId)` in order to have the tag set pointed to by the physical address.
	We send the read command by filling `ways(wayId).storeRead.cmd.payload` with the index part of the physical address contained in `ADDRESS_POST_TRANSLATION`.
	
	We do the same with `status` by filling `status.storeRead.cmd.payload`.

	Depending on the type of memory used by `ways` and by `status` :
	- **Distributed RAM(default)** : `readTagsStage` is in stage 1, we send the read command and we receive the response in the same stage.
	- **Block RAM** : `readTagsStage` is in stage 0, we send the read command in stage 0, and we receive the response in the next stage, stage 1.
	In both cases, we receive the read response in stage 1.
	
	The `ways(wayId).storeRead` responses are stored in the `WAYS_TAGS` stageable, which will be a vector of `Tag` object.
	
	The `status.storeRead` response is stored in the `STATUS` stageable, which will be a vector of dirty bit, as seen above, 1 bit for each way.

- `hitsStage`

	By taking the tag part of `ADDRESS_POST_TRANSLATION`, we can see if we have a cache hit.
	
	We check for each `WAYS_TAGS(wayId)` :
	- if we have the same tag by comparing `WAYS_TAGS(wayId).address` and the tag part of `ADDRESS_POST_TRANSLATION`
	AND
	- if the cache line associated to `WAYS_TAGS(wayId)` is valid, by checking `WAYS_TAGS(wayId).loaded`
	
	The results of theses checks are stored in the `WAYS_HITS` stageable, which is a n-bits word (where n = number of ways). If a bit is equal to 1, this means that the checks on the associated way give a true result.

- `hitStage`

	Here, we simply OR all the bits in `WAYS_HITS` and store the boolean result in `WAYS_HIT`.
	
	If we have `WAYS_HIT = True`, this means that at least 1 bit of `WAYS_HITS` is equal to 1, and we have a cache hit.

___

- `controlStage`

	First of all, we check that the store being processed is not already in a [[#Refill slots|refill slot]]. If there is cache miss, we have to wait for this refill slot and not use a new one.
	So, for each refill slot, we check whether it is valid and whether its address = `ADDRESS_POST_TRANSLATION`.
	We store the result in the `REFILL_HITS` stageable, which is an n-bit word (where n = number of slots). If any bit is equal to 1, there is a hit with the associated refill slot, and `refillHit = True`
	
	>If the `loadRefillCheckEarly` argument to `DataCachePlugin` is equal to True, the above check is made 1 stage before `controlStage`. In the default `NaxRiscv`, `loadRefillCheckEarly = False`.
	
	A number of things are then done and checked :
	1. Take a reservation to write to the `ways` and `status` zones. The reservation is allocated according to the other agents writing to these areas (`refill`, `invalidate`, `load`), and to our priority(3).
	
	 2. Choose the way, i.e. the cache line in the cache set, where we will write the refilled data. It's a random number taken from a free running counter, and the value is stored in `refillWay`.  The value is used if we need to perform a refill operation.
	
	3. Check that the cache line chosen for refill is not dirty. If it is, this cache line must be written back and we set `refillWayNeedWriteback = True`
	
	4. Check that the chosen cache line is not already being used by another refill operation pushed previously. This is done by checking the chosen cache line for each valid refill slot. If the cache line is already in use, we can't use it, we set `lineBusy = True`, and we won't push anything into a refill slot.
	
	5. If there is an hazard in the cache line giving a cache hit, set `waysHitHazard = True`.
	
	6. Check that the cache line giving a cache hit is not dirty, by checking the dirty bit associated with it. If it is not dirty, set `wasClean = True`
	
	7. Check `GENERATION` value, if it alternates well, set `GENERATION_OK = True`
	
	With the variables set above, we can set the stageables `REDO` and `MISS`.
	`REDO = True` if there is either :
	- a cache miss, `WAYS_HIT = False`
	- a `ways` hazard, `waysHitHazard = True`
	- `bankBusy = True`
	- this load processed in a refill slot, `refillHit = True`
	- the cache line giving a cache hit is not dirty, but we loose the reservation on `ways` and `status` areas , `wasClean = True && reservation.win = False`
	
	`REDO = False` always if `IO = True`
	
	`MISS = True` if there is :
	- a cache miss, `WAYS_HIT = False` 
	AND
	- not `ways` hazard, `waysHitHazard = False`
	AND
	- not this load processed in a refill slot, `refillHit = False`

	`MISS = False` always if `IO = True`

	**Refill**
	We can start refill operation by pushing data in a refill slot when in the same time :
	- there is at least one free refill slot
	- the cache line chosen randomly for refill is not used by another refill operation
	- the load pipeline does not start refill operation in the same time
	- we win the reservation on `ways` and `status` areas
	- there is at least one free writeback slot, if we need to perform a writeback operation
	- `MISS = True`
	- this load is already processed in a refill slot, so we won't duplicate the refill operation
	- `GENERATION_OK = True`
	
	When we start refill :
	- we push to a refill slot the physical address `ADDRESS_POST_TRANSLATION` and the chosen way `refillWay`. If we need a writeback operation, we also push in the `refill.push.victim` field, the writeback slot which will be used.
	- we write in `ways` the tag and that the cache line is valid by setting `loaded = True`
	- if the chosen cache line requires a writeback, we push this victim cache line to a writeback slot
	
	**Flush**
	We can start flush the cache line when in the same time :
	- we receive a store command with flush command `FLUSH = True`
	- we need to flush the cache line because it's valid and dirty
	- we win the reservation on `ways` and `status` areas
	- there is at least one free writeback slot
	- there are no valid refill slots
	- not `ways` hazard, `waysHitHazard = False`
	- `GENERATION_OK = True`
	
	When we start flush :
	- we push the cache line to a writeback slot before flushing it
	- we update the dirty bit vector in the `status` area, by setting the dirty bit associated with the chosen cache line to False.
	- we update `ways` by setting `loaded = True` to invalidate the cache line, and if `FLUSH_FREE = True`, we update the tag with a random value
	
	**Write cache**
	We write data in the cache line when in the same time :
	- it's not an IO access OR a flush command OR a store command from prefetch
	- we don't have to redo the store command, so there is a cache hit
	- `GENERATION_OK = True`
	
	When we start to write :
	- we write the data in `banks(id)`, the `banks` area that gives the cache hit.
	- we write the data(byte, half, word, double) from CPU in the right place in the word of size `memDataWidth` using the mask coming from `CPU_MASK`.
	
	If there is a cache miss, but the refill slots are full, we set `REFILL_SLOT_FULL = True`.
	
	We set the `REFILL_SLOT` stageable with the refill slot number, it is the refill slot where we pushed.

- `injectStage`

	Finally, at this point, we send the store response, and fill in the `io.store.rsp` fields with all the stageables defined earlier :
	- `io.store.rsp.generationKo` <= `!GENERATION_OK`
	- `io.store.rsp.fault` <= False
	- `io.store.rsp.redo` <= `REDO` 
	- `io.store.rsp.refillSlotAny` <= `REFILL_SLOT_FULL` 
	- `io.store.rsp.refillSlot` <= `REFILL_SLOT` 
	- `io.store.rsp.flush` <= `FLUSH` 
	- `io.store.rsp.prefetch` <= `PREFETCH` 
	- `io.store.rsp.address` <= `ADDRESS_POST_TRANSLATION` 

___
#### Refill slots

These refill slots read the memory to load cache lines after a cache miss.
###### Push

When `load.pipeline` or `store.pipeline` pushes data into a refill slot, the first refill slot that is free is selected, and we fill the fields in that slot.
`slot.valid <= True`  
`slot.address <= push.address`  
`slot.way <= push.way`  
`slot.cmdSent <= False`  
`slot.priority.setAll()`  
`slot.loaded <= False`  
`slot.loadedCounter <= 0`  
`slot.victim <= push.victim`  
`slot.writebackHazards <= 0`

###### Read

To find out which slot is ready to send a read command to memory, we check the following points :
- the slot is valid
- if the slot has not already sent a read command to the memory
- if we need a writeback with refill, the victim cache line has been read by its writeback slot and the data is in the `victimBuffer`. We can therefore update the cache line without risk
- if there is no valid writeback slot pointing to the same address in memory

If there are several slots ready, we arbitrate between them using the `priority` field of each slot. The selected refill slot can now send a read command to memory by filling in the `io.mem.rea.cmd` fields :
- `io.mem.read.cmd.id` <= the refill slot number
- `io.mem.read.cmd.address` <= the physical address with offset =  0

Then, when we receive the response from memory, thanks to `io.mem.read.rsp.id`, we find the address, i.e. the cache set, and the way, i.e. the cache line in this cache set. This will tell us where the cache line to write in `banks` is.
At each cycle, if `io.mem.read.rsp.valid = True`, we store the word received in its cache line location, and increment the address to point to the next location in the cache line.

When we receive the last word :
- we update the refill location by setting `loaded` to True, which will start incrementing `loadedCounter`. When this counter reaches its maximum, the refill slot will be invalidated and ready for a new refill operation.
- we send the `io.refillCompletions` signal with the refill slot number to `Lsu2Plugin` and `MmuPlugin`, to let them know that the refill operation is complete and that they can redo their load command.
- If we have received an error from the interconnect or from memory in the `io.mem.read.rsp.error` field, we update the `ways` field, setting `fault = True`.

___
#### Writeback slots

These writeback slots write in the memory when cache lines are evicted.

###### Push

When `load.pipeline` or `store.pipeline` pushes data into a writeback slot, the first writeback slot that is free is selected, and we fill the fields in that slot.
`slot.valid <= True`  
`slot.address <= push.address`  
`slot.way <= push.way`  

`slot.readCmdDone <= False`, to find out whether the command to read the last word in the cache line has been sent
`slot.readRspDone <= False`, to find out whether the last word in the cache line has been read
`slot.victimBufferReady <= False`, to find out if `victimBuffer` contains at least the first word of the cache line
`slot.writeCmdDone <= False`  
`slot.priority.setAll()`  

###### Read

Firstly, before writing in memory, we have to read the cache line and store it in the `victimBuffer` array.

<svg version="1.1" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 492.11578434667695 334.55626722483703" width="492.11578434667695" height="334.55626722483703">
  <!-- svg-source:excalidraw -->
  
  <defs>
    <style class="style-fonts">
      @font-face {
        font-family: "Virgil";
        src: url("https://excalidraw.com/Virgil.woff2");
      }
      @font-face {
        font-family: "Cascadia";
        src: url("https://excalidraw.com/Cascadia.woff2");
      }
    </style>
  </defs>
  <rect x="0" y="0" width="492.11578434667695" height="334.55626722483703" fill="#ffffff"></rect><g stroke-linecap="round" transform="translate(10 10) rotate(0 201.5 124)"><path d="M0 0 L403 0 L403 248 L0 248" stroke="none" stroke-width="0" fill="#ffffff"></path><path d="M0 0 C139.14 0, 278.28 0, 403 0 M0 0 C100.09 0, 200.17 0, 403 0 M403 0 C403 60.42, 403 120.83, 403 248 M403 0 C403 75.76, 403 151.52, 403 248 M403 248 C289.09 248, 175.17 248, 0 248 M403 248 C246.8 248, 90.6 248, 0 248 M0 248 C0 173.04, 0 98.08, 0 0 M0 248 C0 152.59, 0 57.18, 0 0" stroke="#000000" stroke-width="4" fill="none"></path></g><g stroke-linecap="round"><g transform="translate(10 44) rotate(0 201.5 0)"><path d="M0 0 C123.74 0, 247.49 0, 403 0 M0 0 C91.57 0, 183.14 0, 403 0" stroke="#000000" stroke-width="4" fill="none"></path></g></g><mask></mask><g transform="translate(159 15) rotate(0 52.5 11.5)"><text x="52.5" y="18" font-family="Helvetica, Segoe UI Emoji" font-size="20px" fill="#000000" text-anchor="middle" style="white-space: pre;" direction="ltr">victimBuffer</text></g><g transform="translate(27.5 53) rotate(0 24.5 9)"><text x="24.5" y="14" font-family="Helvetica, Segoe UI Emoji" font-size="16px" fill="#000000" text-anchor="middle" style="white-space: pre;" direction="ltr">word 0</text></g><g stroke-linecap="round"><g transform="translate(93 46.5) rotate(0 0 104.3892375318987)"><path d="M0 0 C0 50.79, 0 101.58, 0 208.78 M0 0 C0 58.23, 0 116.47, 0 208.78" stroke="#000000" stroke-width="2" fill="none"></path></g></g><mask></mask><g stroke-linecap="round"><g transform="translate(174.9000000000001 46.5) rotate(0 0 104.87051674175346)"><path d="M0 0 C0 67.71, 0 135.42, 0 209.74 M0 0 C0 79.25, 0 158.5, 0 209.74" stroke="#000000" stroke-width="2" fill="none"></path></g></g><mask></mask><g stroke-linecap="round"><g transform="translate(327.5 46.5) rotate(0 0 105.11115634668081)"><path d="M0 0 C0 70.07, 0 140.14, 0 210.22 M0 0 C0 45.94, 0 91.88, 0 210.22" stroke="#000000" stroke-width="2" fill="none"></path></g></g><mask></mask><g transform="translate(109.5 53) rotate(0 24.5 9)"><text x="24.5" y="14" font-family="Helvetica, Segoe UI Emoji" font-size="16px" fill="#000000" text-anchor="middle" style="white-space: pre;" direction="ltr">word 1</text></g><g transform="translate(338.5 53) rotate(0 31.5 9)"><text x="31.5" y="14" font-family="Helvetica, Segoe UI Emoji" font-size="16px" fill="#000000" text-anchor="middle" style="white-space: pre;" direction="ltr">word n-1</text></g><g transform="translate(27.5 89) rotate(0 24.5 9)"><text x="24.5" y="14" font-family="Helvetica, Segoe UI Emoji" font-size="16px" fill="#000000" text-anchor="middle" style="white-space: pre;" direction="ltr">word n</text></g><g transform="translate(100.5 89) rotate(0 33.5 9)"><text x="33.5" y="14" font-family="Helvetica, Segoe UI Emoji" font-size="16px" fill="#000000" text-anchor="middle" style="white-space: pre;" direction="ltr">word n+1</text></g><g transform="translate(334 89) rotate(0 36 9)"><text x="36" y="14" font-family="Helvetica, Segoe UI Emoji" font-size="16px" fill="#000000" text-anchor="middle" style="white-space: pre;" direction="ltr">word 2n-1</text></g><g transform="translate(23 124) rotate(0 29 9)"><text x="29" y="14" font-family="Helvetica, Segoe UI Emoji" font-size="16px" fill="#000000" text-anchor="middle" style="white-space: pre;" direction="ltr">word 2n</text></g><g transform="translate(245.5 53) rotate(0 7 9)"><text x="7" y="14" font-family="Helvetica, Segoe UI Emoji" font-size="16px" fill="#000000" text-anchor="middle" style="white-space: pre;" direction="ltr">...</text></g><g transform="translate(245.5 89) rotate(0 7 9)"><text x="7" y="14" font-family="Helvetica, Segoe UI Emoji" font-size="16px" fill="#000000" text-anchor="middle" style="white-space: pre;" direction="ltr">...</text></g><g transform="translate(127 124) rotate(0 7 9)"><text x="7" y="14" font-family="Helvetica, Segoe UI Emoji" font-size="16px" fill="#000000" text-anchor="middle" style="white-space: pre;" direction="ltr">...</text></g><g stroke-linecap="round"><g transform="translate(125.94260475534065 176.9843787652153) rotate(270 -13.156031539670039 101.11388102584769)"><path d="M0 0 C-2.39 4.34, -11.62 -2.4, -14.35 26.04 C-17.08 54.47, -14.38 141.27, -16.37 170.63 C-18.36 200, -24.66 196.96, -26.31 202.23 M0 0 C-2.39 4.34, -11.62 -2.4, -14.35 26.04 C-17.08 54.47, -14.38 141.27, -16.37 170.63 C-18.36 200, -24.66 196.96, -26.31 202.23" stroke="#000000" stroke-width="2" fill="none"></path></g></g><mask></mask><g stroke-linecap="round"><g transform="translate(297.87043798071704 178.983609852367) rotate(270 14.399232176375449 98.20087707917654)"><path d="M0 0 C1.99 6.42, 9.97 10.51, 11.97 38.54 C13.96 66.57, 9.16 141.86, 11.97 168.17 C14.77 194.48, 25.99 191.7, 28.8 196.4 M0 0 C1.99 6.42, 9.97 10.51, 11.97 38.54 C13.96 66.57, 9.16 141.86, 11.97 168.17 C14.77 194.48, 25.99 191.7, 28.8 196.4" stroke="#000000" stroke-width="2" fill="none"></path></g></g><mask></mask><g transform="translate(72.02173069225091 301.55626722483703) rotate(0 143.5 11.5)"><text x="143.5" y="18" font-family="Helvetica, Segoe UI Emoji" font-size="20px" fill="#000000" text-anchor="middle" style="white-space: pre;" direction="ltr">Number of words in a cache line</text></g><g stroke-linecap="round"><g transform="translate(12.002482959366034 80.18550661927912) rotate(0 198.75779947862725 0)"><path d="M0 0 C110.59 0, 221.19 0, 397.52 0 M0 0 C148.75 0, 297.51 0, 397.52 0" stroke="#000000" stroke-width="4" fill="none"></path></g></g><mask></mask><g stroke-linecap="round"><g transform="translate(11.502482959366034 115.58550661927916) rotate(0 199.00779947862725 0)"><path d="M0 0 C121.59 0, 243.18 0, 398.02 0 M0 0 C112.5 0, 225.01 0, 398.02 0" stroke="#000000" stroke-width="4" fill="none"></path></g></g><mask></mask><g stroke-linecap="round"><g transform="translate(13.502482959366034 150.98550661927914) rotate(0 198.6344389783634 0)"><path d="M0 0 C135.48 0, 270.96 0, 397.27 0 M0 0 C84.96 0, 169.93 0, 397.27 0" stroke="#000000" stroke-width="4" fill="none"></path></g></g><mask></mask><g stroke-linecap="round"><g transform="translate(12.002482959366034 186.38550661927914) rotate(0 200.01107847809953 0)"><path d="M0 0 C105.69 0, 211.39 0, 400.02 0 M0 0 C90.08 0, 180.15 0, 400.02 0" stroke="#000000" stroke-width="4" fill="none"></path></g></g><mask></mask><g stroke-linecap="round"><g transform="translate(11.502482959366034 221.78550661927915) rotate(0 200.26107847809953 0)"><path d="M0 0 C93.43 0, 186.86 0, 400.52 0 M0 0 C117.24 0, 234.48 0, 400.52 0" stroke="#000000" stroke-width="4" fill="none"></path></g></g><mask></mask><g stroke-linecap="round"><g transform="translate(448.19367393956327 146.9357509620861) rotate(179.58482045885566 -11.918544568214202 51.88241706418482)"><path d="M0 0 C-2.17 2.23, -10.53 -1.23, -13 13.36 C-15.47 27.95, -13.02 72.49, -14.83 87.55 C-16.64 102.62, -22.34 101.06, -23.84 103.76 M0 0 C-2.17 2.23, -10.53 -1.23, -13 13.36 C-15.47 27.95, -13.02 72.49, -14.83 87.55 C-16.64 102.62, -22.34 101.06, -23.84 103.76" stroke="#000000" stroke-width="2" fill="none"></path></g></g><mask></mask><g stroke-linecap="round"><g transform="translate(422.50813701411244 46.07898894539551) rotate(179.58482045885566 12.696119251238656 50.38772925141879)"><path d="M0 0 C1.76 3.3, 8.79 5.39, 10.55 19.78 C12.31 34.16, 8.08 72.79, 10.55 86.29 C13.03 99.79, 22.92 98.36, 25.39 100.78 M0 0 C1.76 3.3, 8.79 5.39, 10.55 19.78 C12.31 34.16, 8.08 72.79, 10.55 86.29 C13.03 99.79, 22.92 98.36, 25.39 100.78" stroke="#000000" stroke-width="2" fill="none"></path></g></g><mask></mask><g transform="translate(355.11578434667695 136.42017312265307) rotate(89.99999999999994 115.5 11.5)"><text x="115.5" y="18" font-family="Helvetica, Segoe UI Emoji" font-size="20px" fill="#000000" text-anchor="middle" style="white-space: pre;" direction="ltr">Number of writeback slots</text></g></svg>

To find out which slot is ready to transfer its cache line to `victimBuffer`, we check the following points:
- the slot is valid
- the slot has not already transferred its cache line to `victimBuffer`, `readCmdDone = False`

If there are several slots ready, we arbitrate between them using the `priority` field of each slot. The selected writeback slot can now read the cache line in the `banks` area word by word, and write it to `victimBuffer`.

We send the read command in one cycle, and we receive the word and write it one cycle later (As `banks` use Block RAM). This is why we use `slotReadLast` which is `slotRead` delayed by one cycle.

When the first word is read from `banks` and written to `victimBuffer`, we set `victimBufferReady = True`, to allow the writeback slot to start writing to memory.

While reading the `banks`, we set `usedByWriteBack = True` to prevent `load.pipeline` from reading the `banks` at the same time.

When the command to read the last word is sent, we set `readCmdDone = True`.
One cycle later, when the last word is read, we set `readRspDone = True`

###### Write

To find out which slot is ready to send a write command to memory, we check the following points:
- the slot is valid
- `victimBufferReady = True`
- if the slot has not already sent a write command to the memory

If there are several slots ready, we arbitrate between them using the `priority` field of each slot. 
The selected writeback slot can now read the cache line in the `victimBuffer` word by word. 

We send the read command in one cycle, and we receive the word and write it one cycle later in `io.mem.write.cmd.data` field (As `victimBuffer` use Block RAM). 
This is why the `bufferRead` stream is passed to `io.mem.write.cmd` with a delay of one cycle.

`bufferRead` is a stream which contains the information needed to fill the `io.mem.write` fields.

When the command to read the last word is sent, we set `writeCmdDone = True`.

Finally when we receive `io.mem.write.rsp.valid = True` and the id of the writeback slot being processed is equal to `io.mem.write.rsp.id`, the writeback slot is invalidated and ready for a new writeback operation.

___
#### Invalidate

This area is used to initialise the data cache and is only executed on reset.

This is done by writing to all `ways` entries:
- `loaded = False`, i.e. invalidate the cache line
- a random tag

___
#### Performance Counter

When there is a push in a refill slot or a writeback slot, we send a signal to the `PerformanceCounterPlugin`.
- refill push => `io.refillEvent`
- writeback push => `io.writebackEvent`.

In this way, we can count cache misses, and cache evictions.